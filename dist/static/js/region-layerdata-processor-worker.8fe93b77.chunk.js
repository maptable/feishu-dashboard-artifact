(()=>{"use strict";var e={23783:(e,t,o)=>{var a=o(20780),n=o(8942),i=o.n(n),r=o(74720),l=o.n(r),s=(o(34362),o(55349)),d=o.n(s),u=o(17646),c=o.n(u),p=o(56356),g=o.n(p),f=o(22787),m=o(468),v=o.n(m),h=o(53813),y=o.n(h),b=o(88716),I=o.n(b),w=o(82813),N=o.n(w),S=o(42015),M=o(36441),x=o(40978),O=o(13424),F=o(29630),k=o(93033);const j="optimized",V=("".concat("https://icon-cdn.maptable.com","/assets/boundary_data"),85);let _,B,C=null;async function z(e,t){const{id:o,locale:n,mapInfo:r,tableNode:s,regionGeojson:u,allIndexOptions:p,dashboardData:m}=e,{hideEmpty:h}=r.regionConfig;t({id:o,type:"processing",data:{data:u,notMatchedItems:[],totalItems:[]}});try{var b,w;const e=await async function(e){var t;let{locale:o,mapInfo:n,tableNode:r,geojson:s,allIndexOptions:u,dashboardData:p}=e;const m=!i()(C,s),h=y()(s);if(h&&(C=h),"optimized"===j&&"region"===(null===n||void 0===n||null===(t=n.regionConfig)||void 0===t?void 0:t.dimension))return await(0,k.l)({locale:o,mapInfo:n,tableNode:r,geojson:h,allIndexOptions:u,dashboardData:p,hasGeoJSONChanged:m});const b=[],I=[],{regionDimensionFieldID:w,regionIndexStatsFieldID:z,specifyByFieldID:D,regionConfig:P,latitudeFieldID:G}=n,{dimension:J,aggregateBy:T,regionId:q,indexStatsMethod:H}=P;if(!w||!z||!h||!r)return null===h||void 0===h||h.features.map((e=>(e.properties=v()(e.properties,["aggregationValue","aggregationFormatValue"]),e))),{computingGeoJSON:h};(_&&!i()(w,_)||B&&!i()(z,B))&&(null===h||void 0===h||h.features.map((e=>(e.properties=v()(e.properties,["aggregationValue","aggregationFormatValue"]),e)))),_=w,B=z;const Z=q||"china";if("region"===J){const e=N()(u),t=new a.Z(e,S.Hk),n=new a.Z(e,S.Yk),i=r.rows||[],l=r.columns||[],s=JSON.stringify((null===l||void 0===l?void 0:l.find((e=>e.id===z)))||{}),f=l.find((e=>e.id===w)),v=l.find((e=>e.id===D)),y=new Map,x=new Map(h.features.map((e=>{var t;return[null===(t=e.properties)||void 0===t?void 0:t.id,e]}))),k=new Map(e.map((e=>[e.id,e.parentId]))),j=!!v;let _=[],B=H||"sum";p?(c()(p,((e,t)=>{c()(e,((e,o)=>{_.push({regionName:g()(t),specifyByName:j?o:null,value:e.value,dashboardValue:"mean"===B?e:void 0,rowId:t})}))})),"count"!==H&&"nonEmptyCount"!==H||(B="sum")):_=i.reduce(((e,t,o)=>{const a=(0,O.hb)(t,f);if(!a)return e;const n=t.cells[z],i=t.id;return e.push({regionName:a,specifyByName:(0,O.hb)(t,v),value:n,rowId:i}),e}),[]),I.push(..._);const C=await(0,F.zK)(Z),P=new Set(_.map((e=>"".concat(e.regionName,"-").concat(e.specifyByName||"","-").concat(T||"")))),G=await Promise.all([...P].map((e=>(0,F.TK)(e,C)))),J=new Map([...P].map(((e,t)=>[e,G[t]]))),q={};for(const o of _){var A;if(o.regionName&&o.regionName.length>V){b.push(o);continue}const e="".concat(o.regionName,"-").concat(o.specifyByName||"","-").concat(T||"");let a=J.get(e);if(a||m){var E;const i=await(0,O.Lu)(o.regionName,n,t);if(null===i||void 0===i||!i.length){q[e]=null;continue}a=await(0,O.XN)({directFuzzyMatchResult:i,specifyMatchValue:o.specifyByName,strictFUse:n,fuzzyFUse:t,aggregateBy:T}),((null===(E=a)||void 0===E?void 0:E.score)||0)>S.a&&(a=null),J.set(e,a||null),q[e]=a||null}if(d()(a)){b.push(o);continue}const i=null===(A=a.item)||void 0===A?void 0:A.id;if(!i){b.push(o);continue}const r=o.value,l=o.rowId;y.has(i)||y.set(i,[]),y.get(i).push({value:r,rowId:l,dashboardValue:o.dashboardValue});let s=i;for(let t=0;t<2;t++){const e=k.get(s);if(!e)break;y.has(e)||y.set(e,[]),y.get(e).push({value:r,rowId:l,dashboardValue:o.dashboardValue}),s=e}}await(0,F.Iv)(q,C);for(const[a,r]of y){var K,U,L;const e=x.get(a);if(!e)continue;if(a===M.q)continue;const t="zh-CN"===o?(null===(K=e.properties)||void 0===K?void 0:K.display_name)||(null===(U=e.properties)||void 0===U?void 0:U.name_zh):null===(L=e.properties)||void 0===L?void 0:L.name_en;e.type="Feature";const n=(0,O.vg)(r,B);e.properties={...e.properties||{},name:t,aggregationValue:n,aggregationMethod:B,rowIds:r.map((e=>e.rowId)),indexStatsColumn:s}}const Y=Array.from(y.keys()).map((e=>x.get(e))).filter((e=>{var t;return void 0!==e&&(null===(t=e.properties)||void 0===t?void 0:t.id)!==M.q})),{valueMap:$,totalSum:Q,rankMap:W}=(0,O.Hr)(Y,[M.q]);for(const[o]of y){var R,X;const e=x.get(o);if(!e||o===M.q)continue;const t=null===(R=e.properties)||void 0===R?void 0:R.name,a=null===(X=e.properties)||void 0===X?void 0:X.aggregationValue,n=$.get(o)||0,i=0!==Q?n/Q*100:null,r=W.get(o)||null,s=(0,O.gB)({aggregationValue:a,indexStatsMethod:H,columns:l,regionIndexStatsFieldID:z,name:t,ratio:i,rank:r});e.properties={...e.properties||{},ratio:i,rank:r,tooltip:s}}}else if("coordinate"===J||"lng-lat"===J||"wkt"===J){const e=r.rows,t=r.columns,a=new Map,n=JSON.stringify((null===t||void 0===t?void 0:t.find((e=>e.id===z)))||{});for(const i of e){let e=i.cells[w];if(e)try{"lng-lat"===J&&i.cells[G||""]&&(e="POINT(".concat(e," ").concat(i.cells[G||""],")"));const t=(0,x.HF)(e);if("Point"!==t.type)continue;let r=!1;I.push({regionName:i.cells[w],specifyByName:null,value:0,rowId:i.id});for(const e of h.features){const s="zh-CN"===o?l()(e,"properties.display_name")||l()(e,"properties.name_zh"):l()(e,"properties.name_en");if((0,f.Z)(t.coordinates,e)){var Y,$,Q;const t=null===(Y=e.properties)||void 0===Y?void 0:Y.id;a.has(t)||a.set(t,[]),a.get(t).push({value:i.cells[z],rowId:i.id});const o=(null===($=a.get(t))||void 0===$?void 0:$.map((e=>e.value)))||[];e.type="Feature",e.properties={...e.properties||{},name:s,aggregationValue:o,aggregationMethod:H,rowIds:(null===(Q=a.get(t))||void 0===Q?void 0:Q.map((e=>e.rowId)))||[],indexStatsColumn:n},r=!0;break}}r||b.push({rowId:i.id,regionName:l()(i.cells,"".concat(w,"-fullAddress"),i.cells[w]),value:0,specifyByName:null})}catch{continue}}}const{valueMap:W,totalSum:ee,rankMap:te}=(0,O.Hr)(h.features,[M.q]),oe=(null===r||void 0===r?void 0:r.columns)||[];for(const a of h.features){var ae,ne,ie;const e=null===(ae=a.properties)||void 0===ae?void 0:ae.id;if(!e||e===M.q)continue;const t=null===(ne=a.properties)||void 0===ne?void 0:ne.aggregationValue,o=null===(ie=a.properties)||void 0===ie?void 0:ie.name;if(!t||!o)continue;const n=W.get(e)||0,i=0!==ee?n/ee*100:null,r=te.get(e)||null,l=(0,O.gB)({aggregationValue:t,indexStatsMethod:H,columns:oe,regionIndexStatsFieldID:z,name:o,ratio:i,rank:r});a.properties={...a.properties||{},ratio:i,rank:r,tooltip:l}}return{computingGeoJSON:h,notMatchedItems:b,totalItems:I}}({locale:n,mapInfo:r,tableNode:s,geojson:u,allIndexOptions:p,dashboardData:m}),z=h?null===(b=e.computingGeoJSON)||void 0===b?void 0:b.features.filter((e=>{var t;return!I()(null===(t=e.properties)||void 0===t?void 0:t.aggregationValue)})):null===(w=e.computingGeoJSON)||void 0===w?void 0:w.features;t({id:o,type:"success",data:{data:{...e.computingGeoJSON,features:null!==z&&void 0!==z?z:[]},notMatchedItems:e.notMatchedItems||[],totalItems:e.totalItems||[]}})}catch(z){t({id:o,type:"failed",data:{data:u,notMatchedItems:[],totalItems:[]}})}}const D=globalThis;D.onmessage=e=>{z(e.data,D.postMessage)}},46131:(e,t,o)=>{o.d(t,{IG:()=>i});o(74720),o(7070),o(75538),o(78587),o(75091);var a=o(99540),n=o.n(a);o(81659),o(21740),o(91671),o(42015),o(97102);function i(e){return function(e){const t=[{value:1e9,symbol:"b"},{value:1e6,symbol:"m"},{value:1e3,symbol:"k"}];if(e<1e3)return e.toString();for(const o of t)if(e>=o.value){const t=e/o.value,a=Math.floor(t).toString().length,n=Math.max(0,4-a);return t.toFixed(n).replace(/\.?0+$/,"")+o.symbol}return e.toString()}(function(e){if(0!==e&&e>-.1&&e<1){let t,o=e;for(t=0;t<10&&o>-.1&&o<1;t++)o*=10;return parseFloat(e.toFixed(t+2))}return parseFloat(n()(e).toFixed(3))}(e))}},91671:(e,t,o)=>{}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=e,o.x=()=>{var e=o.O(void 0,[638,190,698,253,818,298],(()=>o(23783)));return e=o.O(e)},(()=>{var e=[];o.O=(t,a,n,i)=>{if(!a){var r=1/0;for(u=0;u<e.length;u++){a=e[u][0],n=e[u][1],i=e[u][2];for(var l=!0,s=0;s<a.length;s++)(!1&i||r>=i)&&Object.keys(o.O).every((e=>o.O[e](a[s])))?a.splice(s--,1):(l=!1,i<r&&(r=i));if(l){e.splice(u--,1);var d=n();void 0!==d&&(t=d)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,n,i]}})(),o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,a)=>(o.f[a](e,t),t)),[])),o.u=e=>638===e?"static/js/638.48b925df.js":190===e?"static/js/190.8bd7f8f0.js":"static/js/"+e+"."+{253:"92fe4cea",298:"b6f297c7",698:"4d2febf4",818:"58075517"}[e]+".chunk.js",o.miniCssF=e=>{},o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="./",(()=>{var e={524:1};o.f.i=(t,a)=>{e[t]||importScripts(o.p+o.u(t))};var t=self.webpackChunkmaptable_frontend=self.webpackChunkmaptable_frontend||[],a=t.push.bind(t);t.push=t=>{var n=t[0],i=t[1],r=t[2];for(var l in i)o.o(i,l)&&(o.m[l]=i[l]);for(r&&r(o);n.length;)e[n.pop()]=1;a(t)}})(),(()=>{var e=o.x;o.x=()=>Promise.all([638,190,698,253,818,298].map(o.e,o)).then(e)})();o.x()})();
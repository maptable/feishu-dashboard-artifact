(()=>{"use strict";var e={23669:(e,t,o)=>{var r={};o.r(r),o.d(r,{MAX_ISOCHRONE:()=>te,name:()=>ee,output:()=>re,transform:()=>oe});var a={};o.r(a),o.d(a,{name:()=>ie,transform:()=>se});var n={};o.r(n),o.d(n,{name:()=>ce,transform:()=>de});var i={};o.r(i),o.d(i,{name:()=>pe,transform:()=>fe});var s={};o.r(s),o.d(s,{name:()=>ve,transform:()=>he});var l={};o.r(l),o.d(l,{name:()=>Ie,output:()=>Ae,transform:()=>Ce});var u={};o.r(u),o.d(u,{name:()=>Le,output:()=>we,transform:()=>Te});var c={};o.r(c),o.d(c,{name:()=>ke,output:()=>Ne,transform:()=>De});var d=o(79129);(0,d.Em)({id:"k5fiSA",defaultMessage:"Buffer"}),(0,d.Em)({id:"4gHffY",defaultMessage:"Centroid"}),(0,d.Em)({id:"7NvZyt",defaultMessage:"Bounding box"}),(0,d.Em)({id:"e1QVee",defaultMessage:"Generate a rectangular polygon completely covering the data object"}),(0,d.Em)({id:"UEBV86",defaultMessage:"Count points"}),(0,d.Em)({id:"xKy7Hd",defaultMessage:"Join features"}),(0,d.Em)({id:"ICu6vY",defaultMessage:"Associates the attribute data of polygons to the data objects that fall within them"}),(0,d.Em)({id:"yj8NrY",defaultMessage:"Clip"}),(0,d.Em)({id:"C1Xstm",defaultMessage:"Keep only the parts of each data object inside polygons from another layer"}),(0,d.Em)({id:"c4xaiR",defaultMessage:"Dissolve"}),(0,d.Em)({id:"UjJfz6",defaultMessage:"Create a single new polygon covering all data objects"}),(0,d.Em)({id:"HzfrYu",defaultMessage:"Grid"}),(0,d.Em)({id:"kLp9ex",defaultMessage:"Create grids and aggregate data within a specified area"}),(0,d.Em)({id:"js7RwD",defaultMessage:"Buffered"}),(0,d.Em)({id:"zZFBF0",defaultMessage:"Centroids"}),(0,d.Em)({id:"37516j",defaultMessage:"Bounded"}),(0,d.Em)({id:"7wGmyF",defaultMessage:"Counted"}),(0,d.Em)({id:"l8wanU",defaultMessage:"Joined"}),(0,d.Em)({id:"mq5q3E",defaultMessage:"Clipped"}),(0,d.Em)({id:"8dVSHI",defaultMessage:"Dissolved"}),(0,d.Em)({id:"k2JJSV",defaultMessage:"Gridded"}),(0,d.Em)({id:"68VUNu",defaultMessage:"Entire layer"}),(0,d.Em)({id:"+YJREd",defaultMessage:"Features on screen"}),(0,d.Em)({id:"Nl2TeU",defaultMessage:"Kilometer"}),(0,d.Em)({id:"9A/UWu",defaultMessage:"Mile"}),(0,d.vU)({buffer:{id:"9fv+qV",defaultMessage:"Layer"},centroid:{id:"9fv+qV",defaultMessage:"Layer"},bounds:{id:"9fv+qV",defaultMessage:"Layer"},countPoints:{id:"uRR69+",defaultMessage:"Summary polygon layer"},joinFeatures:{id:"3Yg293",defaultMessage:"Target layer"},clip:{id:"9YrdRF",defaultMessage:"Cut out data from"},dissolve:{id:"9fv+qV",defaultMessage:"Layer"},grid:{id:"Cnwv1R",defaultMessage:"Extent layer"}}),(0,d.Em)({id:"NmPCdP",defaultMessage:"Specify the extent that the grid will cover."});const p=2e4,f=1,g=50;var m=o(17646),y=o.n(m),v=o(6778),h=o(37383),M=o(82086),b=o(40517),P=(o(27222),o(69820)),E=o(17527),_=o(67045),I=o(22787),C=o(88716),A=o.n(C),L=o(52675),T=o(58205),w=o.n(T);o(57323);var x=o(82505),S=o(80128),R=o(31890),Z=(o(62953),o(64505)),O=o(65147);function k(e){switch(e.type){case"Point":return e;case"Circle":{const t=e.coordinates;return{type:"Point",coordinates:[t[0],t[1]]}}case"LineString":{const t=b.Tu(e.coordinates),o=(0,S.Z)(t).geometry.coordinates;return{type:"Point",coordinates:[o[0],o[1]]}}case"Polygon":{const t=b.yu(e.coordinates),o=(0,S.Z)(t).geometry.coordinates;return{type:"Point",coordinates:[o[0],o[1]]}}case"MultiPoint":{const t=b.ot(e.coordinates),o=(0,S.Z)(t).geometry.coordinates;return{type:"Point",coordinates:[o[0],o[1]]}}case"MultiLineString":{const t=b._R(e.coordinates),o=(0,S.Z)(t).geometry.coordinates;return{type:"Point",coordinates:[o[0],o[1]]}}case"MultiPolygon":{const t=b.tw(e.coordinates),o=(0,S.Z)(t).geometry.coordinates;return{type:"Point",coordinates:[o[0],o[1]]}}default:return console.info("Unknown geometry type",e.type),e}}const{GCJ02:j,WGS84:D,BD09MC:N}=h.default;function G(e){return function(e){return"Circle"===e.type?"CIRCLE (".concat(e.coordinates[0]," ").concat(e.coordinates[1],", ").concat(e.coordinates[2],")"):"MultiCircle"===e.type?"MULTICIRCLE (".concat(e.coordinates.map((e=>"(".concat(e[0]," ").concat(e[1],", ").concat(e[2],")"))).join(", "),")"):w().stringify(e)}(e)}function U(e,t,o){return A()(e)?[]:function(e,t){return(0,R.Z)(b.uf(e),{propertyName:t}).features}(function(e,t){const o=(0,L.Z)(b.uf(e));return t?(0,O.Z)(o,{precision:t}).features:o.features}(e,o),t)}const F=function(e,t){const[o,r,a,n]=t,i=b.yu([[[o,r],[a,r],[a,n],[o,n],[o,r]]]),s=b.xm(k(e).coordinates);return(0,I.Z)(s,i)};function B(e,t){return"Polygon"!==t.geometry.type&&"MultiPolygon"!==t.geometry.type?[]:e.map((e=>{const o=[],r=e.geometry,a=r.type,n=k(r);switch(a){case"Point":o.push({type:"Feature",geometry:r,properties:e.properties});break;case"MultiPoint":r.coordinates.forEach((t=>{o.push({type:"Feature",geometry:{type:"Point",coordinates:t},properties:e.properties})}));break;case"Polygon":case"MultiPolygon":case"LineString":case"MultiLineString":o.push({type:"Feature",geometry:{type:"Point",coordinates:n.coordinates},properties:e.properties})}const i=b.uf(o.map((e=>b.zL(e.geometry,e.properties))));return(0,_.Z)(i,t)})).flatMap((e=>e.features))}const z="https://api.mapbox.com/isochrone/v1/mapbox";async function H(e,t,o,r,a){const n=new URLSearchParams({contours_minutes:o.toString(),polygons:"true",denoise:"1",generalize:a.toString(),access_token:r}),i=await fetch("".concat(z,"/").concat(t,"/").concat(e.join(","),"?").concat(n.toString()),{method:"GET"}).then((e=>e.json()));if(i.features&&i.features.length>0)return i.features[0].geometry}o(57435);o(56439),o(95406);Object.freeze({name:"name",rows:"rows",columns:"columns",views:"views"});Object.freeze({name:"name",tableNodes:"tableNodes"});Object.freeze({list:"list"});Object.freeze({cellRangeSelection:"cellRangeSelection"});Object.freeze({hiddenLayerIds:"hiddenLayerIds"});var K=o(27371);o(94553);const Y={NODE_ENV:"production",PUBLIC_URL:"",BUILD_VERSION:"850a8b0",THIRD_PARTY:"feishu-dashboard",REACT_APP_SERVER_ENV:"production",REACT_APP_AG_GRID_LICENSE_KEY:"placeholder",REACT_APP_GOOGLE_OAUTH_CLIENT_ID:"placeholder",REACT_APP_BD_KEY:"placeholder",REACT_APP_GD_TOKEN:"3ac9d33da9e7be15cbb9f1b92f285e9c",REACT_APP_GOOGLE_MAP_KEY:"placeholder",REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoiZG9uZ2xlaSIsImEiOiJja3A2amE1cTMwbGQzMnBxZXF4MDEwMnRpIn0.v4ZdsImv9hprcA32ocydgw",REACT_APP_BASE_API_URL:"https://maptable.com/api",REACT_APP_LARK_BASE_API_URL:"https://maptable.net/api",REACT_APP_BOUNDARY_OSS_URL:"https://icon-cdn.maptable.com",REACT_APP_WS_URL:"wss://maptable.com/websocketd",REACT_APP_LARK_WS_URL:"wss://maptable.net/websocketd",REACT_APP_STRIPE_PUB_KEY:"pk_live_51L8b87HyKdWcfiHZBeLLIIUQKKf9Ec6UohLlnv0ZIjFfugGPZtfrGnfeQJ5yHXFeZNPya7ii4MTB5hQqXvf0CHhn004g4JMOOO",REACT_APP_STRIPE_RETURN_URL:"https://maptable.com/api/cb/stripe_payment/",REACT_APP_SENTRY_DSN:"https://1cbf40ec955b89c8c7182c2e9c3f940a@o1161772.ingest.us.sentry.io/4509296236691456",REACT_APP_CORS_DISABLE_TOKEN:"",REACT_APP_WECHAT_REDIRECT_URI:"https://maptable.com/auth/wechat",REACT_APP_RECAPTCHA_TOKEN:"6LdMgpcgAAAAAKSbHqoSMXgTg1jlTJcYer0Ss6M4",REACT_APP_MAINTAIN_FILE_URI:"https://maptable-prod-public.oss-cn-hangzhou.aliyuncs.com/prodfiles/broadcast/maintain.json",REACT_APP_CRISP_WEBSITE_ID:"e3f43195-3a5a-4bcb-bf1d-7e3d13d0376d",REACT_APP_ICON_CDN:"https://icon-cdn.maptable.com",REACT_APP_IP_CHECK_URL:"https://ipcheck.maptable.net/",REACT_APP_USE_RECAPTCHA:"true",REACT_APP_FEISHU_PAY_URI:"https://maptable.com/feishu/plan"}.vite?"ant":"mt";K.ZP.config({prefixCls:Y+"-message",maxCount:2});var J=o(74720),V=o.n(J);o(8942);function q(e){if("Polygon"===e.type){const t=e.coordinates[0][0];return w().stringify({...e,coordinates:[[...e.coordinates[0],t]]})}return"Circle"===e.type?"CIRCLE (".concat(e.coordinates[0]," ").concat(e.coordinates[1],", ").concat(e.coordinates[2],")"):"MultiCircle"===e.type?"MULTICIRCLE (".concat(e.coordinates.map((e=>"(".concat(e[0]," ").concat(e[1],", ").concat(e[2],")"))).join(", "),")"):w().stringify(e)}function W(e,t){if("Point"===t)return e;if("LineString"===t)return(0,S.Z)((0,b.Tu)(e)).geometry.coordinates;if("Polygon"===t)return(0,S.Z)((0,b.yu)(e)).geometry.coordinates;if("MultiPoint"===t)return(0,S.Z)((0,b.ot)(e)).geometry.coordinates;if("MultiLineString"===t)return(0,S.Z)((0,b._R)(e)).geometry.coordinates;if("MultiPolygon"===t)return(0,S.Z)((0,b.tw)(e)).geometry.coordinates;if("Circle"===t){return e.slice(0,2)}if("MultiCircle"===t){const t=e.map((e=>e.slice(0,2)));return(0,S.Z)((0,b.ot)(t)).geometry.coordinates}return console.info("Not supported geometryType",t),[]}var X=o(15972),Q=o.n(X);const $={layerType:"pointLinePolygon",fillFieldID:null,outlineFieldID:null,radiusFieldID:null,fillConfig:{fillOpacity:.6,colors:["#faa90a"],fillMethod:"quantize",icons:{},colorScheme:null,thresholds:null,aggregateBy:"sum",reverse:!1,bivariate:!1},radiusConfig:{radius:5,fixedToMeter:null,radiusRange:[0,20]},outlineConfig:{strokeWeight:1,strokeOpacity:.4,colors:["#faa90a"],colorScheme:null,thresholds:null,strokeMethod:"quantize",reverse:!1,align:"center"}},ee=(Q()({},$,{fillConfig:{fillOpacity:.8}}),Q()({},$,{fillConfig:{fillOpacity:.8,colors:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"]}}),"buffer"),te=1e3;function oe(e){let{layer:t,config:o}=e;const r=[];if(t)return y()(t.features,(e=>{var t,a,n;const i=(0,v.Z)(e,null!==(t=null===(a=o.buffer)||void 0===a?void 0:a.radius)&&void 0!==t?t:1,{units:null===(n=o.buffer)||void 0===n?void 0:n.unit});i&&r.push({...e,geometry:i.geometry,properties:{...e.properties}})})),{...t,features:r,mapInfo:{...t.mapInfo,...$}}}async function re(e){var t;let{config:o,analysisLayer:r,tableNode:a}=e;const n=[],{coordinateColumnId:i,buffer:s}=o;if(!i||!s)return n;const l=null===r||void 0===r?void 0:r.mapInfo.vectorTile;if(!l&&(null===a||void 0===a||!a.columns.find((e=>e.id===i))))return n;const u="isochrone"===s.mode,c=null!==(t=null===r||void 0===r?void 0:r.features)&&void 0!==t?t:[];function d(e,t){var o;const{rowID:r}=e.properties,s=q(t),u=l?e.properties:null===a||void 0===a||null===(o=a.rows.find((e=>e.id===r)))||void 0===o?void 0:o.cells;u&&r&&n.push({id:r,cells:{...u,[i]:s}})}for(const p of c){const{rowID:e}=p.properties,{method:t="driving",travelTime:r=10,mapboxToken:a}=s,n=!o.bbox||F(p.geometry,o.bbox);if(e&&p.geometry&&n)if(u&&a){const e=W(p.geometry.coordinates,p.geometry.type),o=await H(e,t,r,a,100);o&&d(p,o)}else d(p,p.geometry)}return n}var ae=o(15196),ne=o.n(ae);const ie="dissolve";function se(e){var t,o;let{layer:r,config:a}=e;const n=[];if(!r)return;const i=null===(t=a.dissolve)||void 0===t?void 0:t.propertyIds,s=null===i||void 0===i?void 0:i.join("_"),l=!(null===r||void 0===r||null===(o=r.mapInfo)||void 0===o||!o.vectorTile);if(s&&i){const e=r.features.map((e=>{const t=i.reduce(((t,o)=>{var r;const a=JSON.stringify(l?V()(e.properties,o):null===(r=e.properties.rawCells)||void 0===r?void 0:r[o]);return t+(a?"-".concat(a):"")}),"");return{...e,properties:{...e.properties,...e.properties.rawCells,[s]:t}}})),[t,o]=ne()(e,(e=>"Polygon"===e.geometry.type||"MultiPolygon"===e.geometry.type)),a=le(U(t,s),t);n.push(...function(e,t){const o=[],r={};y()(e,(e=>{const o=V()(e,"properties.".concat(t),"default");r[o]?r[o].push(e):r[o]=[e]}));for(const a in r){const e=r[a],t=e[0],n=(0,P.Z)({type:"FeatureCollection",features:e}).features.map((e=>({...e,properties:{...t.properties}})));o.push(...n)}return o}(o,s)),n.push(...a)}else{const[e,t]=ne()(r.features,(e=>"Polygon"===e.geometry.type||"MultiPolygon"===e.geometry.type)),o=le(U(e),e);y()(function(e){const t=e[0];return(0,P.Z)({type:"FeatureCollection",features:e}).features.map((e=>({...e,properties:{...t.properties}})))}(t),(e=>{n.push(e)})),n.push(...o)}return{...r,features:n,mapInfo:{...r.mapInfo,...$}}}function le(e,t){return e.map((e=>(y()(t,(t=>{(0,x.Z)(e,t)&&(e.properties={...t.properties})})),e)))}var ue=o(80593);const ce="centroid";function de(e){let{layer:t}=e;const o=[];if(t)return y()(t.features,(e=>{const t=(0,ue.Z)(e.geometry);t&&o.push({...e,geometry:t.geometry,properties:{...e.properties}})})),{...t,features:o,mapInfo:{...t.mapInfo,...$}}}const pe="bounds";function fe(e){let{layer:t}=e;const o=[];if(t)return y()(t.features,(e=>{const t=function(e){if("Point"!==e.type)return(0,E.Z)((0,M.Z)((0,b.zL)(e))).geometry}(e.geometry);t&&o.push({...e,geometry:t,properties:{...e.properties}})})),{...t,features:o,mapInfo:{...t.mapInfo,...$}}}var ge=o(31126),me=o(51090),ye=o(94648);const ve="clip";function he(e){let{layer:t,overlayLayer:o}=e;const r=[];if(!o||!t)return;const a=o.features.filter((e=>"Polygon"===e.geometry.type||"MultiPolygon"===e.geometry.type));return y()(t.features,(e=>{"Point"!==e.geometry.type&&"MultiPoint"!==e.geometry.type||(0,_.Z)(e,{type:"FeatureCollection",features:a}).features.forEach((t=>{r.push({...t,properties:{...e.properties,...t.properties}})})),"LineString"===e.geometry.type&&y()(a,(t=>{var o;y()(null===(o=(0,me.Z)(e,t))||void 0===o?void 0:o.features,(o=>{(0,ye.Z)(o,t)&&r.push({...o,properties:{...e.properties,...o.properties}})}))})),"MultiLineString"===e.geometry.type&&y()(a,(t=>{y()(e.geometry.coordinates,(o=>{var a;y()(null===(a=(0,me.Z)((0,b.Tu)(o),t))||void 0===a?void 0:a.features,(o=>{(0,ye.Z)(o,t)&&r.push({...o,properties:{...e.properties,...o.properties}})}))}))})),"Polygon"!==e.geometry.type&&"MultiPolygon"!==e.geometry.type||y()(a,(t=>{const o=(0,ge.Z)(e,t,{properties:{...e.properties}});o&&r.push(o)}))})),{...t,features:r,mapInfo:{...t.mapInfo,...$}}}var Me=o(27077),be=o(35546),Pe=o(70323),Ee=o(6200),_e=o(42514);const Ie="countPoints";function Ce(e){let{layer:t,overlayLayer:o}=e;const r=[];if(o&&t)return y()(t.features,(e=>{const t=B(o.features,e);r.push(...t)})),{...t,features:r,mapInfo:{...t.mapInfo,...$}}}function Ae(e){var t,o;let{layer:r,overlayLayer:a,config:n,tableNode:i}=e;const s=[],{coordinateColumnId:l}=n,u=n.countPoints,c=null===r||void 0===r||null===(t=r.mapInfo)||void 0===t?void 0:t.vectorTile;if(!a||!i&&!c||!u||!l)return s;const d=u.weightColumnId&&"all_record"!==u.weightColumnId?u.method:void 0,p=null!==a&&void 0!==a&&null!==(o=a.mapInfo)&&void 0!==o&&o.vectorTile?"".concat(u.weightColumnId):"rawCells.".concat(u.weightColumnId);return y()(null===r||void 0===r?void 0:r.features,(e=>{var t,o,r,u;if(!e.properties.rowID)return;const f=G(e.geometry);if(!f)return;if(!(!n.bbox||F(e.geometry,n.bbox)))return;const g=B(a.features,e),m=i?i.rows.find((t=>t.id===e.properties.rowID)):c?{id:e.properties.rowID,cells:e.properties}:void 0;if(!m)return;const y=g.length;let v=1;if(d){const e=g.map((e=>V()(e.properties,p)));switch(d){case"sum":v=(0,Me.Z)(e);break;case"mean":v=null!==(t=(0,be.Z)(e))&&void 0!==t?t:0;break;case"median":v=null!==(o=(0,Pe.Z)(e))&&void 0!==o?o:0;break;case"max":v=null!==(r=(0,Ee.Z)(e))&&void 0!==r?r:0;break;case"min":v=null!==(u=(0,_e.Z)(e))&&void 0!==u?u:0}}s.push({id:m.id,cells:{...m.cells,[l]:f,countPoints:y*v}})})),s}const Le="joinFeatures";function Te(e){let{layer:t,overlayLayer:o,config:r}=e;const a=[],{joinFeatures:n}=r;if(!o||!t||!n)return;const i=n.predicate,s=n.joinType;return y()(t.features,(e=>{y()(o.features,(t=>{if("one_to_one"===s&&a.some((t=>t.properties.id===e.properties.id)))return;let o=!1;"within"===i&&(xe(e.geometry)&&Se(t.geometry)&&(o=(0,ye.Z)(t,e)),Se(e.geometry)&&xe(t.geometry)&&(o=(0,ye.Z)(e,t)),xe(e.geometry)&&xe(t.geometry)&&(o=(0,ye.Z)(e,t)||(0,ye.Z)(t,e))),"intersects"===i&&(o=(0,x.Z)(t,e)),o&&a.push({...e,properties:{...e.properties,matchedFeature:t}})}))})),{...t,features:a,mapInfo:{...t.mapInfo,...$}}}function we(e){var t;let{layer:o,overlayLayer:r,analysisLayer:a,config:n,tableNode:i}=e;const s=[],{coordinateColumnId:l,joinFeatures:u}=n,c=null===o||void 0===o||null===(t=o.mapInfo)||void 0===t?void 0:t.vectorTile;if(!o||!r||!a||!i&&!c||!u||!l)return s;const d=u.columnIds;return y()(a.features,(e=>{const t=!n.bbox||F(e.geometry,n.bbox),o=V()(e.properties,"matchedFeature"),r=o.properties.rowID;if(!t||!o||!r)return;const a=null===d||void 0===d?void 0:d.reduce(((e,t)=>({...e,[t]:V()(o.properties.rawCells,t)})),{});s.push({id:r,cells:{...e.properties.rawCells,...a,[l]:G(e.geometry)}})})),s}function xe(e){return"Polygon"===e.type||"MultiPolygon"===e.type}function Se(e){return"Point"===e.type||"MultiPoint"===e.type}var Re=o(67840),Ze=o(56401);const Oe=(e,t,o)=>{const r=[],a=e[0],n=e[1],i=e[2],s=e[3],l=t,u=t/(0,Z.Z)([a,n],[i,n],o)*(i-a),c=l/(0,Z.Z)([a,n],[a,s],o)*(s-n),d=i-a,p=s-n,f=Math.floor(d/u),g=Math.floor(p/c),m=(p-g*c)/2;let y=a+(d-f*u)/2;for(let v=0;v<f;v++){let e=n+m;for(let t=0;t<g;t++){const t=b.yu([[[y,e],[y,e+c],[y+u,e+c],[y+u,e],[y,e]]],null===o||void 0===o?void 0:o.properties);null!==o&&void 0!==o&&o.mask?(0,ge.Z)(o.mask,t)&&r.push(t):r.push(t),e+=c}y+=u}return b.uf(r)},ke="grid";function je(e,t,o,r){let a;switch(r){case"square":a=function(e,t,o){const[r,a,n,i]=e,s=n-r,l=(0,b.vs)(t,o,"degrees"),u=i-a,c=(0,b.vs)(t,o,"degrees");return Math.floor(Math.abs(s)/l)*Math.floor(Math.abs(u)/c)}(e,t,o);break;case"hexagon":a=function(e,t,o){const[r,a,n,i]=e,s=(a+i)/2,l=(r+n)/2,u=2*t/(0,Z.Z)([r,s],[n,s],{units:o})*(n-r),c=2*t/(0,Z.Z)([l,a],[l,i],{units:o})*(i-a),d=u/2,p=2*d,f=Math.sqrt(3)/2*c,g=i-a,m=(n-r-p)/(p-d/2),y=Math.floor(m),v=(g-f)/f,h=Math.floor(v),M=h*f-g>f/2;let b=0;for(let P=0;P<=y;P++)for(let e=0;e<=h;e++)0===e&&P%2===1||0===e&&M||b++;return b}(e,t,o);break;case"point":a=function(e,t,o){const[r,a,n,i]=e,s=t/(0,Z.Z)([r,a],[n,a],{units:o})*(n-r),l=t/(0,Z.Z)([r,a],[r,i],{units:o})*(i-a),u=n-r,c=i-a,d=Math.floor(u/s);let p=0;const f=(c-Math.floor(c/l)*l)/2;let g=r+(u-d*s)/2;for(;g<=n;){let e=a+f;for(;e<=i;)p++,e+=l;g+=s}return p}(e,t,o);break;default:a=0}return Math.round(a)}function De(e){let{layer:t,config:o}=e;if(!t||!o.grid)return;const r=o.extent,a=o.bbox,{size:n,unit:i,type:s}=o.grid;if(n<=0)return;"viewport"===r&&a&&(t.features=t.features.filter((e=>F(e.geometry,a))));const l=(0,M.Z)(t),u=2*n,c=(0,v.Z)((0,E.Z)(l),u,{units:i}),d=(0,M.Z)(c),f=je(d,n,i,s);if(f>p)return{...t,gridCount:f,features:[],mapInfo:{...t.mapInfo,...$}};const g=(0,{square:Oe,hexagon:Re.Y,point:Ze.e}[s])(d,n,{units:i}).features;return{...t,gridCount:g.length,features:g,mapInfo:{...t.mapInfo,...$,fillConfig:{...$.fillConfig,fillOpacity:.2},outlineConfig:{...$.outlineConfig,strokeOpacity:1}}}}function Ne(e){var t;let{analysisLayer:o,config:r,layer:a}=e;const n=[],{weightColumnIds:i,type:s}=r.grid||{},l=!(null===a||void 0===a||null===(t=a.mapInfo)||void 0===t||!t.vectorTile);return y()(null===o||void 0===o?void 0:o.features,((e,t)=>{const o=G(e.geometry),r={};if("point"!==s){const t=B(null===a||void 0===a?void 0:a.features,e);null===i||void 0===i||i.forEach((e=>{const{weightColumnId:o,method:a}=e,n=o&&"all_record"!==o,i=l?o:"rawCells.".concat(o),s=n?function(e,t,o){var r,a,n,i;let s=0;const l=e.map((e=>V()(e.properties,t)));switch(o){case"sum":s=(0,Me.Z)(l);break;case"mean":s=null!==(r=(0,be.Z)(l))&&void 0!==r?r:0;break;case"median":s=null!==(a=(0,Pe.Z)(l))&&void 0!==a?a:0;break;case"max":s=null!==(n=(0,Ee.Z)(l))&&void 0!==n?n:0;break;case"min":s=null!==(i=(0,_e.Z)(l))&&void 0!==i?i:0;break;case"count":s=e.length}return s}(t,i,a):t.length;r["".concat(o,"_").concat(a)]=s}))}const u=(t+1).toString();o&&n.push({id:u,cells:{id:u,coordinate:o,...r}})})),n}function Ge(e){let{config:t,analysisLayer:o,tableNode:r}=e;const a=[],{coordinateColumnId:n}=t;if(!n)return a;const i=null===o||void 0===o?void 0:o.mapInfo.vectorTile;return i||null!==r&&void 0!==r&&r.columns.find((e=>e.id===n))?(y()(null===o||void 0===o?void 0:o.features,(e=>{const{rowID:o}=e.properties,s=G(e.geometry),l=!t.bbox||F(e.geometry,t.bbox);if(!o||!s||!l)return;let u;if(i)u=e.properties;else{const e=null===r||void 0===r?void 0:r.rows.find((e=>e.id===o));if(!e)return;u=e.cells}a.push({id:o,cells:{...u,[n]:s}})})),a):a}o(7070),o(99540),o(35257);var Ue=o(78587),Fe=o.n(Ue);o(39698);let Be=function(e){return e.AmapStandard="AmapStandard",e.AmapLight="AmapLight",e.AmapDark="AmapDark",e.AmapDarkBlue="AmapDarkBlue",e.AmapSatellite="AmapSatellite",e}({}),ze=function(e){return e.GoogleMapAtlas="GoogleMapAtlas",e.GoogleMapLight="GoogleMapLight",e.GoogleMapGrey="GoogleMapGrey",e.GoogleMapDark="GoogleMapDark",e.GoogleMapNight="GoogleMapNight",e.GoogleMapSatellite="GoogleMapSatellite",e}({}),He=function(e){return e.MapboxStreets="MapboxStreets",e.MapboxOutdoors="MapboxOutdoors",e.MapboxLight="MapboxLight",e.MapboxDark="MapboxDark",e.MapboxSatellite="MapboxSatellite",e}({});Be.AmapDark,Be.AmapDarkBlue,Be.AmapSatellite,ze.GoogleMapDark,ze.GoogleMapNight,He.MapboxDark,He.MapboxSatellite,Be.AmapStandard,Be.AmapLight,ze.GoogleMapAtlas,ze.GoogleMapLight,ze.GoogleMapGrey,He.MapboxStreets,He.MapboxOutdoors,He.MapboxLight,(0,d.Em)({id:"amap.style.standard",defaultMessage:"Standard"}),(0,d.Em)({id:"amap.style.light",defaultMessage:"Light"}),(0,d.Em)({id:"amap.style.dark",defaultMessage:"Dark"}),(0,d.Em)({id:"amap.style.darkBlue",defaultMessage:"Dark Blue"}),(0,d.Em)({id:"amap.style.satellite",defaultMessage:"Satellite"}),(0,d.Em)({id:"google.map.atlas",defaultMessage:"Atlas"}),(0,d.Em)({id:"google.map.light",defaultMessage:"Light"}),(0,d.Em)({id:"google.map.grey",defaultMessage:"Grey"}),(0,d.Em)({id:"google.map.dark",defaultMessage:"Dark"}),(0,d.Em)({id:"google.map.night",defaultMessage:"Night"}),(0,d.Em)({id:"google.map.satellite",defaultMessage:"Satellite"}),(0,d.Em)({id:"mapbox.style.streets",defaultMessage:"Streets"}),(0,d.Em)({id:"mapbox.style.outdoors",defaultMessage:"Outdoors"}),(0,d.Em)({id:"mapbox.style.light",defaultMessage:"Light"}),(0,d.Em)({id:"mapbox.style.dark",defaultMessage:"Dark"}),(0,d.Em)({id:"mapbox.style.satellite",defaultMessage:"Satellite"});var Ke=o(64274),Ye=o.n(Ke),Je=(o(25806),o(97780));function Ve(e){const t=Math.pow(2,e.z),o=e.x/t*360-180,r=(e.x+1)/t*360-180,a=Math.atan(Math.sinh(Math.PI*(1-2*e.y/t)))*(180/Math.PI);return[o,Math.atan(Math.sinh(Math.PI*(1-2*(e.y+1)/t)))*(180/Math.PI),r,a]}function qe(e,t){const[o,r,a,n]=Ve(e);return!(a<t.minLon||o>t.maxLon||r>t.maxLat||n<t.minLat)}function We(e,t){const[o,r,a,n]=Ve(e);return!(a<t[0]||o>t[2]||r>t[3]||n<t[1])}class Xe extends Je.JJ{constructor(e){super(e),this.url=e}async initMaxLevelTiles(e){if(this.maxLevelTiles)return;const t=await this.getHeader();this.maxLevelTiles=function(e,t){const o=e.maxZoom,r=Math.pow(2,o),a=[];for(let n=0;n<r;n++)for(let i=0;i<r;i++){const r={x:n,y:i,z:o};qe(r,e)&&(t?We(r,t)&&a.push(r):a.push(r))}return a}(t,e)}getMaxLevelTiles(){return this.maxLevelTiles}}async function Qe(e){let t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,a=arguments.length>3?arguments[3]:void 0;"string"===typeof e?(t=new Xe(e),await t.initMaxLevelTiles(a)):t=e;const n=t.getMaxLevelTiles();if(!n)return{features:[],pageInfo:{page:o,pageSize:r,total:0,tiles:[]},hasMore:!1};const i=n.length,s=(o-1)*r,l=Math.min(s+r,i),u=n.slice(s,l),c=[];for(const d of u)try{const e=await t.getZxy(d.z,d.x,d.y);if(!e)continue;const o=Ye()(e.data,{mvt:{coordinates:"wgs84",tileIndex:{x:d.x,y:d.y,z:d.z},shape:"geojson"}});if(Fe()(o)){const e=o.map((e=>{var t,o,r,a,n;return{type:"Feature",geometry:e.geometry,properties:{id:(null===(t=e.properties)||void 0===t?void 0:t.id)||"",rowID:(null===(o=e.properties)||void 0===o?void 0:o.rowID)||(null===(r=e.properties)||void 0===r?void 0:r.id)||"",name:(null===(a=e.properties)||void 0===a?void 0:a.name)||"",tableNodeType:(null===(n=e.properties)||void 0===n?void 0:n.tableNodeType)||"",...e.properties}}}));c.push(...e)}}catch{}return{features:c,pageInfo:{page:o,pageSize:r,total:i,tiles:u},hasMore:l<i,pmtiles:t}}const $e=globalThis;async function et(e,t,o){const r=[];let a,n=1,i=!0;for(;i;){const s=await Qe(a||e,n,100,t);a=s.pmtiles,i=s.hasMore,r.push(...s.features),o&&s.pageInfo.total>0&&o(n*s.pageInfo.pageSize,s.pageInfo.total),n++}return r}$e.onmessage=async e=>{const{config:t,tableNodes:o,layerNodes:d,layers:p,type:m,vtData:y,overlayVtData:v,vtParams:h,overlayVtParams:M}=e.data,b=null===d||void 0===d?void 0:d.find((e=>e.id===t.layerId)),P=null===o||void 0===o?void 0:o.find((e=>{var t;return e.id===(null===b||void 0===b||null===(t=b.mapInfo)||void 0===t?void 0:t.tableNodeID)})),{coordinateColumnId:E}=t,_=function(e){switch(e){case"buffer":return{...r};case"centroid":return{output:Ge,...n};case"bounds":return{...i,output:Ge};case"countPoints":return{...l};case"joinFeatures":return{...u};case"clip":return{output:Ge,...s};case"dissolve":return{output:Ge,...a};case"grid":return{...c};default:return}}(t.type);if(!_)return $e.postMessage({});let I=null===p||void 0===p?void 0:p.find((e=>e.id===t.layerId));if(!I)return $e.postMessage({});const C=null===p||void 0===p?void 0:p.find((e=>e.id===t.overlayLayerId));if("preview"===m){I.mapInfo.vectorTile&&y&&(I={...I,tableNodeType:"table",mapInfo:{...I.mapInfo,vectorTile:!1},features:y,vtInfo:void 0}),null!==C&&void 0!==C&&C.mapInfo.vectorTile&&v&&(C.features=v,C.vtInfo=void 0);const e=_.transform({layer:I,config:t,overlayLayer:C});if(!e)return $e.postMessage({});e.isAnalysis=!0,e.id="".concat(e.id,"-").concat(_.name),$e.postMessage({layer:e})}else if("output"===m){const e=null===p||void 0===p?void 0:p.find((e=>e.isAnalysis)),o=I.mapInfo.vectorTile;if(!P&&!o||!E||!e)return $e.postMessage({});const r=null===C||void 0===C?void 0:C.mapInfo.vectorTile;try{if(!o&&!r){const o=_.output({layer:I,analysisLayer:e,config:t,overlayLayer:C,tableNode:P});if(o instanceof Promise){const e=await o;return void $e.postMessage({rows:e,progress:g})}return void $e.postMessage({rows:o,progress:g})}$e.postMessage({progress:f,progressOnly:!0});let a=I,n=C;const i=o&&r,s=2,l=49,u=l-s,c=Math.floor(u/2)+s,d=c-s,p=l-c;if(o&&null!==h&&void 0!==h&&h.signedUrl){const e=await et(h.signedUrl,t.bbox,((e,t)=>{const o=i?d:u,r=Math.min(s+Math.floor(e/t*o),s+o);$e.postMessage({progress:r,progressOnly:!0})}));a={...I,features:e}}if(r&&null!==M&&void 0!==M&&M.signedUrl){const e=await et(M.signedUrl,t.bbox,((e,t)=>{const o=i?c:s,r=i?p:u,a=Math.min(o+Math.floor(e/t*r),o+r);$e.postMessage({progress:a,progressOnly:!0})}));n={...C,features:e}}const m=_.transform({layer:a,config:t,overlayLayer:n});if(!m)return $e.postMessage({});const y={...a,features:m.features},v=_.output({layer:a,analysisLayer:y,config:t,overlayLayer:n,tableNode:P});if(v instanceof Promise){const e=await v;$e.postMessage({rows:e,progress:g})}else $e.postMessage({rows:v,progress:g})}catch(A){$e.postMessage({})}}else $e.postMessage({})}}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=e,o.x=()=>{var e=o.O(void 0,[24,638,790,698,416,26],(()=>o(23669)));return e=o.O(e)},(()=>{var e=[];o.O=(t,r,a,n)=>{if(!r){var i=1/0;for(c=0;c<e.length;c++){r=e[c][0],a=e[c][1],n=e[c][2];for(var s=!0,l=0;l<r.length;l++)(!1&n||i>=n)&&Object.keys(o.O).every((e=>o.O[e](r[l])))?r.splice(l--,1):(s=!1,n<i&&(i=n));if(s){e.splice(c--,1);var u=a();void 0!==u&&(t=u)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[r,a,n]}})(),o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;o.t=function(r,a){if(1&a&&(r=this(r)),8&a)return r;if("object"===typeof r&&r){if(4&a&&r.__esModule)return r;if(16&a&&"function"===typeof r.then)return r}var n=Object.create(null);o.r(n);var i={};e=e||[null,t({}),t([]),t(t)];for(var s=2&a&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>i[e]=()=>r[e]));return i.default=()=>r,o.d(n,i),n}})(),o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,r)=>(o.f[r](e,t),t)),[])),o.u=e=>698===e?"static/js/698.4d2febf4.chunk.js":26===e?"static/js/26.6364e3a1.chunk.js":"static/js/"+(24===e?"antd":e)+"."+{24:"3076b2a8",416:"6451f53e",638:"48b925df",790:"9bc4fae2"}[e]+".js",o.miniCssF=e=>{},o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=319,o.p="./",(()=>{var e={319:1};o.f.i=(t,r)=>{e[t]||importScripts(o.p+o.u(t))};var t=self.webpackChunkmaptable_frontend=self.webpackChunkmaptable_frontend||[],r=t.push.bind(t);t.push=t=>{var a=t[0],n=t[1],i=t[2];for(var s in n)o.o(n,s)&&(o.m[s]=n[s]);for(i&&i(o);a.length;)e[a.pop()]=1;r(t)}})(),(()=>{var e=o.x;o.x=()=>Promise.all([24,638,790,698,416,26].map(o.e,o)).then(e)})();o.x()})();
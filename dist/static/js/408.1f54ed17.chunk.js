"use strict";(self.webpackChunkmaptable_frontend=self.webpackChunkmaptable_frontend||[]).push([[408],{85521:(e,t,i)=>{i.d(t,{ef:()=>ge,rK:()=>de,c9:()=>le});var n=i(57435),o=i(95620),l=i(75605),a=i(73656),s=i(27371),d=i(71105),r=i(15905),u=i(7639),c=i(89166),v=i(79246),m=i(93862),p=i(48305),h=i(32783),f=i(17778),g=i(88338),b=i(89677),y=i(7070),C=i.n(y),x=i(18765),_=i.n(x),w=i(34362),I=i.n(w),j=i(19087),k=i.n(j),D=i(33718),N=i(83580),E=i(75801);const T={actions:"attachmentItem_actions__rLfov",action:"attachmentItem_action__3+szv",actionDelete:"attachmentItem_actionDelete__b8MUz",preview:"attachmentItem_preview__M21Wc",name:"attachmentItem_name__WpfuX",image:"attachmentItem_image__TMD07"},M={fileIcon:"icons_fileIcon__4LDyi",pdf:"icons_pdf__k3jaC",html:"icons_html__dqK5n",docx:"icons_docx__ahPkq",doc:"icons_doc__0RYi0",mp3:"icons_mp3__DJZ3t",dwg:"icons_dwg__MsEjg",psd:"icons_psd__8ELyW",jpg:"icons_jpg__QQIpf",jpeg:"icons_jpeg__6XN7p",mp4:"icons_mp4__IkTbE",png:"icons_png__yLijE",svg:"icons_svg__0Gqat",com:"icons_com__+FUtX",eps:"icons_eps__69DQp",unknown:"icons_unknown__con-w",txt:"icons_txt__nV+Uy",avi:"icons_avi__hcPkG",ppt:"icons_ppt__y6xTK",xls:"icons_xls__vi7mw",gif:"icons_gif__dzlsm",ttf:"icons_ttf__SzqjQ",zip:"icons_zip__WzDiv",apk:"icons_apk__QGHU1",ai:"icons_ai__E1Gfo"};var S=i(94553);const P=e=>{let{attachment:t,onClick:i,onDeleteClick:o,onEditClick:l}=e;const{fileID:a,fileName:s,url:d,fileExt:r}=t,{entity:u}=(0,E.$1)(E.vK.attachment),{useShareParams:c,isPdfPreview:v,isImagePreview:m,download:p,getSignedUrlForDownload:y,ableToPreview:C}=u,[x,_]=(0,n.useState)(!1),[w,I]=(0,n.useState)(""),{shareParams:j}=c();return(0,n.useEffect)((()=>{!async function(){const e=await y(d,j,134);I(e.detail)}()}),[d,j,y]),(0,S.jsxs)("div",{className:T.item,children:[(0,S.jsxs)("div",{className:T.preview,onClick:function(){C(r)&&i(a)},role:"listitem","data-id":a,children:[function(){var e;return m(r)?(0,S.jsx)("div",{className:T.image,style:{backgroundImage:"url(".concat(w,")")},title:s}):v(r)?(0,S.jsx)("div",{title:s,className:(0,D.default)(M.fileIcon,M[r])}):(0,S.jsx)("div",{title:s,className:(0,D.default)(M.fileIcon,null!==(e=M[r])&&void 0!==e?e:M.unknown)})}(),(0,S.jsxs)("div",{className:T.actions,children:[(0,S.jsx)("div",{className:T.action,onClick:function(e){e.stopPropagation(),l(a,s)},children:(0,S.jsx)(h.Z,{})}),(0,S.jsx)("div",{className:T.action,onClick:async function(e){if(e.stopPropagation(),!x){_(!0);try{await p(d,j)}finally{_(!1)}}},children:x?(0,S.jsx)(f.Z,{}):(0,S.jsx)(g.Z,{})}),(0,S.jsx)("div",{className:(0,D.default)(T.action,T.actionDelete),onClick:function(e){e.stopPropagation(),o(a)},children:(0,S.jsx)(b.Z,{})})]})]}),(0,S.jsx)("div",{className:T.name,children:s})]})};var R=i(11972),A=i(9979),Z=i(6708),F=i(68429);const O="attachmentPreview_modal__9NCfT",L="attachmentPreview_header__lW9wh",$="attachmentPreview_title__NmGCt",G="attachmentPreview_closeIcon__zABtr",B="attachmentPreview_content__CFINf",H="attachmentPreview_carouselWrap__P6RIn",V="attachmentPreview_previewItem__iMk6T",K="attachmentPreview_imageWrap__4jceT",z="attachmentPreview_pdfWrap__CKrbL",U="attachmentPreview_image__0Gbu2",q="attachmentPreview_prev__HrDvX",W="attachmentPreview_next__DOPVX",J="attachmentPreview_noPreview__Tj6T2",Y="attachmentPreview_footer__vAH+6",X="attachmentPreview_actions__yla0N",Q="attachmentPreview_action__jF8oS",ee="attachmentPreview_actionDelete__-J4Nr",te=e=>{let{title:t,onClose:i}=e;return(0,S.jsxs)("div",{className:L,children:[(0,S.jsx)(F.Z,{type:"close",className:G,onClick:i}),(0,S.jsx)("h3",{className:$,children:t})]})},ie=e=>{var t,i;let{dialog:l,attachments:a,currentPreviewId:s,isThirdPartyTable:d,onDeleteClick:r,onEditClick:u,onClose:c}=e;const v=(0,o.Z)(),{entity:m}=(0,E.$1)(E.vK.attachment),{useShareParams:p,isPdfPreview:y,isImagePreview:x,download:w,exportDataURL:j,useAttachmentPreview:k,getSignedUrlForDownload:T,isMobile:M}=m,[P,F]=(0,n.useState)([]),{carouselWrap:L,carousel:$,currentAttachment:G,index:ie,setIndex:ne}=k(a,V,l.visible,s,d),[oe,le]=(0,n.useState)({}),{shareParams:ae}=p();function se(){ne(-1),l.close(),null===c||void 0===c||c()}return(0,n.useEffect)((()=>{if(d)for(const e of a)le((t=>Object.assign({...t,[e.fileID]:e})));else!async function(){for(const e of a){const t=await T(e.url,ae);le((i=>Object.assign({...i,[e.fileID]:t.detail})))}}()}),[a,ae,d,T]),(0,S.jsx)(N.Vq,{className:O,closable:!1,width:"100%",styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.9)"}},visible:l.visible,onCancel:se,title:(0,S.jsx)(te,{title:null!==(t=null===G||void 0===G?void 0:G.fileName)&&void 0!==t?t:"",onClose:se}),destroyOnHidden:!0,footer:null,children:(0,S.jsxs)("div",{className:B,children:[(0,S.jsxs)("div",{ref:L,className:H,children:[(0,S.jsx)("div",{className:q,onClick:function(){var e;0!==ie&&(null===(e=$.current)||void 0===e||e.prev())},children:(0,S.jsx)(A.Z,{})}),(0,S.jsx)("div",{className:W,onClick:function(){var e;ie!==a.length-1&&(null===(e=$.current)||void 0===e||e.next())},children:(0,S.jsx)(Z.Z,{})}),(0,S.jsx)(R.Z,{ref:$,dots:!1,infinite:!1,beforeChange:function(e,t){ne(t)},children:C()(a,(e=>x(e.fileExt)?(0,S.jsx)("div",{className:(0,D.default)(K,V),children:(0,S.jsx)("img",{"data-url":e.url,alt:e.fileName,className:U})},e.fileID):y(e.fileExt)&&!M()?(0,S.jsx)("div",{className:(0,D.default)(z,V),children:(0,S.jsx)("embed",{"data-url":e.url,type:"application/pdf",height:"100%",width:"100%"})},e.fileID):(0,S.jsx)("div",{className:V,children:(0,S.jsx)("div",{className:J,children:v.$t({id:"QpUuhy",defaultMessage:"Preview not supported yet"})})},e.fileID)))})]}),(0,S.jsx)("div",{className:Y,children:(0,S.jsxs)("div",{className:X,children:[u&&(0,S.jsx)("div",{className:Q,onClick:function(){G&&(null===u||void 0===u||u(G.fileID,G.fileName))},children:(0,S.jsx)(h.Z,{})}),(0,S.jsx)("div",{className:Q,onClick:async function(){var e;if(!G)return;const t=null!==(e=oe[G.fileID])&&void 0!==e?e:void 0;if(t){F((e=>[...e,t]));try{d?j(G.url,G.fileName):await w(t,ae,!1)}finally{F((e=>_()(e,(e=>e!==t))))}}},children:I()(P,oe[null!==(i=null===G||void 0===G?void 0:G.fileID)&&void 0!==i?i:""])?(0,S.jsx)(f.Z,{}):(0,S.jsx)(g.Z,{})}),r&&(0,S.jsx)("div",{className:(0,D.default)(Q,ee),onClick:function(){G&&(null===r||void 0===r||r(null===G||void 0===G?void 0:G.fileID))},children:(0,S.jsx)(b.Z,{})})]})})]})})},ne={uploadTitle:"attachment_uploadTitle__NZ1ON",tip:"attachment_tip__Hiy2Z",list:"attachment_list__0j8we",file:"attachment_file__Tyq45",imageWrap:"attachment_imageWrap__rxTkc",image:"attachment_image__r57GP",fileList:"attachment_fileList__q-FF2",header:"attachment_header__w0oRI",headerIcon:"attachment_headerIcon__jeriv",active:"attachment_active__kFjVD",actions:"attachment_actions__rsODJ",deleteIcon:"attachment_deleteIcon__Hlo24",addButton:"attachment_addButton__5G4Kk",addWrap:"attachment_addWrap__uvdpP"},oe={low:20,middle:42,high:92};function le(e){const{value:t,rowHeight:i,imageHeight:n,imageStyle:o,isThirdPartyTable:l,onClickAttachment:a}=e,{isImagePreview:s,getPreGeneratedThumbnail:d}=e.injector.get(E.vK.attachment),r=n||oe[i||"low"],u="square"===o;return(0,S.jsxs)("div",{className:(0,D.default)(ne.list,e.className),"data-attachment":"list","data-rowheight":i,style:n?{"--item-height":"".concat(n,"px")}:void 0,children:[e.showEditButton&&(0,S.jsx)("div",{className:ne.addWrap,children:(0,S.jsx)("div",{className:ne.addButton,"data-attachment":"add",children:(0,S.jsx)(v.Z,{})})}),C()(t,((t,i)=>{var n;const o=s(t.fileExt),c=l?t.url:d(t.url),v=null!==t&&void 0!==t&&t.imageInfo?t.imageInfo.imageWidth*(128/t.imageInfo.imageHeight):128,m=u?r:r/128*v,p=t.fileID+"_"+i;return o?(0,S.jsx)("div",{title:t.fileName,className:ne.imageWrap,children:(0,S.jsx)("div",{role:"listitem",className:ne.image,style:{backgroundImage:"url(".concat(c,")"),backgroundPosition:"center"===e.imageResizeMode?"center":void 0,width:m},"data-id":t.fileID,"data-square":u,onClick:()=>null===a||void 0===a?void 0:a(t.fileID)})},p):(0,S.jsx)("div",{className:ne.file,children:(0,S.jsx)("i",{role:"listitem",title:t.fileName,"data-id":t.fileID,onClick:()=>null===a||void 0===a?void 0:a(t.fileID),className:(0,D.default)(M.fileIcon,null!==(n=M[t.fileExt])&&void 0!==n?n:M.unknown)})},p)}))]})}const{Dragger:ae}=l.default,{Column:se}=a.default,de=e=>{const{tableNodeId:t,hideRenderer:i,value:l,rowId:y,columnId:x}=e,{entity:w,dispatch:j,injector:T}=(0,E.$1)(E.vK.attachment),{useDialogState:M,useAttachmentTable:R,useShareParams:A,addAttachmentAction:Z,updateAttachment:F,deleteAttachment:O,combineFileNameWithExt:L,download:$,getFileExt:G,getPureFileName:B}=w,H=(0,o.Z)(),V=M(!1),K=M(!1),[z,U]=(0,n.useState)({id:"",name:"",ext:""}),[q,W]=(0,n.useState)(),[J,Y]=(0,n.useState)(l||[]),[X,Q]=(0,n.useState)("icon"),[ee,te]=(0,n.useState)([]),[oe,de]=(0,n.useState)(0),re=(0,n.useRef)(0),ue=(0,n.useRef)(k()),{dataSource:ce,columns:ve}=R(J),{shareParams:me}=A();async function pe(e){try{const{payload:i}=await j(Z({id:t,rowId:y,columnId:x,file:e}));Y((e=>[...e,i]))}catch(i){s.ZP.error(i.message)}finally{de((e=>--e))}}function he(e){W(e),V.open()}function fe(e,t){U({id:e,name:B(t),ext:G(t)}),K.open()}async function ge(e){await j(O({id:t,rowId:y,columnId:x,fileId:e,attachments:J})),Y((t=>_()(t,(t=>t.fileID!==e))))}async function be(e){var t;null!==(t=e.clipboardData)&&void 0!==t&&t.files[0]&&(re.current=1,de(1),pe(e.clipboardData.files[0])),e.stopPropagation()}return(0,n.useEffect)((()=>(document.body.addEventListener("paste",be),()=>document.body.removeEventListener("paste",be)))),(0,n.useEffect)((()=>{0!==oe&&oe===re.current&&(ue.current=s.ZP.loading(H.$t({id:"JEsxDw",defaultMessage:"Uploading..."}),0)),0===oe&&(ue.current(),re.current=0)}),[H,oe]),(0,S.jsxs)(S.Fragment,{children:[!i&&(0,S.jsx)(le,{value:J,injector:T,rowHeight:e.rowHeight}),(0,S.jsxs)(N.Vq,{width:640,title:H.$t({id:"VoO2ZL",defaultMessage:"List of attachments"}),visible:!0,onCancel:function(){var t,i;null===(t=e.stopEditing)||void 0===t||t.call(e),null===(i=e.onCancel)||void 0===i||i.call(e)},footer:null,children:[(0,S.jsxs)(ae,{multiple:!0,beforeUpload:function(e,t){return re.current=t.length,de(t.length),!0},customRequest:function(e){pe(e.file)},showUploadList:!1,children:[(0,S.jsxs)("div",{className:ne.uploadTitle,children:[(0,S.jsx)(v.Z,{}),H.$t({id:"Ye0Clm",defaultMessage:"Attach"})]}),(0,S.jsx)("p",{className:ne.tip,children:H.$t({id:"aXcM/Y",defaultMessage:"Click to upload or drag and drop files here"})})]}),(0,S.jsxs)("div",{className:ne.fileList,children:[(0,S.jsx)(d.Z,{justify:"end",className:ne.header,children:(0,S.jsxs)(r.Z,{children:[(0,S.jsxs)("div",{className:(0,D.default)(ne.headerIcon,{[ne.active]:"table"===X}),onClick:()=>Q("table"),children:[(0,S.jsx)(m.Z,{}),H.$t({id:"nOk9mh",defaultMessage:"List"})]}),(0,S.jsxs)("div",{className:(0,D.default)(ne.headerIcon,{[ne.active]:"icon"===X}),onClick:()=>Q("icon"),children:[(0,S.jsx)(p.Z,{}),H.$t({id:"kk4TVW",defaultMessage:"Icon"})]})]})}),"table"===X?(0,S.jsxs)(a.default,{dataSource:ce,className:ne.table,pagination:!1,size:"small",bordered:!0,children:[C()(ve,(e=>(0,S.jsx)(se,{title:e.title,dataIndex:e.dataIndex},e.key))),(0,S.jsx)(se,{title:H.$t({id:"wL7VAE",defaultMessage:"Actions"}),render:e=>(0,S.jsxs)("div",{className:ne.actions,children:[(0,S.jsx)(h.Z,{onClick:()=>fe(e.id,e.name)}),I()(ee,e.url)?(0,S.jsx)(f.Z,{}):(0,S.jsx)(g.Z,{onClick:()=>async function(e,t){te((t=>[...t,e]));try{await $(e,me)}finally{te((t=>_()(t,(t=>t!==e))))}}(e.url,e.name)}),(0,S.jsx)(b.Z,{className:ne.deleteIcon,onClick:()=>ge(e.id)})]})})]}):(0,S.jsxs)(d.Z,{gutter:[16,20],children:[C()(J,(e=>(0,S.jsx)(r.Z,{span:6,children:(0,S.jsx)(P,{attachment:e,onClick:he,onDeleteClick:ge,onEditClick:fe})},e.fileID))),(0,S.jsx)(ie,{currentPreviewId:q,dialog:V,attachments:J,onDeleteClick:ge,onEditClick:fe,onClose:()=>W(void 0)})]})]}),(0,S.jsx)(N.Vq,{width:380,title:H.$t({id:"iXNbPf",defaultMessage:"Rename"}),footer:null,visible:K.visible,onCancel:()=>K.close(),children:(0,S.jsxs)(d.Z,{gutter:10,children:[(0,S.jsx)(r.Z,{span:18,children:(0,S.jsx)(u.default,{value:z.name,onChange:function(e){U((t=>({...t,name:B(e.target.value)})))}})}),(0,S.jsx)(r.Z,{span:6,children:(0,S.jsx)(c.ZP,{type:"primary",onClick:async function(){const e=L(z.name,z.ext);await j(F({id:t,rowId:y,columnId:x,fileId:z.id,name:e})),K.close(),Y((t=>C()(t,(t=>t.fileID===z.id?{...t,fileName:e}:t))))},children:H.$t({id:"N2IrpM",defaultMessage:"Confirm"})})})]})})]})]})};var re=i(57323),ue=i.n(re),ce=i(46940),ve=i(74720),me=i.n(ve),pe=i(17646),he=i.n(pe),fe=i(98030);class ge extends fe.Z{constructor(){super(...arguments),ue()(this,"uploadAttachment",(async(e,t)=>{var i;const{formatMessage:n,uploadFile:o,addAttachment:l}=this.params.context.injector.get(E.vK.attachment),a=null===e||void 0===e?void 0:e.tableNodeId,d=null===e||void 0===e||null===(i=e.column)||void 0===i?void 0:i.getColId(),r=null===e||void 0===e?void 0:e.data.id,u=null===e||void 0===e?void 0:e.api.getFocusedCell();if(u&&u.column.getColId()===d){var c;if((null===e||void 0===e||null===(c=e.api.getDisplayedRowAtIndex(u.rowIndex))||void 0===c?void 0:c.id)===r&&a&&d){const e=s.ZP.loading(n({id:"JEsxDw",defaultMessage:"Uploading..."}),0);try{const e=await o("attachment",t);await l(a,r,d,e),s.ZP.success(n({id:"h8TY++",defaultMessage:"File uploaded successfully"}))}finally{e()}}}})),ue()(this,"handlePaste",(e=>{var t;(null===(t=e.clipboardData)||void 0===t?void 0:t.files[0])&&this.uploadAttachment(this.params,e.clipboardData.files[0])})),ue()(this,"handleDrop",(async e=>{if(e.preventDefault(),e.dataTransfer&&e.dataTransfer.items.length>0){const t=(e=>{const t=[];return he()(e,(e=>{if("file"===e.kind){const i=e.getAsFile();i&&t.push(i)}})),t})(e.dataTransfer.items);for(let e=0;e<t.length;e++)await this.uploadAttachment(this.params,t[e])}})),ue()(this,"handleDragOver",(e=>{e.preventDefault()})),ue()(this,"handlePreviewClick",(e=>{const{previewAttachmentEmitter:t}=this.params.context.injector.get(E.vK.attachment),i=me()(e.target,"dataset.id");i&&t.emit({currentPreviewId:i,attachments:this.value})}))}init(e){var t,i,n,o;this.value=null===e||void 0===e?void 0:e.realValue,this.params=e,this.checkSubscribed();const l=this.createEL();var a,s;(l.innerHTML=ce.renderToStaticMarkup((0,S.jsx)(le,{rowHeight:null===(t=this.params)||void 0===t?void 0:t.rowHeight,value:this.value,showEditButton:null===e||void 0===e?void 0:e.editable,injector:this.params.context.injector})),this.attachmentListEL=l.querySelector('[data-attachment="list"]'),this.addButtonEl=l.querySelector('[data-attachment="add"]'),null===(i=this.attachmentListEL)||void 0===i||i.addEventListener("click",this.handlePreviewClick),null===(n=this.addButtonEl)||void 0===n||n.addEventListener("click",this.startEditing),this.eGui=this.withDecoration(l,null===(o=this.params)||void 0===o?void 0:o.collaborator,ce.renderToStaticMarkup((0,S.jsx)(F.Z,{type:"sync"}))),null!==e&&void 0!==e&&e.editable)&&(document.addEventListener("paste",this.handlePaste),null===(a=this.eGui)||void 0===a||a.addEventListener("dragover",this.handleDragOver),null===(s=this.eGui)||void 0===s||s.addEventListener("drop",this.handleDrop))}getGui(){return this.eGui}destroy(){var e,t,i,n;null===(e=this.attachmentListEL)||void 0===e||e.removeEventListener("click",this.handlePreviewClick),null===(t=this.addButtonEl)||void 0===t||t.removeEventListener("click",this.startEditing),document.removeEventListener("paste",this.handlePaste),null===(i=this.eGui)||void 0===i||i.removeEventListener("dragover",this.handleDragOver),null===(n=this.eGui)||void 0===n||n.removeEventListener("drop",this.handleDrop)}}},85790:(e,t,i)=>{i.d(t,{t:()=>b,v:()=>u});var n=i(33718);const o="boolean_wrap__XxaH2",l="boolean_checkbox__SGvf+",a="boolean_inGrid__a2hz4",s="boolean_checked__V6Op5",d="boolean_inputWrap__kc4pr";var r=i(94553);const u=e=>{const{value:t,onChange:i,inGrid:u,disabled:c=!1,className:v}=e;return"number"===typeof t||"string"===typeof t?(0,r.jsx)("div",{children:t}):(0,r.jsx)("div",{className:(0,n.default)(v,o),children:(0,r.jsx)("div",{className:(0,n.default)(l,!!t&&s,{[a]:u}),"data-checkbox":"check",children:(0,r.jsx)("div",{className:d,children:(0,r.jsx)("input",{className:"ag-input-field-input ag-checkbox-input",type:"checkbox",disabled:c,checked:!!t,onChange:function(e){null===i||void 0===i||i(!!e.target.checked||null)}})})})})};var c=i(57323),v=i.n(c),m=i(74720),p=i.n(m),h=i(46940),f=i(68429),g=i(98030);class b extends g.Z{constructor(){super(...arguments),v()(this,"handleClick",(()=>{var e,t;const i=!p()(this.inputEl,"checked");null===(e=this.params)||void 0===e||null===(t=e.setValue)||void 0===t||t.call(e,i||null)})),v()(this,"handleChange",(e=>{var t,i;const n=p()(e.target,"checked");null===(t=this.params)||void 0===t||null===(i=t.setValue)||void 0===i||i.call(t,n||null)}))}init(e){var t,i;this.value=null===e||void 0===e?void 0:e.realValue,this.params=e;const n=this.createEL();var o,l;(this.checkSubscribed(),n.innerHTML=h.renderToStaticMarkup((0,r.jsx)(u,{value:this.value,inGrid:!0})),null!==(t=this.params)&&void 0!==t&&t.editable)&&(this.inputEl=n.querySelector('input[type="checkbox"]'),null===(o=this.inputEl)||void 0===o||o.addEventListener("change",this.handleChange),this.wrapEL=n.querySelector('[data-checkbox="check"]'),null===(l=this.wrapEL)||void 0===l||l.addEventListener("dblclick",this.handleClick));this.eGui=this.withDecoration(n,null===(i=this.params)||void 0===i?void 0:i.collaborator,h.renderToStaticMarkup((0,r.jsx)(f.Z,{type:"sync"})))}getGui(){return this.eGui}destroy(){var e,t;null===(e=this.inputEl)||void 0===e||e.removeEventListener("change",this.handleChange),null===(t=this.wrapEL)||void 0===t||t.removeEventListener("dblclick",this.handleClick)}}},98030:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(57323),o=i.n(n),l=i(88716),a=i.n(l),s=i(75801);class d{constructor(){o()(this,"startEditing",(()=>{var e,t;null===(e=this.params)||void 0===e||e.api.startEditingCell({colKey:null===(t=this.params)||void 0===t||null===(t=t.column)||void 0===t?void 0:t.getColId(),rowIndex:this.params.node.rowIndex})}))}refresh(e){return!1}createEL(){const e=document.createElement("div");return e.className="mt-grid-cell-container",this.eGui=e,e}checkSubscribed(){var e,t;this.subscribed="subscribed"===(null===(e=this.params)||void 0===e||null===(e=e.colDef)||void 0===e||null===(e=e.headerComponentParams)||void 0===e?void 0:e.mode)||"connected"===(null===(t=this.params)||void 0===t||null===(t=t.colDef)||void 0===t||null===(t=t.headerComponentParams)||void 0===t?void 0:t.mode)||!1}withDecoration(e,t,i){var n,o,l;const a=null===(n=this.params)||void 0===n||null===(n=n.column)||void 0===n?void 0:n.getColId(),s=null===(o=this.params)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.id,d=null===(l=this.params)||void 0===l||null===(l=l.api)||void 0===l?void 0:l.getFocusedCell();if(this.subscribed&&d&&d.column.getColId()===a){var r;if((null===(r=this.params)||void 0===r||null===(r=r.api.getDisplayedRowAtIndex(d.rowIndex))||void 0===r?void 0:r.id)===s)return this.withSubscribed(e,i)}return this.withCollaborators(e,t)}withSubscribed(e,t){var i,n;const o=null===(i=this.params)||void 0===i?void 0:i.context.injector,l=null===o||void 0===o?void 0:o.get(s.vK.common),{formatMessage:a}=l,d=document.createElement("div");d.setAttribute("data-subscribe-cell","true"),d.style.borderColor="transparent",d.innerHTML=null!==t&&void 0!==t?t:"";const r=document.createElement("span");r.innerText=null!==(n=a({id:"qkiJvR",defaultMessage:"This field is synced and cannot be edited"}))&&void 0!==n?n:"",d.append(r);const u=document.createElement("div");return u.style.height="100%",u.append(d),u.append(e),u}withCollaborators(e,t){if(t&&!a()(null===t||void 0===t?void 0:t.name)){const{name:i=[],color:n="transparent"}=t,o=document.createElement("div");o.setAttribute("data-collaborator-cell","true"),o.style.borderColor=n,o.className="ag-grid-collaborator-cell";const l=document.createElement("span");l.style.backgroundColor=n,l.innerText=i.join(","),o.append(l);const a=document.createElement("div");return a.style.height="100%",a.append(o),a.append(e),a}return e}}},49544:(e,t,i)=>{i.d(t,{Vy:()=>M,xM:()=>C,nV:()=>f,Io:()=>D});var n=i(57435),o=i(19087),l=i.n(o),a=i(43179),s=i.n(a),d=i(57875),r=i(50602),u=i(57316),c=i(75801),v=i(57878);const m="datetime_datePicker__lRfee",p="datetime_popup__7Vj17";var h=i(94553);const f=e=>{const{entity:t}=(0,c.$1)(c.vK.datetime),{dateTimezoneToLocal:i,useDatetimeFormat:o,dateLocalToTimezone:a}=t,{inGrid:f=!1,disabled:g,placeholder:b,size:y="middle",timezone:C,needConfirm:x=!1}=e,_=i(e.value,C),{onBlur:w=l(),onChange:I,stopEditing:j}=e,{typeOptions:k}=(0,v.P)(e),[D,N]=(0,n.useState)(!1),E=(0,n.useRef)(null),T=(0,n.useRef)(null),M=o(k,C),S=(0,n.useRef)(!1);function P(e){var t;return(null===(t=a(e,C))||void 0===t?void 0:t.format(u.G1))||null}function R(){var e;const t=null===(e=T.current)||void 0===e||null===(e=e.querySelector("input"))||void 0===e?void 0:e.value;return s()(t)}function A(e){Array.isArray(e)||null===I||void 0===I||I(P(e))}return(0,n.useEffect)((()=>{var t;(e.eventKey&&e.eventKey.match(/\d/)&&setTimeout((()=>{var t;const i=null===(t=T.current)||void 0===t?void 0:t.querySelector("input");i&&(i.value=e.eventKey)})),f)&&(null===(t=E.current)||void 0===t||t.focus())}),[e.eventKey,f,I]),(0,n.useEffect)((()=>{function e(e){var t,i,n,o,l;null!==(t=document.getElementsByClassName(p))&&void 0!==t&&null!==(t=t[0])&&void 0!==t&&t.contains(e.target)||null!==(i=T.current)&&void 0!==i&&i.contains(e.target)||null!==(n=e.target)&&void 0!==n&&null!==(n=n.className)&&void 0!==n&&null!==(o=n.includes)&&void 0!==o&&o.call(n,"mt-picker")||(S.current=!1,null===(l=E.current)||void 0===l||l.blur())}return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}}),[]),(0,d.E9)({isCancelAfterEnd:()=>!R().isValid()&&(!_&&null!==_)}),(0,h.jsx)("div",{ref:T,children:(0,h.jsx)(r.Z,{ref:E,className:m,popupClassName:p,format:M,allowClear:!0,variant:f?"borderless":"outlined",showTime:"hidden"!==(null===k||void 0===k?void 0:k.timeFormat),autoFocus:f,open:D,value:_,disabled:g,needConfirm:x,onCalendarChange:A,onChange:A,onBlur:function(){var e;S.current?null===(e=E.current)||void 0===e||e.focus():(w(P(_)),N(!1),null===j||void 0===j||j())},onFocus:function(){S.current=!0,N(!0)},onOk:function(){N(!1),null===j||void 0===j||j()},onKeyDown:function(e){const t=e.target;"Enter"===e.key&&(""===t.value&&(null===I||void 0===I||I(null)),null===I||void 0===I||I(P(R())),null===j||void 0===j||j())},placeholder:b,size:y})})};var g=i(95620),b=i(89614),y=i(83580);const C=e=>{let{form:t,config:i}=e;const o=(0,g.Z)(),[l]=b.Z.useForm(),a={dateFormat:"year/month/day",timeFormat:"hidden",showTimezone:!1,...i};return(0,n.useImperativeHandle)(t,(()=>l)),(0,h.jsxs)(b.Z,{name:"datetime",form:l,labelAlign:"left",labelCol:{span:8},wrapperCol:{span:16},initialValues:a,children:[(0,h.jsx)(b.Z.Item,{label:o.$t({id:"zQLEfz",defaultMessage:"Format"}),name:"dateFormat",children:(0,h.jsx)(y.Ph,{options:(0,u.by)(o)})}),(0,h.jsx)(b.Z.Item,{label:o.$t({id:"VZAOCm",defaultMessage:"Show time"}),name:"timeFormat",children:(0,h.jsx)(y.Ph,{options:(0,u.wU)(o)})}),(0,h.jsx)(b.Z.Item,{label:o.$t({id:"BxCn3Z",defaultMessage:"Show time zone"}),name:"showTimezone",children:(0,h.jsx)(y.Ph,{options:(0,u.rm)(o)})})]})};var x=i(7070),_=i.n(x),w=i(75538),I=i.n(w),j=i(78587),k=i.n(j);const D=n.forwardRef(((e,t)=>{const{value:i,typeOptions:o,timezone:l,injector:a}=e,{formatDateByRule:s}=a.get(c.vK.datetime),d=(0,n.useMemo)((()=>k()(i)?I()(_()(i,(e=>s(e,o,l))),", "):i?s(i,o,l):""),[i,o,l,s]);return(0,n.useImperativeHandle)(t,(()=>({getValue:()=>e.value}))),(0,h.jsx)("div",{children:d})}));var N=i(46940),E=i(68429),T=i(98030);class M extends T.Z{init(e){var t,i;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const n=this.createEL();n.innerHTML=N.renderToStaticMarkup((0,h.jsx)(D,{value:this.value,typeOptions:this.typeOptions,timezone:null===(t=this.params)||void 0===t?void 0:t.timezone,injector:this.params.context.injector})),this.eGui=this.withDecoration(n,null===(i=this.params)||void 0===i?void 0:i.collaborator,N.renderToStaticMarkup((0,h.jsx)(E.Z,{type:"sync"})))}getGui(){return this.eGui}}},28827:(e,t,i)=>{i.d(t,{eD:()=>u,Cz:()=>p,jT:()=>a});var n=i(75801);const o={link:"hyperlinkRenderer_link__87TfP"};var l=i(94553);function a(e){const{value:t,injector:i}=e,{formatHyperlink:a}=i.get(n.vK.hyperlink);return function(e){try{return new URL(e||""),!0}catch{return!1}}(t)?t?(0,l.jsx)("a",{href:a(t),className:o.link,target:"_blank",rel:"noreferrer",children:t}):null:(0,l.jsx)("div",{children:t})}var s=i(46940),d=i(68429),r=i(98030);class u extends r.Z{init(e){var t;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const i=this.createEL();i.innerHTML=s.renderToStaticMarkup((0,l.jsx)(a,{value:this.value,injector:this.params.context.injector})),this.eGui=this.withDecoration(i,null===(t=this.params)||void 0===t?void 0:t.collaborator,s.renderToStaticMarkup((0,l.jsx)(d.Z,{type:"sync"})))}getGui(){return this.eGui}}var c=i(57435),v=i(7639);const m="hyperlinkEditor_input__9LxSB",p=e=>{const{inGrid:t,value:i,onBlur:n,onPressEnter:o,onChange:a}=e,s=(0,c.useRef)(null);return(0,c.useEffect)((()=>{var e;t&&(null===(e=s.current)||void 0===e||e.focus())}),[t]),(0,l.jsx)(v.default,{ref:s,className:m,value:i,variant:t?"borderless":"outlined",autoFocus:t,onChange:e=>null===a||void 0===a?void 0:a(e.target.value),onBlur:function(){var t;null===n||void 0===n||n(i),null===(t=e.stopEditing)||void 0===t||t.call(e)},onKeyDown:function(e){"Enter"===e.key&&(e.shiftKey?e.stopPropagation():null===o||void 0===o||o(i))},onMouseDown:e=>e.stopPropagation()})}},31973:(e,t,i)=>{i.d(t,{tt:()=>me,YO:()=>$,C2:()=>ae});var n=i(57435),o=i(95620),l=i(89614),a=i(47752),s=i(79246),d=i(33718),r=i(59267),u=i.n(r),c=i(88716),v=i.n(c),m=i(17646),p=i.n(m),h=i(68429),f=i(11546),g=i(83580),b=i(75801),y=i(71105),C=i(15905),x=i(7070),_=i.n(x),w=i(23903),I=i.n(w),j=i(55349),k=i.n(j),D=i(8942),N=i.n(D),E=i(22601);const T="lookupFilterItem_option__3MiJ3",M="lookupFilterItem_optionCell__asF5o",S="lookupFilterItem_bg__DSrXX",P="lookupFilterItem_noPadding__OYu18",R="lookupFilterItem_iconCell__tZB2g",A="lookupFilterItem_selectOption__HF53J",Z="lookupFilterItem_close__xSN7i";var F=i(94553);const O=e=>{var t,i,l,a;const{disabled:s,index:r,filter:u,onRemove:c,onChange:v,columnsForFilter:m,columnsForFilterValue:p,columnsObj:b,valueColumnsObj:x}=e,[w,j]=(0,n.useState)(u),[D,O]=(0,n.useState)(u),L=(0,o.Z)(),$=(0,n.useCallback)((()=>{var e;return(0,E.Xn)(null===(e=w.op)||void 0===e?void 0:e.key)?k()(w.valueField):!k()(w.valueField)}),[w]);(0,n.useEffect)((()=>{u&&!N()(u,D)&&(O(u),j(u))}),[u,D]),(0,n.useEffect)((()=>{w.field&&w.op&&$()&&!N()(w,D)&&(null===v||void 0===v||v(r,w))}),[$,r,w,D,v]);return(0,F.jsxs)(y.Z,{className:T,gutter:[16,0],children:[(0,F.jsx)(C.Z,{span:1,children:r>0&&(0,F.jsx)("div",{className:(0,d.default)(M,R),onClick:()=>null===c||void 0===c?void 0:c(r),children:(0,F.jsx)(h.Z,{type:"close",className:Z})})}),(0,F.jsx)(C.Z,{span:8,children:(0,F.jsx)("div",{className:(0,d.default)(M,P),children:(0,F.jsx)(g.Ph,{disabled:s,onChange:e=>{j((t=>({...t,field:null===b||void 0===b?void 0:b[e],op:void 0,valueField:void 0})))},value:null===(t=w.field)||void 0===t?void 0:t.id,children:_()(m,(e=>{var t;return(0,F.jsx)(g.Ph.Option,{value:e.id,children:(0,F.jsxs)("div",{className:A,children:[(0,F.jsx)(h.Z,{type:null===(t=I()(f.Z9,(t=>t.type===e.type)))||void 0===t?void 0:t.icon}),e.name]})},e.id)}))})})}),(0,F.jsx)(C.Z,{span:7,children:(0,F.jsx)("div",{className:(0,d.default)(M,P),children:(0,F.jsx)(g.Ph,{disabled:s,onChange:function(e){let t;E.cd.forEach((i=>{i===e&&(t=E.fP[i],t&&j((e=>({...e,op:t,valueField:(0,E.Xn)(t.key)?null:e.valueField}))))}))},value:null===(i=w.op)||void 0===i?void 0:i.key,children:(()=>{if(b){var e,t;const i=null===(e=b[null===w||void 0===w||null===(t=w.field)||void 0===t?void 0:t.id])||void 0===e?void 0:e.type;return _()((0,E.xm)(i),(e=>(0,F.jsx)(g.Ph.Option,{value:e.key,children:(0,E.wn)(i,e,L)},e.key)))}})()})})}),(0,F.jsx)(C.Z,{span:8,children:(0,F.jsx)("div",{className:(0,d.default)(M,S,P),children:!(0,E.Xn)(null===(l=w.op)||void 0===l?void 0:l.key)&&(0,F.jsx)(g.Ph,{disabled:s,onChange:e=>{j((t=>({...t,valueField:null===x||void 0===x?void 0:x[e]})))},value:null===(a=w.valueField)||void 0===a?void 0:a.id,children:_()(p,(e=>{var t;return(0,F.jsx)(g.Ph.Option,{value:e.id,children:(0,F.jsxs)("div",{className:A,children:[(0,F.jsx)(h.Z,{type:null===(t=I()(f.Z9,(t=>t.type===e.type)))||void 0===t?void 0:t.icon}),e.name]})},e.id)}))})})})]})},L={form:"lookupConfig_form__9i8ku",label:"lookupConfig_label__VVpMJ",tooltip:"lookupConfig_tooltip__0FBgy",icon:"lookupConfig_icon__PfChy",hide:"lookupConfig_hide__iFe7C",filters:"lookupConfig_filters__LVwDz",addAction:"lookupConfig_addAction__vjIyc",condition:"lookupConfig_condition__uCBKv"};function $(e){var t;const{form:i,config:r}=e,{entity:c}=(0,b.$1)(b.vK.lookup),{useParameters:m,useWorkspaceRoles:y,useWorkspaces:C,useProject:x,useTableNodeDetail:_,getColumnExpectedType:w,getColumnExpectedTypeOption:I,getFilterOperators:j,OPERATORS:k}=c,D=(0,o.Z)(),[N]=l.Z.useForm(),{workspaceId:E,workspaceType:T,projectId:M,tableNodeId:S}=m(),{workspace:P}=C(T,E),{project:R}=x(P,M),[A,Z]=(0,n.useState)(null!==(t=null===r||void 0===r?void 0:r.lookupTableNodeID)&&void 0!==t?t:NaN),{data:$}=_(M,S),{data:G}=_(M,A),[B,H]=(0,n.useState)(),[V,K]=(0,n.useState)(),[z,U]=(0,n.useState)(),[q,W]=(0,n.useState)([]),{checkPermission:J}=y(),Y=[{id:"original",name:D.$t({id:"SX4gqQ",defaultMessage:"Original value"})},{id:"sum",name:D.$t({id:"YYkniy",defaultMessage:"Sum"})},{id:"count",name:D.$t({id:"Aujn2T",defaultMessage:"Count"})},{id:"distinct",name:D.$t({id:"n2CDJ0",defaultMessage:"Remove duplicates"})},{id:"countDistinct",name:D.$t({id:"xYLk08",defaultMessage:"Deduplication count"})},{id:"avg",name:D.$t({id:"gYB2lt",defaultMessage:"Mean"})},{id:"max",name:D.$t({id:"kkjl2v",defaultMessage:"Max"})},{id:"min",name:D.$t({id:"A4AHkc",defaultMessage:"Min"})}],X=[{id:"default",name:D.$t({id:"lKv8ex",defaultMessage:"Default"})},{id:"integer",name:D.$t({id:"Sx3lHL",defaultMessage:"Integer"})},{id:"1decimal",name:D.$t({id:"VCneIY",defaultMessage:"Keep 1 decimals"})},{id:"2decimal",name:D.$t({id:"XmKqNh",defaultMessage:"Keep 2 decimals"})},{id:"percentage",name:D.$t({id:"HyMpO2",defaultMessage:"Percentage"})},{id:"percentage2decimal",name:D.$t({id:"/4Pqx9",defaultMessage:"Percentage (decimal)"})},{id:"commaNumber",name:D.$t({id:"CX1Uj5",defaultMessage:"Thousands separator"})},{id:"commaNumber2decimal",name:D.$t({id:"4GijN5",defaultMessage:"Thousands sep. (decimal)"})}],Q=[{id:"AND",name:D.$t({id:"zQvVDJ",defaultMessage:"All"})},{id:"OR",name:D.$t({id:"ToO3/h",defaultMessage:"Any"})}],ee=(0,n.useCallback)((e=>!!u()(e)||J(e,"readonly","table")),[J]),te=(0,n.useMemo)((()=>!ee(A)),[A,ee]),ie=(0,n.useMemo)((()=>ee(A)?((null===R||void 0===R?void 0:R.tableNodes)||[]).filter((e=>"table"===e.type)):[{id:A,name:D.$t({id:"qfEivJ",defaultMessage:"No access to this linked table"})},...((null===R||void 0===R?void 0:R.tableNodes)||[]).filter((e=>"table"===e.type))]),[D,R,A,ee]),ne={lookupResultType:"original",lookupNumberFormat:"default",lookupFilterCondition:"AND",...r};(0,n.useImperativeHandle)(i,(()=>N));const oe=(0,n.useCallback)((e=>e?e.map((e=>({...e,type:w(e),typeOptions:I(e)}))).filter((e=>j(e.type))):[]),[w,I,j]),le=(0,n.useMemo)((()=>oe(null===G||void 0===G?void 0:G.columns)||[]),[G,oe]),ae=(0,n.useMemo)((()=>oe(null===$||void 0===$?void 0:$.columns)||[]),[$,oe]);(0,n.useEffect)((()=>{const e={};p()(le,(t=>e[t.id]=t)),K(e)}),[le]),(0,n.useEffect)((()=>{const e={};p()(ae,(t=>e[t.id]=t)),U(e)}),[ae]),(0,n.useEffect)((()=>{if(G)H((G.columns||[]).filter((e=>f.AR.includes(e.type))));else if(te){const e=N.getFieldValue("lookupColumnID");e&&H([{id:e,type:"multiLineText",name:D.$t({id:"qfEivJ",defaultMessage:"No access to this linked table"})}])}}),[D,G,te,N]),(0,n.useEffect)((()=>{const e=null===r||void 0===r?void 0:r.lookupFilters;if(!v()(e)&&!v()(V)&&!v()(z)){const t=[];p()(e,(e=>{const i=null===V||void 0===V?void 0:V[e.columnID],n=e.valueColumnID?null===z||void 0===z?void 0:z[e.valueColumnID]:void 0;var o,l;i&&t.push({op:k[e.relation],field:{id:i.id,type:i.type,name:i.name,typeOptions:null!==(o=i.typeOptions)&&void 0!==o?o:{}},valueField:n?{id:n.id,type:n.type,name:n.name,typeOptions:null!==(l=n.typeOptions)&&void 0!==l?l:{}}:void 0})})),v()(t)&&t.push({}),W(t)}}),[r,V,z,k]);const se=(0,n.useCallback)((e=>{Z(e),H(void 0),W([{}]),N.setFieldsValue({lookupColumnID:void 0})}),[N]),de=(0,n.useCallback)((e=>{const t=[];p()(e,(e=>{var i,n,o;e.field&&e.op&&t.push({columnID:null===(i=e.field)||void 0===i?void 0:i.id,relation:null===(n=e.op)||void 0===n?void 0:n.key,valueColumnID:null===(o=e.valueField)||void 0===o?void 0:o.id})})),W(e),N.setFieldsValue({lookupFilters:t})}),[N]),re=(0,n.useCallback)((()=>{q.length>0&&de([...q,{}])}),[q,de]),ue=(0,n.useCallback)((e=>{q.length>0&&de(q.filter(((t,i)=>i!==e)))}),[q,de]),ce=(0,n.useCallback)(((e,t)=>{q.length>0&&de(q.map(((i,n)=>n===e?t:i)))}),[q,de]);return(0,F.jsxs)(l.Z,{name:"lookup",colon:!1,form:N,labelAlign:"left",requiredMark:!1,labelCol:{span:6},wrapperCol:{span:24},initialValues:ne,className:L.form,children:[(0,F.jsx)(l.Z.Item,{label:(0,F.jsxs)("div",{className:L.label,children:[(0,F.jsx)("div",{children:D.$t({id:"wPtErq",defaultMessage:"Ref. data"})}),(0,F.jsx)(a.Z,{title:D.$t({id:"oFvtat",defaultMessage:"Table to reference"}),className:L.tooltip,children:(0,F.jsx)(h.Z,{type:"info"})})]}),name:"lookupTableNodeID",rules:[{required:!0,message:D.$t({id:"Oc3TkA",defaultMessage:"Please select a table"})}],children:(0,F.jsx)(g.Ph,{onChange:se,children:null===ie||void 0===ie?void 0:ie.map((e=>(0,F.jsxs)(g.Ph.Option,{value:e.id,disabled:!ee(e.id),children:[(0,F.jsx)(h.Z,{type:"table",className:L.icon})," ",e.name]},"t_".concat(e.id))))})}),(0,F.jsx)(l.Z.Item,{label:(0,F.jsxs)("div",{className:L.label,children:[(0,F.jsx)("div",{children:D.$t({id:"mlJO45",defaultMessage:"Ref. field"})}),(0,F.jsx)(a.Z,{title:D.$t({id:"zh5PNK",defaultMessage:"Field to reference"}),className:L.tooltip,children:(0,F.jsx)(h.Z,{type:"info"})})]}),name:"lookupColumnID",rules:[{required:!0,message:D.$t({id:"f2pRcj",defaultMessage:"Please select a field"})}],children:(0,F.jsx)(g.Ph,{disabled:te,children:null===B||void 0===B?void 0:B.map((e=>(0,F.jsxs)(g.Ph.Option,{value:e.id,children:[(0,F.jsx)(h.Z,{type:e.type,className:L.icon})," ",e.name]},"c_".concat(e.id))))})}),(0,F.jsx)(l.Z.Item,{label:D.$t({id:"cVA4Io",defaultMessage:"Find conditions"}),labelCol:{span:7},children:(0,F.jsxs)("div",{className:(0,d.default)(L.condition,q.length<2&&L.hide),children:[(0,F.jsx)("span",{children:D.$t({id:"Qr9R5O",defaultMessage:"Match"})}),(0,F.jsx)(l.Z.Item,{name:"lookupFilterCondition",rules:[{required:!0}],children:(0,F.jsx)(g.Ph,{options:null===Q||void 0===Q?void 0:Q.map((e=>({label:e.name,value:e.id})))})})]})}),(0,F.jsx)(l.Z.Item,{name:"lookupFilters",className:L.hide}),(0,F.jsxs)("div",{className:L.filters,children:[null===q||void 0===q?void 0:q.map(((e,t)=>(0,F.jsx)(O,{disabled:!A||te,index:t,filter:e,columnsObj:V,valueColumnsObj:z,columnsForFilter:le,columnsForFilterValue:ae,onRemove:ue,onChange:ce},"f_".concat(e.id)))),!u()(A)&&(0,F.jsxs)("div",{className:L.addAction,onClick:re,children:[(0,F.jsx)(s.Z,{}),D.$t({id:"fg8dzN",defaultMessage:"Add condition"})]})]}),(0,F.jsx)(l.Z.Item,{label:D.$t({id:"3yBxGK",defaultMessage:"Calculation"}),name:"lookupResultType",rules:[{required:!0}],children:(0,F.jsx)(g.Ph,{options:null===Y||void 0===Y?void 0:Y.map((e=>({label:e.name,value:e.id})))})}),(0,F.jsx)(l.Z.Item,{label:D.$t({id:"zQLEfz",defaultMessage:"Format"}),name:"lookupNumberFormat",rules:[{required:!0}],children:(0,F.jsx)(g.Ph,{options:null===X||void 0===X?void 0:X.map((e=>({label:e.name,value:e.id})))})})]})}var G=i(34362),B=i.n(G),H=i(38981),V=i.n(H),K=i(99540),z=i.n(K),U=i(17087),q=i(63796),W=i(48863),J=i(89084),Y=i(49544),X=i(85521),Q=i(39306),ee=i(85790),te=i(28827);const ie="lookupRenderer_wrap__231LW",ne="lookupRenderer_select__cIXBy",oe="lookupRenderer_popup__lZQ10",le=["sum","min","max","avg","count","countDistinct"],ae=e=>{const{inGrid:t,value:i,typeOptions:o,members:l,attachmentClassName:a,imageHeight:s,imageStyle:r,imageResizeMode:u,isThirdPartyTable:c,attachments:v,timezone:m,eGridCell:p,injector:h,onClickAttachment:f}=e,g=(0,n.useMemo)((()=>B()(le,null===o||void 0===o?void 0:o.lookupResultType)),[null===o||void 0===o?void 0:o.lookupResultType]);return(0,F.jsx)("div",{className:(0,d.default)(ie,{[oe]:t}),style:{width:null===p||void 0===p?void 0:p.clientWidth,minHeight:null===p||void 0===p?void 0:p.clientHeight},children:function(){var e,n,d;if(i&&!Array.isArray(i)&&"#LARGE"===i)return(0,F.jsx)(Q.jo,{inGrid:t,value:V()(i),injector:h});if(g)return(0,F.jsx)(U.xz,{inGrid:t,value:null===i?void 0:z()(i),typeOptions:o,injector:h});switch(null===o||void 0===o?void 0:o.lookupColumnType){case"singleChoice":case"multiChoice":return(0,F.jsx)(q.V5,{typeOptions:o.lookupColumnTypeOptions,value:i,className:ne});case"attachment":return(0,F.jsx)(X.c9,{value:v||i,className:a,imageHeight:s||20,imageStyle:r,imageResizeMode:u,isThirdPartyTable:c,onClickAttachment:f,injector:h});case"creator":case"updater":case"member":return(0,F.jsx)(W.ro,{value:i,members:l,injector:h});case"createTime":case"updateTime":case"datetime":return(0,F.jsx)(Y.Io,{value:i,typeOptions:o.lookupColumnTypeOptions,timezone:m,injector:h});case"number":return(0,F.jsx)(U.xz,{value:i,typeOptions:o,injector:h});case"related":return(0,F.jsx)(J.st,{value:i,injector:h});case"boolean":return(0,F.jsx)(ee.v,{value:i});case"hyperlink":return(0,F.jsx)(te.jT,{value:i,injector:h});case"formula":switch(null===o||void 0===o||null===(e=o.lookupColumnTypeOptions)||void 0===e?void 0:e.expectedType){case"datetime":return(0,F.jsx)(Y.Io,{value:i,typeOptions:{dateFormat:null===o||void 0===o||null===(n=o.lookupColumnTypeOptions)||void 0===n?void 0:n.datetimeDateFormat,timeFormat:null===o||void 0===o||null===(d=o.lookupColumnTypeOptions)||void 0===d?void 0:d.datetimeTimeFormat},timezone:m,injector:h});case"number":return(0,F.jsx)(U.xz,{value:i,typeOptions:o})}return(0,F.jsx)(Q.jo,{inGrid:t,value:V()(i),injector:h});default:return(0,F.jsx)(Q.jo,{inGrid:t,value:V()(i),injector:h})}}()})};var se=i(57323),de=i.n(se),re=i(46940),ue=i(74720),ce=i.n(ue),ve=i(98030);class me extends ve.Z{constructor(){super(...arguments),de()(this,"handlePreviewClick",(e=>{const{previewAttachmentEmitter:t}=this.params.context.injector.get(b.vK.attachment),i=ce()(e.target,"dataset.id");i&&t.emit({currentPreviewId:i,attachments:this.value})}))}init(e){var t,i,n,o;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const l=this.createEL();let a=[];a=this.params.context.getState().project.members,l.innerHTML=re.renderToStaticMarkup((0,F.jsx)(ae,{inGrid:null===(t=this.params)||void 0===t?void 0:t.inGrid,value:this.value,typeOptions:this.typeOptions,members:a,timezone:null===(i=this.params)||void 0===i?void 0:i.timezone,injector:this.params.context.injector})),this.attachmentListEL=l.querySelector('[data-attachment="list"]'),null===(n=this.attachmentListEL)||void 0===n||n.addEventListener("click",this.handlePreviewClick),this.eGui=this.withDecoration(l,null===(o=this.params)||void 0===o?void 0:o.collaborator,re.renderToStaticMarkup((0,F.jsx)(h.Z,{type:"sync"})))}getGui(){return this.eGui}destroy(){var e;null===(e=this.attachmentListEL)||void 0===e||e.removeEventListener("click",this.handlePreviewClick)}}},48863:(e,t,i)=>{i.d(t,{DJ:()=>f,_G:()=>a,Up:()=>I,ro:()=>v});var n=i(89614),o=i(57435),l=i(94553);function a(e){const{form:t,config:i}=e,[a]=n.Z.useForm();return(0,o.useImperativeHandle)(t,(()=>a)),(0,l.jsx)(n.Z,{name:"member",colon:!1,form:a,labelAlign:"left",labelCol:{span:20},wrapperCol:{span:4},initialValues:{...i}})}var s=i(7070),d=i.n(s),r=i(67513),u=i(75801);const c={wrap:"memberRenderer_wrap__89Q8p",user:"memberRenderer_user__qHBVA",avatar:"memberRenderer_avatar__0awPb",avatarDefault:"memberRenderer_avatarDefault__Ob2S8"};function v(e){const{value:t,members:i,injector:n}=e,{getPublicThumbnailUrl:o}=n.get(u.vK.common);return(0,l.jsx)("div",{className:c.wrap,children:d()(t,(e=>{const t=null===i||void 0===i?void 0:i.find((t=>t.id===e));return t?(0,l.jsxs)("div",{className:c.user,children:[t.avatar?(0,l.jsx)("img",{className:c.avatar,src:o(t.avatar),alt:t.name}):(0,l.jsx)("div",{className:c.avatarDefault,children:(0,l.jsx)(r.Z,{})}),(0,l.jsx)("span",{className:c.name,children:t.name})]},e):null}))})}var m=i(46940),p=i(68429),h=i(98030);class f extends h.Z{init(e){var t;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();let i=[];i=this.params.context.getState().project.members;const n=this.createEL();n.innerHTML=m.renderToStaticMarkup((0,l.jsx)(v,{value:this.value,members:i,injector:this.params.context.injector})),this.eGui=this.withDecoration(n,null===(t=this.params)||void 0===t?void 0:t.collaborator,m.renderToStaticMarkup((0,l.jsx)(p.Z,{type:"sync"})))}getGui(){return this.eGui}}var g=i(95620),b=i(82959),y=i.n(b),C=i(23903),x=i.n(C),_=i(83580);const w={select:"memberEditor_select__oIHcY",member:"memberEditor_member__Z8uxf",avatar:"memberEditor_avatar__JUA2-",avatarDefault:"memberEditor_avatarDefault__LV0wp"},I=e=>{const{inGrid:t=!1,disabled:i,size:n="middle",value:a,onChange:s,onBlur:c,stopEditing:v,eGridCell:m}=e,{entity:p}=(0,u.$1)(u.vK.common),{getPublicThumbnailUrl:h,useSelector:f}=p,b=(0,o.useRef)(null),[C,I]=(0,o.useState)(!1),j=f((e=>e.project.members)),k=t?j:e.members,D=(0,g.Z)(),N=(0,o.useCallback)((e=>{null===s||void 0===s||s(y()(e))}),[s]);return(0,o.useEffect)((()=>{var e;t&&(null===(e=b.current)||void 0===e||e.focus())}),[t]),(0,l.jsx)(_.Ph,{style:{width:null===m||void 0===m?void 0:m.clientWidth,minHeight:null===m||void 0===m?void 0:m.clientHeight},ref:b,value:a,open:C,disabled:i,variant:t?"borderless":"outlined",autoFocus:t,className:w.select,tagRender:e=>{var t;const{value:i}=e,n=null!==(t=x()(k,(e=>e.id===i)))&&void 0!==t?t:{name:i,avatar:void 0};return(0,l.jsxs)("div",{className:w.member,children:[n.avatar?(0,l.jsx)("img",{className:w.avatar,src:h(n.avatar),alt:n.name}):(0,l.jsx)("div",{className:w.avatarDefault,children:(0,l.jsx)(r.Z,{})}),(0,l.jsx)("span",{className:w.name,children:n.name})]})},showSearch:!0,placeholder:D.$t({id:"xmcVZ0",defaultMessage:"Search"}),filterOption:(e,t)=>!(null===t||void 0===t||!t.title)&&-1!==t.title.indexOf(e),mode:"multiple",onChange:N,onBlur:function(){null===c||void 0===c||c(a),I(!1),null===v||void 0===v||v()},onInputKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),null===v||void 0===v||v())},allowClear:!0,getPopupContainer:e=>e.parentElement,onFocus:()=>{I(!0)},size:n,children:d()(k,(e=>(0,l.jsx)(_.Ph.Option,{value:e.id,title:e.name,children:(0,l.jsxs)("div",{className:w.member,children:[e.avatar?(0,l.jsx)("img",{className:w.avatar,src:h(e.avatar),alt:e.name}):(0,l.jsx)("div",{className:w.avatarDefault,children:(0,l.jsx)(r.Z,{})}),(0,l.jsx)("span",{className:w.name,children:e.name})]})},e.id)))})}},39306:(e,t,i)=>{i.d(t,{zp:()=>N,fO:()=>x,zZ:()=>S,jo:()=>m,qr:()=>E});var n=i(57435),o=i(33718),l=i(11454),a=i.n(l),s=i(55349),d=i.n(s),r=i(68429),u=i(10925);const c={button:"multiLineText_button__AAexH",multiLineTextEditorWrapper:"multiLineText_multiLineTextEditorWrapper__Fg-DX",textarea:"multiLineText_textarea__WEYLv",hint:"multiLineText_hint__F1emi",renderer:"multiLineText_renderer__NfKoi",collapseBtnText:"multiLineText_collapseBtnText__jd71N",expandBtnText:"multiLineText_expandBtnText__xT+3V",expandButton:"multiLineText_expandButton__JFsP1",showExpanded:"multiLineText_showExpanded__hG5Sw",text:"multiLineText_text__bJfcZ",textPre:"multiLineText_textPre__M7kbn",noContent:"multiLineText_noContent__I0Z2c",textAlignLeft:"multiLineText_textAlignLeft__j-biQ",rendererButton:"multiLineText_rendererButton__0VmwP",expand:"multiLineText_expand__TV3yT",readonly:"multiLineText_readonly__IaE3+",modal:"multiLineText_modal__3cgqe"};var v=i(94553);function m(e){const{value:t,inGrid:i,rowIndex:l,colId:s,rowHeight:m}=e,p=(0,n.useRef)(null),h=s&&!d()(l)?"cell_".concat(s,"_").concat(l):void 0;return e.value&&!e.inGrid&&setTimeout((()=>{const e=p.current&&p.current.scrollHeight>40;if(p.current){const t=p.current.closest('[data-multiline="MultiLineText"]');e?null===t||void 0===t||t.classList.add(c.showExpanded):null===t||void 0===t||t.classList.remove(c.showExpanded)}}),0),(0,v.jsxs)("div",{id:h,"data-multiline":"MultiLineText","data-rowheight":m,className:(0,o.default)(c.renderer,{[c.expand]:e.isPlain}),children:[(0,v.jsx)("span",{className:(0,o.default)(c.text,{[c.noContent]:!t&&!i,[c.textPre]:!i&&-1!==e.truncateLength,[c.readonly]:!(null!==e&&void 0!==e&&e.editable),[c.textAlignLeft]:null===e||void 0===e?void 0:e.textAlignLeft}),ref:p,children:e.truncateLength&&e.truncateLength>0?a()(t,{length:e.truncateLength}):(0,v.jsx)(u.Z.Paragraph,{ellipsis:{rows:2,expandable:"collapsible"},children:t})}),(null===e||void 0===e?void 0:e.editable)&&(e.inGrid||e.isPlain)&&(0,v.jsx)("div",{"data-multiline":"openModal",className:(0,o.default)(c.button,c.rendererButton),children:(0,v.jsx)(r.Z,{type:"expandArrow"})})]})}var p=i(95620),h=i(19087),f=i.n(h),g=i(7639),b=i(57316),y=i(75801);const{TextArea:C}=g.default,x=e=>{var t;const{entity:i,dispatch:o}=(0,y.$1)(y.vK.multiLineText),{inGrid:l=!1,placeholder:a,value:s,onChange:d,stopEditing:r}=e,{onBlur:u=f(),onPressEnter:m=f()}=e,h=(0,n.useRef)(null),g=(0,p.Z)(),{updateMultiLineTextEditor:x,useSelector:_}=i,w=_((e=>e.project.multiLineTextEditor));return(0,n.useEffect)((()=>{var e;l&&(null===(e=h.current)||void 0===e||e.focus({cursor:"end"}))}),[l]),(0,n.useEffect)((()=>{null!==w&&void 0!==w&&w.visible||"close"!==(null===w||void 0===w?void 0:w.trigger)||o(null===x||void 0===x?void 0:x({trigger:null,data:void 0}))}),[w,x,o]),(0,v.jsxs)("div",{style:{width:null===(t=e.eGridCell)||void 0===t?void 0:t.clientWidth},children:[(0,v.jsx)("div",{className:c.multiLineTextEditorWrapper,children:(0,v.jsx)(C,{"data-testid":"multiLineTextEditor","data-specialid":"multiLineTextEditor",className:c.textarea,ref:h,variant:l?"borderless":"outlined",autoComplete:"off",value:s,autoSize:{maxRows:5},onChange:e=>null===d||void 0===d?void 0:d(e.target.value),onBlur:function(e){u(e.target.value),null===r||void 0===r||r()},onKeyDown:function(e){"Enter"===e.key&&(e.shiftKey?e.stopPropagation():m(e.target.value))},onMouseDown:e=>e.stopPropagation(),maxLength:b.Q0,placeholder:a})}),l&&(0,v.jsx)("div",{className:c.hint,children:g.$t({id:"mdjBC3",defaultMessage:"\u23ce Enter \u21e7 + \u23ce Return"})})]})};var _=i(57323),w=i.n(_),I=i(46940),j=i(99540),k=i.n(j),D=i(98030);class N extends D.Z{constructor(){super(...arguments),w()(this,"openModalElement",null),w()(this,"openModalHandler",(()=>{var e,t,i;const n=this.params.context.dispatch,o=this.params.context.injector.get(y.vK.multiLineText),{updateMultiLineTextEditor:l}=o,a=k()(null===(e=this.params)||void 0===e?void 0:e.tableNodeId),s=null===(t=this.params)||void 0===t?void 0:t.data.id,d=null===(i=this.params)||void 0===i||null===(i=i.colDef)||void 0===i?void 0:i.field;null===n||void 0===n||n(l({visible:!0,trigger:"open",openFrom:"renderer",data:{id:a,rowId:s,cellId:d,value:this.value}}))}))}init(e){var t,i,n,o,l,a;this.value=null===e||void 0===e?void 0:e.realValue,this.params=e,this.checkSubscribed();const s=null===(t=this.params)||void 0===t||null===(t=t.column)||void 0===t?void 0:t.getColId(),d=null===(i=this.params)||void 0===i?void 0:i.node.rowIndex,u=this.createEL();u.innerHTML=I.renderToStaticMarkup((0,v.jsx)(m,{value:this.value,inGrid:!0,editable:null===(n=this.params)||void 0===n?void 0:n.editable,truncateLength:"low"===(null===(o=this.params)||void 0===o?void 0:o.rowHeight)?200:void 0,colId:s,rowIndex:d,rowHeight:null===(l=this.params)||void 0===l?void 0:l.rowHeight,injector:this.params.context.injector})),this.openModalElement=u.querySelector('[data-multiline="openModal"]'),this.openModalElement&&this.openModalElement.addEventListener("click",this.openModalHandler),this.eGui=this.withDecoration(u,null===(a=this.params)||void 0===a?void 0:a.collaborator,I.renderToStaticMarkup((0,v.jsx)(r.Z,{type:"sync"})))}getGui(){return this.eGui}destroy(){this.openModalElement&&this.openModalElement.removeEventListener("click",this.openModalHandler)}}const E=e=>{let{value:t="",truncateLength:i}=e;return(0,v.jsx)("div",{className:c.renderer,children:(0,v.jsx)("div",{className:c.text,children:i?a()(t,{length:i}):t})})};var T=i(83580);const{TextArea:M}=g.default,S=()=>{var e;const{entity:t,dispatch:i}=(0,y.$1)(y.vK.multiLineText),[o,l]=(0,n.useState)(""),{updateMultiLineTextEditor:a,updateCells:s,useSelector:d}=t,r=d((e=>e.project.multiLineTextEditor));(0,n.useEffect)((()=>{var e;l((null===r||void 0===r||null===(e=r.data)||void 0===e?void 0:e.value)||"")}),[null===r||void 0===r||null===(e=r.data)||void 0===e?void 0:e.value]);return(0,v.jsx)(T.Vq,{visible:null===r||void 0===r?void 0:r.visible,footer:null,className:c.modal,width:450,onCancel:function(){i(a({visible:!1,trigger:"close"}))},maskClosable:!1,children:(0,v.jsx)(M,{className:c.textarea,onBlur:()=>{if(null!==r&&void 0!==r&&r.data&&i(a({data:{...r.data,value:o}})),"renderer"===(null===r||void 0===r?void 0:r.openFrom)&&r.data){var e;const{id:t,rowId:n,cellId:l}=r.data;i(s({id:t,rowId:n,cells:{[l]:o},prevCells:{[l]:null===(e=r.data)||void 0===e?void 0:e.value}}))}},onChange:e=>{l(e.target.value)},value:o,maxLength:b.Q0})})}},17087:(e,t,i)=>{i.d(t,{Fp:()=>O,xS:()=>r,cp:()=>R,xz:()=>x});var n=i(57435),o=i(95620),l=i(89614),a=i(57316),s=i(83580),d=i(94553);const r=e=>{let{form:t,config:i}=e;const r=(0,o.Z)(),[u]=l.Z.useForm(),c={format:(0,a.CS)(r)[0].value,precision:a._d[0].value,...i};return(0,n.useImperativeHandle)(t,(()=>u)),(0,d.jsxs)(l.Z,{name:"number",form:u,labelAlign:"left",labelCol:{span:7},wrapperCol:{span:17},initialValues:c,children:[(0,d.jsx)(l.Z.Item,{label:r.$t({id:"zQLEfz",defaultMessage:"Format"}),name:"format",children:(0,d.jsx)(s.Ph,{options:(0,a.CS)(r)})}),(0,d.jsx)(l.Z.Item,{label:r.$t({id:"ryneQr",defaultMessage:"Precision"}),name:"precision",children:(0,d.jsx)(s.Ph,{options:a._d})})]})};var u=i(18878),c=i.n(u),v=i(78587),m=i.n(v),p=i(75538),h=i.n(p),f=i(7070),g=i.n(f),b=i(33718),y=i(75801);const C="numberRenderer_numberInGrid__it4FS",x=e=>{var t;const{value:i,typeOptions:o,injector:l}=e,{padNumberByPrecisionWithFormat:a}=null!==(t=null===l||void 0===l?void 0:l.get(y.vK.number))&&void 0!==t?t:{},s="currency"===(null===o||void 0===o?void 0:o.format)?null===o||void 0===o?void 0:o.numberPrefix:void 0,r=(0,n.useMemo)((()=>{return m()(i)?h()(g()(i,(e=>{var t;return null===a||void 0===a?void 0:a(e,null!==(t=null===o||void 0===o?void 0:o.precision)&&void 0!==t?t:0,null===o||void 0===o?void 0:o.format,s)})),", "):c()(i)?null===a||void 0===a?void 0:a(i,null!==(e=null===o||void 0===o?void 0:o.precision)&&void 0!==e?e:0,null===o||void 0===o?void 0:o.format,s):"";var e}),[i,o,a,s]);return(0,d.jsx)("div",{className:(0,b.default)(e.inGrid&&C),children:r})};var _=i(99540),w=i.n(_),I=i(59267),j=i.n(I),k=i(55349),D=i.n(k),N=i(19087),E=i.n(N),T=i(57875),M=i(47752),S=i(34221);function P(e){const t=w()(e);return c()(t)&&!j()(t)}const R=e=>{const{inGrid:t=!1,disabled:i,placeholder:l,size:a="middle",onBlur:s=E(),onPressEnter:r=E(),onChange:u}=e,[v,m]=(0,n.useState)(null),p=(0,n.useRef)(null),h=(0,o.Z)();(0,n.useEffect)((()=>{var e;t&&(null===(e=p.current)||void 0===e||e.focus())}),[t]),(0,T.E9)({isCancelAfterEnd:()=>!P(e.value),isCancelBeforeStart:()=>"Enter"!==e.eventKey&&(!!e.eventKey&&-1==="1234567890".indexOf(e.eventKey))});const f=(0,n.useMemo)((()=>{var t,i;return"string"===typeof e.value?{stringMode:!0,step:null!==(t=e.typeOptions)&&void 0!==t&&t.precision?1/Math.pow(10,null===(i=e.typeOptions)||void 0===i?void 0:i.precision):1}:{}}),[e.value,e.typeOptions]);return(0,d.jsx)(M.Z,{title:v,open:!!v,placement:"topLeft",children:(0,d.jsx)(S.Z,{ref:p,style:{width:"100%"},autoFocus:t,variant:t?"borderless":"outlined",autoComplete:"off",value:e.value,disabled:i,onPressEnter:function(e){P(e.target.value)&&r()},onChange:function(e){const t="string"===typeof e?w()(e):e;if(!t&&0!==t)return void(null===u||void 0===u||u(void 0));const i=w()(t);D()(t)||!c()(i)||j()(i)?m(h.$t({id:"U/ezDL",defaultMessage:"Data format error"})):m(null),null===u||void 0===u||u(i)},onBlur:s,onMouseDown:e=>e.stopPropagation(),placeholder:l,size:a,...f})})};var A=i(46940),Z=i(68429),F=i(98030);class O extends F.Z{init(e){var t,i;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const n=this.createEL();n.innerHTML=A.renderToStaticMarkup((0,d.jsx)(x,{inGrid:null===(t=this.params)||void 0===t?void 0:t.inGrid,value:this.value,typeOptions:this.typeOptions,injector:this.params.context.injector})),this.eGui=this.withDecoration(n,null===(i=this.params)||void 0===i?void 0:i.collaborator,A.renderToStaticMarkup((0,d.jsx)(Z.Z,{type:"sync"})))}getGui(){return this.eGui}}},89084:(e,t,i)=>{i.d(t,{ME:()=>M,b5:()=>y,v$:()=>xt,st:()=>I});var n=i(57435),o=i(89614),l=i(49633),a=i(7639),s=i(95620),d=i(7070),r=i.n(d),u=i(23903),c=i.n(u),v=i(18765),m=i.n(v),p=i(68429),h=i(83580),f=i(75801);const g={twoWay:"relatedConfig_twoWay__aVcJu",icon:"relatedConfig_icon__xX9TP",hide:"relatedConfig_hide__4XuRx",info:"relatedConfig_info__+nqJY",table:"relatedConfig_table__O61xY",tableLine:"relatedConfig_tableLine__tzLuf",column:"relatedConfig_column__JjsXD"};var b=i(94553);function y(e){const{name:t,form:i,config:d}=e,{entity:u}=(0,f.$1)(f.vK.related),{useParameters:v,useWorkspaces:y,useProject:C,useView:x,useTableNodeDetail:_}=u,w=(0,s.Z)(),[I]=o.Z.useForm(),{workspaceId:j,workspaceType:k,projectId:D,tableNodeId:N}=v(),{workspace:E}=y(k,j),{project:T}=C(E,D),{view:M}=x(N),S=(0,n.useMemo)((()=>m()(null===T||void 0===T?void 0:T.tableNodes,(e=>"table"===e.type))),[T]),[P,R]=(0,n.useState)(null===d||void 0===d?void 0:d.relatedTableNodeID),A=(0,n.useMemo)((()=>{var e;return null===(e=c()(S,(e=>e.id===N)))||void 0===e?void 0:e.name}),[S,N]),Z=(0,n.useMemo)((()=>{var e;return null===(e=c()(S,(e=>e.id===P)))||void 0===e?void 0:e.name}),[S,P]),[F,O]=(0,n.useState)(null===d||void 0===d?void 0:d.relatedIsTwoWay),[L,$]=(0,n.useState)(null===d||void 0===d?void 0:d.relatedColumnName),{data:G}=_(D,P),[B,H]=(0,n.useState)(),V={relatedColumnName:L,relatedMultiRows:!0,...d};(0,n.useImperativeHandle)(i,(()=>I));const K=(0,n.useCallback)((e=>{R(e),H(void 0),O(!1),I.setFieldsValue({relatedViewID:void 0,relatedIsTwoWay:!1})}),[I]);return(0,n.useEffect)((()=>{G&&H(m()(G.views,(e=>"table"===e.type)))}),[G]),(0,n.useEffect)((()=>{let e=null===d||void 0===d?void 0:d.relatedColumnName;!e&&Z&&(e="".concat(w.$t({id:"vlFiOJ",defaultMessage:"Two-way relation"}),"-").concat(Z)),e&&($(e),I.setFieldsValue({relatedColumnName:e}))}),[w,d,Z,I]),(0,n.useEffect)((()=>{M&&I.setFieldsValue({relatedCurrentViewID:null===M||void 0===M?void 0:M.id})}),[M,I]),(0,b.jsxs)(o.Z,{name:"related",colon:!1,form:I,labelAlign:"left",requiredMark:!1,labelCol:{span:7},wrapperCol:{span:24},initialValues:V,children:[(0,b.jsx)(o.Z.Item,{label:w.$t({id:"WLvWZU",defaultMessage:"Related table"}),name:"relatedTableNodeID",rules:[{required:!0,message:w.$t({id:"Oc3TkA",defaultMessage:"Please select a table"})}],children:(0,b.jsx)(h.Ph,{onChange:K,children:r()(S,(e=>(0,b.jsxs)(h.Ph.Option,{value:e.id,children:[(0,b.jsx)(p.Z,{type:"table",className:g.icon})," ",e.name]},e.id)))})}),(0,b.jsx)(o.Z.Item,{label:w.$t({id:"table.view",defaultMessage:"View"}),name:"relatedViewID",rules:[{required:!0,message:w.$t({id:"n8TgCC",defaultMessage:"Select a view"})}],children:(0,b.jsx)(h.Ph,{options:(null===B||void 0===B?void 0:B.map((e=>({label:e.name,value:e.id}))))||[]})}),(0,b.jsx)(o.Z.Item,{className:g.hide,label:w.$t({id:"bYU2tx",defaultMessage:"Can select multiple records"}),name:"relatedMultiRows",valuePropName:"checked",labelCol:{span:20},children:(0,b.jsx)(l.Z,{size:"small"})}),(0,b.jsx)(o.Z.Item,{label:w.$t({id:"nmKRw3",defaultMessage:"Add relation field to the linked table"}),name:"relatedIsTwoWay",valuePropName:"checked",labelCol:{span:20},children:(0,b.jsx)(l.Z,{size:"small",onChange:O})}),F&&(0,b.jsxs)("div",{className:g.twoWay,children:[(0,b.jsx)(o.Z.Item,{label:w.$t({id:"1TI8Yu",defaultMessage:"Related field"}),name:"relatedColumnName",labelCol:{span:10},children:(0,b.jsx)(a.default,{onChange:e=>$(e.target.value)})}),(0,b.jsx)(o.Z.Item,{name:"relatedCurrentViewID",className:g.hide}),(0,b.jsxs)("div",{className:g.info,children:[(0,b.jsx)("div",{className:g.column,children:t}),(0,b.jsx)(p.Z,{type:"relatedTo"}),(0,b.jsxs)("div",{className:g.tableLine,children:[(0,b.jsxs)("div",{className:g.table,children:[(0,b.jsx)(p.Z,{type:"table",className:g.icon}),A]}),(0,b.jsxs)("div",{className:g.table,children:[(0,b.jsx)(p.Z,{type:"table",className:g.icon}),Z]})]}),(0,b.jsx)(p.Z,{type:"relatedFrom"}),(0,b.jsx)("div",{className:g.column,children:L})]})]})]})}var C=i(33718),x=i(88716),_=i.n(x);const w={wrap:"relatedRenderer_wrap__+eMst",item:"relatedRenderer_item__nKKxH",btn:"relatedRenderer_btn__DQUXy",closeIcon:"relatedRenderer_closeIcon__-zZ59",addButton:"relatedRenderer_addButton__ri-Wj",addButtonActive:"relatedRenderer_addButtonActive__MWxKo"};function I(e){const{editable:t,onAdd:i,onRemove:o,wrapStyle:l={},itemStyle:a={},inGrid:s=!1,isThirdPartyTable:d}=e,u=(0,n.useMemo)((()=>Array.isArray(e.value)?e.value:d&&"string"===typeof e.value?e.value.split(",").map(((e,t)=>({rowID:t.toString(),displayName:e}))):void 0),[d,e.value]);return(0,b.jsxs)("div",{className:w.wrap,style:l,"data-related":"list",children:[r()(u,(e=>e?(0,b.jsxs)("div",{className:w.item,style:a,children:[(0,b.jsx)("span",{className:w.name,children:_()(e.displayName)?"":e.displayName}),t&&(0,b.jsx)("div",{"data-id":e.rowID,className:w.btn,onClick:()=>{return t=e,void(null===o||void 0===o||o(t));var t},children:(0,b.jsx)(p.Z,{type:"close",className:w.closeIcon})})]},e.rowID):null)),t&&(0,b.jsx)("div",{"data-related":"add",className:(0,C.default)(w.addButton,s?"":w.addButtonActive),onClick:i,children:(0,b.jsx)(p.Z,{type:"plus"})})]})}var j=i(57323),k=i.n(j),D=i(46940),N=i(74720),E=i.n(N),T=i(98030);class M extends T.Z{constructor(){super(...arguments),k()(this,"addElement",null),k()(this,"removeElement",null),k()(this,"removeHandler",(e=>{const t=E()(e.target,"dataset.id");if(t){var i,n;const e=m()(this.value,(e=>e.rowID!==t));null===(i=this.params)||void 0===i||null===(n=i.setValue)||void 0===n||n.call(i,_()(e)?null:e)}}))}init(e){var t,i;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const n=this.createEL();n.innerHTML=D.renderToStaticMarkup((0,b.jsx)(I,{value:this.value,editable:null===(t=this.params)||void 0===t?void 0:t.editable,inGrid:!0,injector:this.params.context.injector})),this.addElement=n.querySelector('[data-related="add"]'),this.addElement&&this.addElement.addEventListener("click",this.startEditing),this.removeElement=n.querySelector('[data-related="list"]'),this.removeElement&&this.removeElement.addEventListener("click",this.removeHandler),this.eGui=this.withDecoration(n,null===(i=this.params)||void 0===i?void 0:i.collaborator,D.renderToStaticMarkup((0,b.jsx)(p.Z,{type:"sync"})))}getGui(){return this.eGui}destroy(){this.addElement&&this.addElement.removeEventListener("click",this.startEditing),this.removeElement&&this.removeElement.removeEventListener("click",this.removeHandler)}}var S=i(59680),P=i(38981),R=i.n(P),A=i(17646),Z=i.n(A),F=i(55349),O=i.n(F),L=i(27371),$=i(88505),G=i(35991),B=i(89840),H=i(37756),V=i.n(H),K=i(53182),z=i.n(K),U=i(8701),q=i(21917),W=i(11214),J=i(33417),Y=i(88679),X=i(87113),Q=i(8136),ee=i(18798),te=i(30845),ie=i(74051),ne=i(83090),oe=i(7154),le=i(36639),ae=i(1714),se=i(39306),de=i(79246),re=i(62618),ue=i.n(re);const ce="girdRowAdder_row__Ls2Fc",ve="girdRowAdder_button__MUdTD",me="girdRowAdder_clickable__M81Do",pe=(0,n.forwardRef)(((e,t)=>{const{api:i,context:o,node:l,tableNodeId:a,onRowAdd:d,onDetailOpen:r}=e,[u,v]=(0,n.useState)(!1),{entity:m,getState:p}=(0,f.$1)(f.vK.grid),{useGroupData:h}=m,g=(0,s.Z)(),{getGroupCells:y}=h(e.tableNodeId),{clickable:x,marginLeft:_}=(0,n.useMemo)((()=>{const t=e.node.footer?e.node.level+1:0;return{clickable:!e.node.footer||e.node.leafGroup,marginLeft:15*(t+1)}}),[e.node]);return(0,n.useImperativeHandle)(t,(()=>({}))),(0,b.jsx)("div",{className:(0,C.default)(ce,{[me]:x&&!u}),onClick:async function(){var e,t;if(!d||u)return;v(!0);const n=l.rowIndex,s=i.getDisplayedRowAtIndex(n-1);i.isAnyFilterPresent()&&L.ZP.info(g.$t({id:"XEK+nW",defaultMessage:"Filter is currently enabled. Added records may be filtered"}));const m=p(),h=E()(m.tableNode.entities,"".concat(a,".views"),[]),f=null===(e=c()(h,(e=>e.id===o.viewId)))||void 0===e?void 0:e.rows,b=null===(t=V()(ue()(f,"order")))||void 0===t?void 0:t.id,C=y(l);try{const e=await d(a,null!==b&&void 0!==b?b:null===s||void 0===s?void 0:s.data.id,C),t=E()(e.payload,"wsSyncedData.id");t&&i.isAnyFilterPresent()&&(null===r||void 0===r||r(t,!0))}finally{v(!1)}},"data-testid":"gridRowAdder",children:x&&(0,b.jsx)(de.Z,{className:ve,style:{marginLeft:_}})})}));var he=i(99540),fe=i.n(he),ge=i(35257),be=i.n(ge),ye=i(27077);const Ce={status:"girdStatusBar_status__n6+y5",statusCalc:"girdStatusBar_statusCalc__ZvQAj"};function xe(e){const{api:t}=e,{entity:i}=(0,f.$1)(f.vK.grid),{isNumeric:o}=i,l=(0,s.Z)(),[a,d]=(0,n.useState)(0),[r,u]=(0,n.useState)(0),[c,v]=(0,n.useState)([]),m=(0,n.useCallback)((()=>{if(t.isDestroyed())return;const e=z()(t.getCellRanges()),i=null===e||void 0===e?void 0:e.columns,n=null===e||void 0===e?void 0:e.startRow,l=null===e||void 0===e?void 0:e.endRow;if(!e||!i||!n||!l)return;const a=Math.min(n.rowIndex,l.rowIndex),s=Math.max(n.rowIndex,l.rowIndex);let r=0,c=0;const m=[];for(let d=a;d<=s;d++)for(let e=0;e<i.length;e++){var p;const n=i[e],l=n.getColDef().headerComponentParams,a=t.getDisplayedRowAtIndex(d);if(!a||!l||a.group||a.footer)continue;r++;const s=null===(p=a.data)||void 0===p?void 0:p[n.getColId()];(s||0===s)&&(o(l)&&(m.push(fe()(s)),c++))}d(r),u(c),v(m)}),[t,o]);(0,n.useEffect)((()=>(t.addEventListener("gridReady",m),t.addEventListener("rowDataUpdated",m),t.addEventListener("filterChanged",m),t.addEventListener("rangeSelectionChanged",m),()=>{t.isDestroyed()||(t.removeEventListener("gridReady",m),t.removeEventListener("rowDataUpdated",m),t.removeEventListener("filterChanged",m),t.removeEventListener("rangeSelectionChanged",m))})),[t,m]);const p=be()((0,ye.Z)(c),8),h=c.length>0?be()(p/c.length,8):0;return a<=1?(0,b.jsx)("div",{}):(0,b.jsxs)("div",{className:Ce.status,children:[a>0&&function(e){return(0,b.jsxs)("div",{className:Ce.statusItem,children:[(0,b.jsxs)("span",{children:[l.$t({id:"Aujn2T",defaultMessage:"Count"}),": "]}),(0,b.jsx)("span",{className:Ce.statusCalc,children:e})]})}(a),r>0&&function(e){return(0,b.jsxs)("div",{className:Ce.statusItem,children:[(0,b.jsxs)("span",{children:[l.$t({id:"YYkniy",defaultMessage:"Sum"}),": "]}),(0,b.jsx)("span",{className:Ce.statusCalc,children:e})]})}(p),r>0&&function(e){return(0,b.jsxs)("div",{className:Ce.statusItem,children:[(0,b.jsxs)("span",{children:[l.$t({id:"gYB2lt",defaultMessage:"Mean"}),": "]}),(0,b.jsx)("span",{className:Ce.statusCalc,children:e})]})}(h)]})}const _e={value:"hide"},we={value:"count"},Ie=[_e,we,{value:"vacant"},{value:"occupied"},{value:"vacantRatio"},{value:"occupiedRatio"}],je=[...Ie,{value:"sum"},{value:"avg"},{value:"median"},{value:"max"},{value:"min"}],ke=[...Ie,{value:"period"}],De=[we],Ne=[...Ie,...je,...ke];var Ee=i(70323),Te=i(35546),Me=i(42514),Se=i(6200),Pe=i(43179),Re=i.n(Pe),Ae=i(32820),Ze=i(18451);function Fe(e,t){if(t)return e.$t({id:"stat.option.".concat(t),defaultMessage:[]})}function Oe(e,t,i,n){var o;if((null===t||void 0===t?void 0:t.id)===Ze._m||null!==t&&void 0!==t&&t.group||null!==t&&void 0!==t&&t.footer)return{count:0,total:0};const l=null===t||void 0===t||null===(o=t.data)||void 0===o?void 0:o[e];let a=0;switch(i){case"vacant":case"vacantRatio":O()(l)&&a++;break;case"occupied":case"occupiedRatio":O()(l)||a++;break;case"sum":case"median":case"avg":case"min":case"max":O()(l)||n.push(fe()(l));break;case"period":O()(l)||n.push(Re()(l).valueOf())}return{count:a,total:1}}function Le(e){const{gridApi:t,tableNodeId:i,viewId:o,groupNode:l}=e,{entity:a}=(0,f.$1)(f.vK.grid),{padNumberByPrecisionWithFormat:d,useSelector:u}=a,c=u((e=>e.tableNode.entities[i])),v=(0,s.Z)(),m=(0,n.useCallback)(((e,t,i,n)=>{const o="formula"===i?null===n||void 0===n?void 0:n.numberPrecision:null===n||void 0===n?void 0:n.precision,l="formula"===i?null===n||void 0===n?void 0:n.numberFormat:null===n||void 0===n?void 0:n.format;return"".concat(e," ").concat(d(null!==t&&void 0!==t?t:0,null!==o&&void 0!==o?o:2,l))}),[d]);return(0,n.useMemo)((()=>{var e;const i=t.getAllDisplayedColumns().filter((e=>{const t=e.getColId();return t!==Ze.kl&&t!==Ze.hK&&t!==Ze._m}));const n=null===c||void 0===c||null===(e=c.views.find((e=>e.id===o)))||void 0===e?void 0:e.columns;return r()(i,(e=>{var i,o,a,s,d,r,u,p,h;const f=e.getColId(),g=null!==(i=null===n||void 0===n||null===(o=n.find((e=>e.id===f)))||void 0===o?void 0:o.statsOption)&&void 0!==i?i:"hide";if("hide"===g)return{id:f,type:null===(a=e.getColDef().headerComponentParams)||void 0===a?void 0:a.type,typeOptions:null===(s=e.getColDef().headerComponentParams)||void 0===s?void 0:s.typeOptions,width:e.getActualWidth(),isPinned:e.isPinned(),stats:{value:g,text:""}};const{type:b,typeOptions:y}=null!==(d=null===c||void 0===c?void 0:c.columns.find((e=>e.id===f)))&&void 0!==d?d:{},C=[];let x=0,_=0,w=null!==(r=Fe(v,null===(u=Ne.find((e=>e.value===g)))||void 0===u?void 0:u.value))&&void 0!==r?r:"";var I,j;l?(w=null!==(I=Fe(v,null===(j=De.find((e=>e.value===g)))||void 0===j?void 0:j.value))&&void 0!==I?I:w,Z()(l.childrenAfterFilter,(e=>{const t=Oe(f,e,g,C);x+=t.count,_+=t.total}))):t.forEachNodeAfterFilter((e=>{const t=Oe(f,e,g,C);x+=t.count,_+=t.total}));switch(g){case"count":w="".concat(w," ").concat(_," ").concat(v.$t({id:"4I/Bht",defaultMessage:"records"}));break;case"vacant":case"occupied":w="".concat(w," ").concat(x," ").concat(v.$t({id:"4I/Bht",defaultMessage:"records"}));break;case"sum":w=m(w,(0,ye.Z)(C),b,y);break;case"median":w=m(w,(0,Ee.Z)(C),b,y);break;case"avg":w=m(w,(0,Te.Z)(C),b,y);break;case"min":w=m(w,(0,Me.Z)(C),b,y);break;case"max":w=m(w,(0,Se.Z)(C),b,y);break;case"vacantRatio":case"occupiedRatio":w="".concat(w," ").concat(Math.min(x/_*100,100).toFixed(2),"%");break;case"period":{const e=Re()((0,Se.Z)(C)).diff(Re()((0,Me.Z)(C)),"day");w="".concat(w," ").concat(v.$t(Ae.B.days,{days:e}));break}}return{id:f,type:null===(p=e.getColDef().headerComponentParams)||void 0===p?void 0:p.type,typeOptions:null===(h=e.getColDef().headerComponentParams)||void 0===h?void 0:h.typeOptions,width:e.getActualWidth(),isPinned:e.isPinned(),stats:{value:g,text:w}}}))}),[v,t,c,o,l,m])}function $e(e){let{api:t,children:i,className:o}=e;const[l,a]=(0,n.useState)(0),s=(0,n.useRef)(null);return(0,n.useEffect)((()=>{function e(e){if("horizontal"===e.direction&&(a(e.left),s.current)){const t=s.current.querySelector("[data-pinned=true]");t&&(t.style.left="".concat(e.left,"px"))}}return t.addEventListener("bodyScroll",e),()=>{t.isDestroyed()||t.removeEventListener("bodyScroll",e)}}),[t]),(0,b.jsx)("div",{ref:s,className:o,style:{transform:"translateX(-".concat(l,"px)")},children:i})}const Ge={statusBar:"gridAdvancedStatusBar_statusBar__n0g+j",stats:"gridAdvancedStatusBar_stats__z6b47",hide:"gridAdvancedStatusBar_hide__x9T7Z",inner:"gridAdvancedStatusBar_inner__dEJnU",statsWrap:"gridAdvancedStatusBar_statsWrap__lHFwq",select:"gridAdvancedStatusBar_select__LdPSs"},Be=e=>{const t=(0,s.Z)(),{columnId:i,viewId:o,tableNodeId:l,width:a,paddingLeft:d=0,isPinned:r,value:u="hide",text:c=Fe(t,_e.value),columnType:v,columnTypeOptions:m,editable:p,syncChange:g,statsClassName:y=Ge.stats,hideClassName:x=Ge.hide,onSelect:_}=e,{entity:w,dispatch:I}=(0,f.$1)(f.vK.grid),{isNumeric:j,updateViewColumns:k,updateViewColumnsAction:D,isDatetimeLike:N}=w,[E,T]=(0,n.useState)(!1),M=(0,n.useRef)(null),S=(0,n.useCallback)((e=>j(e)?je:N(e)?ke:Ie),[j,N]),P=(0,n.useMemo)((()=>S({type:v,typeOptions:m}).map((e=>({value:e.value,label:Fe(t,e.value)})))),[t,v,m,S]),R=(0,n.useCallback)(((e,t)=>{const n=t.value;I(g?k({id:l,viewId:o,columnIds:[i],params:{statsOption:n}}):D({tableNodeID:l,viewID:o,columnIDs:[i],updatedFields:{statsOption:n}})),null===_||void 0===_||_(n)}),[i,I,l,o,g,_,D,k]);function A(){M.current&&(clearTimeout(M.current),M.current=null)}function Z(){A(),M.current=setTimeout((()=>{T(!1)}),300)}function F(){A(),T(!0)}return(0,b.jsxs)("div",{className:Ge.statsWrap,"data-pinned":r,style:{paddingLeft:d},onMouseEnter:F,onMouseLeave:Z,children:[(0,b.jsx)("div",{className:(0,C.default)(y,{[x]:"hide"===u}),style:{width:"".concat(a,"px"),position:E?"absolute":"relative"},children:c}),E&&(0,b.jsx)(h.Ph,{className:Ge.select,variant:"borderless",onMouseEnter:F,onMouseLeave:Z,options:P,style:{width:"".concat(a,"px")},value:u,onSelect:R,disabled:!p})]})},He=(0,n.memo)((e=>{var t;const{api:i,context:n,editable:o,syncChange:l}=e,{entity:a}=(0,f.$1)(f.vK.grid),{useView:s}=a,{tableNodeId:d,viewId:r}=n,{view:u}=s(),c=Le({gridApi:i,tableNodeId:d,viewId:null!==(t=null===u||void 0===u?void 0:u.id)&&void 0!==t?t:r});return(0,b.jsx)("div",{className:Ge.inner,children:c.map((e=>{var t;return(0,b.jsx)(Be,{columnId:e.id,columnType:e.type,columnTypeOptions:e.typeOptions,width:e.width,isPinned:e.isPinned,paddingLeft:e.isPinned?46:0,tableNodeId:d,viewId:null!==(t=null===u||void 0===u?void 0:u.id)&&void 0!==t?t:r,value:e.stats.value,text:e.stats.text,editable:o,syncChange:l},e.id)}))})}));function Ve(e){return e.context.isBigTable?(0,b.jsx)("div",{}):(0,b.jsx)($e,{api:e.api,className:Ge.statusBar,children:(0,b.jsx)(He,{...e})})}var Ke=i(25354);const ze={inner:"gridGroupRowRenderer_inner__A0uba",stats:"gridGroupRowRenderer_stats__HRclM",hide:"gridGroupRowRenderer_hide__vxAGE",title:"gridGroupRowRenderer_title__BO4sO",space:"gridGroupRowRenderer_space__SAD81",renderer:"gridGroupRowRenderer_renderer__36ssc",empty:"gridGroupRowRenderer_empty__kh9tS",checkbox:"gridGroupRowRenderer_checkbox__wqAUz"},Ue=(0,n.memo)((e=>{var t;const{value:i,api:o,node:l,context:a,editable:d,syncChange:u}=e,{entity:c}=(0,f.$1)(f.vK.grid),{useView:v,useGroupKey:m,useSelector:h,FieldRender:g,EmptyCellId:y}=c,{tableNodeId:x,viewId:_,timezone:w}=a,[I,j]=(0,n.useState)(l.expanded),[k,D]=(0,n.useState)({id:"",name:"",type:"multiLineText"}),[N,E]=(0,n.useState)(!1),[T,M]=(0,n.useState)(!1),{view:S}=v(),P=(0,s.Z)(),{parseCellValue:R}=m(x,P),A=Le({gridApi:o,groupNode:l,tableNodeId:x,viewId:null!==(t=null===S||void 0===S?void 0:S.id)&&void 0!==t?t:_}),F=h((e=>e.project.members)),O=(0,n.useCallback)((()=>{l.setExpanded(!I),j(!I)}),[l,I]);(0,n.useEffect)((()=>{i&&D(R(i))}),[i,R]);const L=(0,n.useCallback)((e=>{let t=!1,i=!1;if(l.allChildrenCount){let e=0;Z()(l.allLeafChildren,(t=>{t.isSelected()&&e++})),t=e>0,i=e===l.allChildrenCount}M(t),E(t&&!i)}),[l]);(0,n.useEffect)((()=>(null===o||void 0===o||o.addEventListener("selectionChanged",L),()=>{null!==o&&void 0!==o&&o.isDestroyed()||null===o||void 0===o||o.removeEventListener("selectionChanged",L)})),[o,L]);const $=(0,n.useCallback)((e=>{Z()(l.allLeafChildren,(t=>{t.setSelected(e.target.checked)}))}),[l]);return(0,b.jsxs)("div",{className:ze.inner,children:[(0,b.jsxs)("div",{className:ze.title,"data-title":!0,onClick:O,children:[(0,b.jsx)(p.Z,{style:{marginLeft:15*l.level},type:I?"groupExpand":"groupCollapse"}),(0,b.jsx)(Ke.Z,{onClick:e=>{e.stopPropagation()},onChange:$,indeterminate:N,checked:T,className:ze.checkbox}),(0,b.jsx)("span",{className:ze.space})]}),(0,b.jsx)("div",{className:(0,C.default)(ze.renderer,k.id===y&&ze.empty),children:(0,b.jsx)(g,{className:ze.field,item:k,truncateLength:-1,members:F,timezone:w})}),r()(A,((e,t)=>{var i;const n=e.width-(0===t?60:0);return(0,b.jsx)(Be,{columnId:e.id,columnType:e.type,columnTypeOptions:e.typeOptions,width:n,isPinned:e.isPinned,tableNodeId:x,viewId:null!==(i=null===S||void 0===S?void 0:S.id)&&void 0!==i?i:_,value:e.stats.value,text:e.stats.text,editable:d,syncChange:u,statsClassName:ze.stats,hideClassName:ze.hide},e.id)}))]})}));function qe(e){const{api:t}=e,[i,o]=(0,n.useState)(0),l=(0,n.useRef)(null),a=(0,n.useCallback)((e=>{if("horizontal"===e.direction&&(o(e.left),l.current)){const t=l.current.querySelector("[data-title=true]");t&&(t.style.left="".concat(e.left,"px"));const i=l.current.querySelector("[data-pinned=true]");i&&(i.style.left="".concat(e.left,"px"))}}),[]);return(0,n.useEffect)((()=>(t.addEventListener("bodyScroll",a),()=>{t.isDestroyed()||t.removeEventListener("bodyScroll",a)})),[t,a]),(0,b.jsx)("div",{ref:l,className:ze.statusBar,style:{transform:"translateX(-".concat(i,"px)")},children:(0,b.jsx)(Ue,{...e})})}var We=i(58564);const Je=["multiLineText","singleChoice","multiChoice","formula","member","lookup","boolean"],Ye={accentedSort:!0,rowBuffer:30,getRowId:e=>e.data.id,suppressScrollOnNewData:!0,animateRows:!{NODE_ENV:"production",PUBLIC_URL:"",BUILD_VERSION:"f583796",THIRD_PARTY:"feishu-dashboard",REACT_APP_SERVER_ENV:"production",REACT_APP_AG_GRID_LICENSE_KEY:"placeholder",REACT_APP_GOOGLE_OAUTH_CLIENT_ID:"placeholder",REACT_APP_BD_KEY:"placeholder",REACT_APP_GD_TOKEN:"3ac9d33da9e7be15cbb9f1b92f285e9c",REACT_APP_GOOGLE_MAP_KEY:"AIzaSyA3amMC0r12XfqJgurQbQd0iWln7SbcbZU",REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoiZG9uZ2xlaSIsImEiOiJja3A2amE1cTMwbGQzMnBxZXF4MDEwMnRpIn0.v4ZdsImv9hprcA32ocydgw",REACT_APP_BASE_API_URL:"https://maptable.com/api",REACT_APP_LARK_BASE_API_URL:"https://maptable.net/api",REACT_APP_BOUNDARY_OSS_URL:"https://icon-cdn.maptable.com",REACT_APP_WS_URL:"wss://maptable.com/websocketd",REACT_APP_LARK_WS_URL:"wss://maptable.net/websocketd",REACT_APP_STRIPE_PUB_KEY:"pk_live_51L8b87HyKdWcfiHZBeLLIIUQKKf9Ec6UohLlnv0ZIjFfugGPZtfrGnfeQJ5yHXFeZNPya7ii4MTB5hQqXvf0CHhn004g4JMOOO",REACT_APP_STRIPE_RETURN_URL:"https://maptable.com/api/cb/stripe_payment/",REACT_APP_SENTRY_DSN:"https://1cbf40ec955b89c8c7182c2e9c3f940a@o1161772.ingest.us.sentry.io/4509296236691456",REACT_APP_CORS_DISABLE_TOKEN:"",REACT_APP_WECHAT_REDIRECT_URI:"https://maptable.com/auth/wechat",REACT_APP_RECAPTCHA_TOKEN:"6LdMgpcgAAAAAKSbHqoSMXgTg1jlTJcYer0Ss6M4",REACT_APP_MAINTAIN_FILE_URI:"https://maptable-prod-public.oss-cn-hangzhou.aliyuncs.com/prodfiles/broadcast/maintain.json",REACT_APP_CRISP_WEBSITE_ID:"e3f43195-3a5a-4bcb-bf1d-7e3d13d0376d",REACT_APP_ICON_CDN:"https://icon-cdn.maptable.com",REACT_APP_USE_RECAPTCHA:"true",REACT_APP_FEISHU_PAY_URI:"https://maptable.com/feishu/plan"}.CI,suppressMoveWhenRowDragging:!0,enableRangeSelection:!0,suppressMultiRangeSelection:!0,suppressRowClickSelection:!0,rowSelection:"multiple",rowDragManaged:!0,rowDragMultiRow:!0,tooltipShowDelay:500,enableFillHandle:!0,fillHandleDirection:"y",alwaysShowHorizontalScroll:!0,isFullWidthRow:We._l,isRowSelectable:We.Se,stopEditingWhenCellsLoseFocus:!1,suppressNoRowsOverlay:!0,reactiveCustomComponents:!0,excelStyles:[{id:"number",dataType:"Number"}],enterNavigatesVerticallyAfterEdit:!0},Xe={rowModelType:"serverSide",cacheBlockSize:500,maxBlocksInCache:10,rowData:void 0};var Qe=i(53813),et=i.n(Qe),tt=i(15972),it=i.n(tt),nt=i(11546),ot=i(34362),lt=i.n(ot),at=i(22601),st=i(11648),dt=i(26657);function rt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{editable:i,isRowSelector:n=!1,isLocked:o=!1,onDetailOpen:l}=e;return(0,st.ig)({width:70,rowDrag:i&&!o,checkboxSelection:n||i,headerCheckboxSelection:i,cellRendererParams:{onDetailOpen:l},...t})}function ut(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=arguments.length>6?arguments[6]:void 0;const{tableNodeId:s,columnData:d,updateCell:u,updateColumn:c,insertColumn:v,removeColumn:m,copyColumn:p,filterColumn:h,groupColumn:f,hideColumn:g,sortColumn:b,updatingColumns:y,editable:C,isMobile:x,isBigTable:_,isConnected:w,isLocked:I,canInsertDataColumn:j,isAdmin:k,tableNodeState:D}=e;return r()(d,((e,d)=>{var r,N,E,T;const M=e.mode,S=e.state,P=(y||[]).some((t=>t.id===e.id)),R=function(e,t,i){const n="subscribed"===e||"connected"===e?C&&!i:!i;return n&&!("locked"===t)||n&&k&&"restricted"===t}(M,S,P),A=C&&!P&&"connected"===e.mode,Z=!(!o||!n[e.id]),F=function(e,t){var i;if(!t||!lt()(nt.J1,e))return null===(i=nt.Z9[e])||void 0===i?void 0:i.sortType}(e.type,_),O="subscribed"===e.mode||"connected"===e.mode,L={enableFieldTypes:e.isPrimary?nt.Qd:_?nt.t1:void 0,editable:R,connectedUnEditable:A,typeOptions:et()(e.typeOptions),isBigTable:_,isConnected:w,canInsertDataColumn:j,timezone:a,type:e.type,name:e.name,mode:e.mode,state:e.state,desc:e.desc,sortType:F,statsOption:e.statsOption,groupOrder:null===(r=n[e.id])||void 0===r?void 0:r.order,grouping:Z,updating:P,isFirstColumn:!d,isPrimary:e.isPrimary,isLocked:I,isAdmin:k,tableNodeState:D,onColumnUpdate:c,onColumnRightInsert:v};return e.isPrimary||(L.onColumnLeftInsert=v,L.onColumnRemove=m,L.onColumnHide=g),_||(L.onColumnCopy=p,L.onColumnGroup=f),(0,at.xm)(e.type)&&(L.onColumnFilter=h),F&&(L.onColumnSort=b),(0,st.wy)(e,it()({},{valueSetter:e=>{const t=e.colDef.cellEditorParams.type;return"coordinate"===t||"attachment"===t||nt.L8.includes(t)||u(e,s),!0},lockPinned:!0,cellEditorPopup:Je.includes(e.type),cellClassRules:dt.Z,cellEditorParams:{typeOptions:et()(e.typeOptions),type:e.type,mode:e.mode,inGrid:!0,tableNodeId:s,timezone:a,viewId:t},sort:(null===(N=i[e.id])||void 0===N?void 0:N.order)||null,sortIndex:null===(E=i[e.id])||void 0===E?void 0:E.orderIndex,rowGroup:Z,rowGroupIndex:Z?null===(T=n[e.id])||void 0===T?void 0:T.groupIndex:0,pinned:!x&&(e.isPrimary&&"left"),headerComponentParams:L,resizable:O||R,suppressMovable:!C||e.isPrimary||I,hide:e.isHidden,editable:R},l))}))}function ct(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{addColumn:i,editable:n,isBigTable:o,isConnected:l,isSubscribed:a,canInsertDataColumn:s}=e;return(0,st.MP)(it()({},{headerComponentParams:{onColumnAdd:i,enableFieldTypes:l?o?nt.n_:s?void 0:nt.aE:o?nt.t1:void 0},hide:!n&&!a},t))}function vt(e,t){var i,n;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,st.ck)(it()({},{valueGetter(e){var i,n;return(null===(i=e.node)||void 0===i?void 0:i.id)===Ze._m?Number.MAX_SAFE_INTEGER:t?0:null===(n=e.node)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.order},sort:null===(i=e[Ze._m])||void 0===i?void 0:i.order,sortIndex:null===(n=e[Ze._m])||void 0===n?void 0:n.orderIndex},o))}function mt(){const e=(0,n.useRef)(void 0),t=(0,n.useCallback)((e=>{var t;const i=(0,st.Pr)(null===(t=e.column)||void 0===t?void 0:t.getColDef());return"subscribed"===(null===i||void 0===i?void 0:i.mode)||"connected"===(null===i||void 0===i?void 0:i.mode)}),[]);return{isSubscribed:t,onSubscribedCellFocused:(0,n.useCallback)((t=>{var i,n;const o=t.api,l=null===o||void 0===o||null===(i=o.getCellRanges())||void 0===i?void 0:i[0],a=null===l||void 0===l||null===(n=l.startRow)||void 0===n?void 0:n.rowIndex,s=null===l||void 0===l?void 0:l.startColumn,d=null===s||void 0===s?void 0:s.getColId();if("undefined"!==typeof a&&d!==Ze.kl&&d!==Ze.hK){var r;const i=null===o||void 0===o?void 0:o.getDisplayedRowAtIndex(a);if(null!==i&&void 0!==i&&i.group||null!==i&&void 0!==i&&i.footer)return;const n="".concat(d,"_").concat(null===i||void 0===i?void 0:i.id);(null===(r=e.current)||void 0===r?void 0:r.id)!==n&&(((e,t,i,n)=>{var o;const l=(0,st.Pr)(null===t||void 0===t||null===(o=t.column)||void 0===o?void 0:o.getColDef());if(null!==t&&void 0!==t&&t.column&&("subscribed"===(null===l||void 0===l?void 0:l.mode)||"connected"===(null===l||void 0===l?void 0:l.mode))&&i){const o=t.column.getColId(),l=[i],a=[o];if(n&&(n.colId&&n.colId!==o&&a.push(n.colId),n.rowId&&n.rowId!==i.id)){const t=null===e||void 0===e?void 0:e.getRowNode(n.rowId);t&&l.push(t)}null===e||void 0===e||e.refreshCells({rowNodes:l,columns:a,force:!0})}})(o,t,i,e.current),e.current={id:n,colId:d,rowId:null===i||void 0===i?void 0:i.id})}}),[])}}const pt=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"];var ht=i(31831);U.WN.setLicenseKey("placeholder"),te.O3h.registerModules([ie.I,ne.f,oe.jM,q.V,W.I,J.qZ,Y.$,X.V,Q.b,ee.u7]);const ft={low:void 0,middle:56,high:101},gt=e=>{let{projectId:t,tableNodeId:i,editable:o,data:l,filter:a,children:d,isBigTable:u=!1,isUpdateCollaborator:c=!0,showStatusBar:v=!0,isRowSelector:m=!1,isConnected:p=!1,isSubscribed:h=!1,canInsertDataColumn:g=!1,timezone:y,mondayFirst:C,view:x,sortByView:_=!0,prefixCls:w,locale:I,isShared:j,selectedRowIds:k,isAdmin:D,tableNodeState:N,onGridReady:T,onGridPreDestroyed:M,onRangeSelectionChange:S,onDetailOpen:P,onRowClicked:R,doesExternalFilterPass:A}=e;const{injector:F,entity:H,getState:K,dispatch:U}=(0,f.$1)(f.vK.grid),{useSorting:q,useGrouping:W,isMobile:J,useGrid:Y,useGridData:X,useGridContextMenu:Q,useMoveRows:ee,useBigTable:te,useTableRefresh:ie,useFieldConfig:ne,useCopyPaste:oe,useTableFilter:de,useCollaborator:re,useCollaboratorCells:ue,useGroupKey:ce}=H,[ve,me]=(0,n.useState)(),he=(0,n.useRef)(null),fe=(0,n.useRef)(!1),ge=(0,s.Z)(),be=x?ft[x.rowHeight]:void 0,{isSubscribed:ye,onSubscribedCellFocused:Ce}=mt(),{orders:_e,hasOrder:we}=q(i,null===x||void 0===x?void 0:x.id),{groups:Ie,hasGroup:je}=W(i,null===x||void 0===x?void 0:x.id),{resizeColumn:ke,updateCell:De,addColumn:Ne,removeColumn:Ee,insertColumn:Te,updateColumn:Me,insertRow:Se,scroll:Pe}=Y(he),{columnData:Re,rowData:Ae,updatingColumns:Fe}=X(l,x,o,u,_),{getContextMenuItems:Oe,deleteSelectedCells:Le}=Q(P),{addGridDropZone:$e,onRowDragMove:Ge,onRowDragEnd:Be}=ee(i),{fillOperation:He,processCellForClipboard:Ke,processCellFromClipboard:ze,onPasteStart:Ue,handleCopy:We,handleCut:Je}=oe(i,y,o),{doesExternalFilterPass:Qe}=de(i,null===x||void 0===x?void 0:x.id,{mondayFirst:C,timezone:y}),{onColumnMoved:et}=ne(),{setServerSideDatasource:tt}=te({tableNodeId:i,viewId:null===x||void 0===x?void 0:x.id,isShared:j,gridApi:ve},u),{collaborators:it,checkIsCollaboratorRow:nt,onCellFocused:ot}=re({viewId:null===x||void 0===x?void 0:x.id});ue({gridApi:ve,collaborators:it});const lt=(0,n.useCallback)((()=>{We(ve)}),[We,ve]),at=(0,n.useCallback)((e=>{U(ae.Nw.setHideColId(e))}),[U]),st=(0,n.useCallback)((e=>{U(ae.Nw.setFilterColId(e))}),[U]),dt=(0,n.useCallback)((e=>{U(ae.Nw.setGroupColId(e))}),[U]),gt=(0,n.useCallback)(((e,t)=>{U(ae.Nw.setSortColId({colId:e,order:t}))}),[U]),bt=(0,n.useCallback)((e=>{const t=null===ve||void 0===ve?void 0:ve.getAllGridColumns().filter((e=>e&&![Ze._m,Ze.hK,Ze.kl].includes(e.getColId()))).map((e=>e.getColDef().headerName)).filter(Boolean);return Te(e,t||[])}),[ve,Te]);(0,n.useEffect)((()=>()=>{U(ae.Nw.setFilterColId(null)),U(ae.Nw.setGroupColId(null)),U(ae.Nw.setSortColId(null)),U(ae.Nw.setHideColId(null))}),[U]);const yt=function(e){const{tableNodeId:t,view:i,columnData:o,editable:l,isMobile:a,updatingColumns:s,isRowSelector:d,isBigTable:r=!1,isConnected:u=!1,timezone:c,orders:v,hasOrder:m,groups:p,hasGroup:h,isAdmin:f,tableNodeState:g,onDetailOpen:b,updateCell:y,updateColumn:C,insertColumn:x,removeColumn:_,addColumn:w,canInsertDataColumn:I,copyColumn:j,hideColumn:k,groupColumn:D,filterColumn:N,sortColumn:E}=e,T=o.some((e=>"subscribed"===e.mode||"connected"===e.mode)),M=(0,n.useMemo)((()=>({tableNodeId:t,columnData:o,editable:l,isMobile:a,updatingColumns:s,isRowSelector:d,isBigTable:r,isConnected:u,isSubscribed:T,isAdmin:f,tableNodeState:g,onDetailOpen:b,updateCell:y,updateColumn:C,insertColumn:x,removeColumn:_,addColumn:w,canInsertDataColumn:I,copyColumn:j,hideColumn:k,groupColumn:D,filterColumn:N,sortColumn:E,isLocked:null===i||void 0===i?void 0:i.isLocked})),[t,o,l,a,s,d,r,u,T,f,g,b,y,C,x,_,w,I,j,k,N,D,E,null===i||void 0===i?void 0:i.isLocked]),S=(0,n.useMemo)((()=>{if(null===i||void 0===i||!i.id)return[];if(r){const e=[rt(M,{rowDrag:!1,editable:!1,enableCellChangeFlash:!1,suppressMovable:!1,suppressNavigable:!1,checkboxSelection:!1,headerCheckboxSelection:!1,headerCheckboxSelectionFilteredOnly:!1}),...ut(M,i.id,{},{},!1,{sortable:!1,headerComponentParams:{onColumnLeftInsert:!1,onColumnRightInsert:!1}},c)];if(T)return e;const t=ct(M,void 0),n=vt(v,m);return e.concat(t,n)}const e=rt(M,function(e){return e?{valueGetter(e){var t,i;return null!==(t=e.node)&&void 0!==t&&t.footer?"":e.node?(null===(i=e.node)||void 0===i?void 0:i.childIndex)+1:""},editable:!1,suppressNavigable:!0}:{}}(h)),t=[e,...ut(M,i.id,v,p,h,{sortable:!0},c),ct(M)];return T?t:t.concat(vt(v,m))}),[M,m,v,h,p,r,null===i||void 0===i?void 0:i.id,T,c]);return S}({tableNodeId:l.id,view:x,editable:o,columnData:Re,isMobile:J(),updatingColumns:Fe,isRowSelector:m,isBigTable:u,isConnected:p,timezone:y,orders:_e,hasOrder:we,groups:Ie,hasGroup:je,isAdmin:D,tableNodeState:N,onDetailOpen:P,updateCell:De,updateColumn:Me,insertColumn:bt,removeColumn:Ee,addColumn:Ne,canInsertDataColumn:g,copyColumn:lt,hideColumn:at,filterColumn:st,groupColumn:dt,sortColumn:gt}),{groupComparator:Ct}=ce(i,ge),{onCompositionInputFocused:xt}=function(e){const{projectId:t,editable:i,injector:o,onCopy:l,onCut:a,deleteSelectedCells:s}=e,d=(0,n.useRef)(),r=(0,n.useRef)(),u=(0,n.useRef)(),c=(0,n.useRef)(),{useUndoRedo:v}=o.get(f.vK.grid),[m,p]=(0,n.useState)(!1);v(t,(0,n.useMemo)((()=>({enabled:m,enableOnFormTags:m})),[m]));const h=(0,n.useCallback)((e=>{var t;let{api:n}=e;if(!i)return;const o=n.getFocusedCell(),l=n.getEditingCells(),a=null===o||void 0===o?void 0:o.column.getColDef();if(r.current=n,"multiLineText"===(null===a||void 0===a||null===(t=a.cellEditorParams)||void 0===t?void 0:t.type)){const e=null===o||void 0===o?void 0:o.column.getColId(),t=null===o||void 0===o?void 0:o.rowIndex,i=l.some((i=>i.column.getColId()===e&&i.rowIndex===t));if(u.current=e,c.current=t,e&&!O()(t)&&!i){var s;const i=null===(s=document.getElementById("cell_".concat(e,"_").concat(t)))||void 0===s?void 0:s.closest(".ag-cell");if(i&&d.current){const e=i.getBoundingClientRect();d.current.style.top="".concat(e.top,"px"),d.current.style.left="".concat(e.left,"px"),d.current.style.height="".concat(e.height,"px"),d.current.style.width="".concat(e.width,"px"),d.current.style.zIndex="-1",d.current.focus(),p(!0)}}}}),[i]),g=(0,n.useCallback)((e=>{r.current&&u.current&&!O()(c.current)&&r.current.startEditingCell({colKey:u.current,rowIndex:c.current,key:e})}),[]),b=(0,n.useCallback)((()=>{if(r.current&&u.current&&!O()(c.current)){const e=r.current.getDisplayedRowAtIndex(c.current);e&&e.setDataValue(u.current,"")}}),[]),y=(0,n.useCallback)((e=>{if(r.current){if("Tab"===e.key)return void r.current.tabToNextCell();const t=r.current.getFocusedCell();if(t&&void 0!==(null===t||void 0===t?void 0:t.rowIndex)&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)){const i=r.current.getDisplayedRowAtIndex(t.rowIndex),n=E()(i,"beans.navigationService.navigateToNextCell");"function"===typeof n&&n.call(E()(i,"beans.navigationService"),e,e.key,t)}}}),[]),C=(0,n.useCallback)((()=>{if(r.current&&!O()(c.current)){const e=r.current.getDisplayedRowAtIndex(c.current);null!==e&&void 0!==e&&e.isSelected()?null===e||void 0===e||e.setSelected(!1):null===e||void 0===e||e.setSelected(!0)}}),[]);return(0,n.useEffect)((()=>{if(i){const e=document.createElement("textarea");e.setAttribute("style","\n        position: absolute;\n        left: -9999px;\n        bottom: 0;\n        border: 2px solid var(--ag-range-selection-border-color, #2196f3);\n        cursor: default;\n        resize: none;\n        outline: none;\n        padding-right: 7px;\n        padding-left: 7px;\n        "),e.tabIndex=-1,document.body.appendChild(e),e.addEventListener("input",(e=>{e.isComposing||g(e.data)})),e.addEventListener("paste",(e=>{var t;e.preventDefault(),null===(t=r.current)||void 0===t||t.pasteFromClipboard()})),e.addEventListener("copy",(e=>{e.preventDefault(),l(r.current)})),e.addEventListener("cut",(e=>{e.preventDefault(),a(r.current)})),e.addEventListener("compositionstart",(()=>{b(),e.style.zIndex="2"})),e.addEventListener("compositionend",(t=>{g(t.data),e.style.zIndex="-1"})),e.addEventListener("blur",(()=>{e.value="",e.style.zIndex="-1",p(!1)})),e.addEventListener("keydown",(e=>{pt.includes(e.key)&&y(e),"Backspace"!==e.key&&"Delete"!==e.key||s(r.current),"Space"===e.code&&(e.preventDefault(),e.isComposing||C())})),d.current=e}else{var e;null===(e=d.current)||void 0===e||e.remove(),d.current=void 0}}),[g,b,y,C,l,a,s,i]),(0,n.useEffect)((()=>()=>{if(d.current)try{document.body.removeChild(d.current)}catch(e){}}),[]),{onCompositionInputFocused:h}}({projectId:t,injector:F,editable:o,onCopy:We,onCut:Je,deleteSelectedCells:Le}),_t=(0,n.useCallback)((e=>{ye(e)?Ce(e):c&&ot(e),xt(e)}),[ye,c,ot,Ce,xt]),wt=(0,n.useCallback)((e=>{if(e.node.id===Ze._m||e.node.group)return e.node.footer&&!e.node.leafGroup?0:32}),[]),It=(0,n.useCallback)((e=>{if(e.node.footer&&!e.node.leafGroup)return{display:"none"}}),[]);ie({gridApi:ve,tableNodeId:i}),(0,n.useEffect)((()=>{null!==ve&&void 0!==ve&&ve.isDestroyed()||u||(fe.current=!le.K.isEmpty(a),null===ve||void 0===ve||ve.onFilterChanged(),null===ve||void 0===ve||ve.refreshCells())}),[a,ve,u]),(0,n.useEffect)((()=>{null!==ve&&void 0!==ve&&ve.isDestroyed()||null===ve||void 0===ve||ve.refreshCells()}),[ve,null===x||void 0===x?void 0:x.orders]),(0,n.useEffect)((()=>{null!==ve&&void 0!==ve&&ve.isDestroyed()||(null===ve||void 0===ve||ve.refreshCells({force:!0}),null===ve||void 0===ve||ve.resetRowHeights())}),[be,ve]),(0,n.useEffect)((()=>{null!==ve&&void 0!==ve&&ve.isDestroyed()||ve&&m&&k&&null!==Ae&&void 0!==Ae&&Ae.length&&Z()(k,((e,t)=>{var i;null===(i=ve.getRowNode(t))||void 0===i||i.setSelected(!0)}))}),[ve,m,k,Ae]);const jt=(0,n.useCallback)((e=>{var t;const i=e.api.getAllDisplayedColumns();if(u||(null===(t=V()(i))||void 0===t?void 0:t.getColId())===Ze.hK){var n,o;const t=null===(n=e.column)||void 0===n?void 0:n.getColId();if(t===Ze.hK)return;let i;e.column&&(i=e.api.getDisplayedColBefore(e.column)),et(t,null===(o=i)||void 0===o?void 0:o.getColDef().field)}else e.api.moveColumns([Ze.hK],i.length-1)}),[et,u]),kt=(0,n.useCallback)((e=>{if(e.finished&&S){const t=z()(e.api.getCellRanges()),i=[],n=null===t||void 0===t?void 0:t.startRow,o=null===t||void 0===t?void 0:t.endRow;if(n&&o){const t=Math.min(n.rowIndex,o.rowIndex),l=Math.max(n.rowIndex,o.rowIndex);for(let n=t;n<=l;n++){const t=e.api.getDisplayedRowAtIndex(n);t&&t.id&&!t.group&&i.push(t.id)}}const l={columnIds:r()(null===t||void 0===t?void 0:t.columns,(e=>e.getId())),rowIds:i};S(l)}}),[S]),Dt=(0,n.useCallback)((e=>{var t;"INPUT"!==(t=e.target).tagName&&"TEXTAREA"!==t.tagName&&((e.metaKey||e.ctrlKey)&&"c"===e.key&&We(ve),(e.metaKey||e.ctrlKey)&&"x"===e.key&&Je(ve))}),[ve,We,Je]),Nt=(0,n.useCallback)((e=>{(o||h)&&ke(e,x)}),[ke,x,o,h]),Et=(0,n.useCallback)((e=>{me(e.api),null===T||void 0===T||T(e.api),$e(e),u&&tt(e.api)}),[$e,u,T,tt]),Tt=(0,n.useCallback)((e=>{me(void 0),null===M||void 0===M||M(e.api)}),[M]),Mt=(0,n.useCallback)((e=>{const t=e.rowIndex,i=null===ve||void 0===ve?void 0:ve.getDisplayedRowAtIndex(t+1);i&&i.id===Ze._m&&(null===ve||void 0===ve||ve.clearRangeSelection(),null===ve||void 0===ve||ve.setFocusedCell(t,e.column),null===ve||void 0===ve||ve.addCellRange({rowStartIndex:t,rowEndIndex:t,columns:[e.column]}))}),[ve]),St=(0,n.useCallback)((e=>{var t,i,n,o;let{event:l,editing:a,colDef:s,api:d}=e;const r="singleChoice"===(null===(t=s.headerComponentParams)||void 0===t?void 0:t.type)||"multiChoice"===(null===(i=s.headerComponentParams)||void 0===i?void 0:i.type);return!("Enter"!==l.key||!a||!r)||(!("Enter"!==l.key||!a||"datetime"!==(null===(n=s.cellEditorParams)||void 0===n?void 0:n.type))||(a||"Backspace"!==l.key&&"Delete"!==l.key?!("multiLineText"!==(null===(o=s.cellEditorParams)||void 0===o?void 0:o.type)||"Enter"!==l.key||!l.shiftKey):(Le(d)||L.ZP.info(ge.$t({id:"9LSkIw",defaultMessage:"The formula field cannot be emptied"})),!0)))}),[ge,Le]),Pt=(0,n.useMemo)((()=>({getState:K,dispatch:U,tableNodeId:i,viewId:null===x||void 0===x?void 0:x.id,rowHeight:null===x||void 0===x?void 0:x.rowHeight,timezone:y,isBigTable:u,injector:F})),[K,i,null===x||void 0===x?void 0:x.id,null===x||void 0===x?void 0:x.rowHeight,y,u,F,U]),Rt=(0,n.useMemo)((()=>({suppressKeyboardEvent:St})),[St]),At=(0,n.useMemo)((()=>({"ag-grid-collaborator-row":nt})),[nt]),Zt=(0,n.useMemo)((()=>({tableNodeId:i,onRowAdd:Se,onDetailOpen:P})),[i,Se,P]),Ft=(0,n.useCallback)((()=>fe.current),[]),Ot=(0,n.useCallback)((e=>{e.api.deselectAll();const t=e.api.getEditingCells(),i=e.api.getFocusedCell();0===t.length&&i&&e.api.setFocusedCell(i.rowIndex,i.column)}),[]),Lt={...Ye,columnDefs:yt,rowHeight:be,rowData:Ae,gridWrap:he,suppressContextMenu:!o,rowClassRules:At,defaultColDef:Rt,context:Pt,fullWidthCellRenderer:pe,fullWidthCellRendererParams:Zt,fillOperation:He,getContextMenuItems:Oe,doesExternalFilterPass:null!==A&&void 0!==A?A:Qe,processCellForClipboard:Ke,processCellFromClipboard:ze,onGridReady:Et,onGridPreDestroyed:Tt,onPasteStart:Ue,onKeyDown:Dt,onRowDragEnd:Be,onRowDragMove:Ge,onColumnResized:Nt,onColumnMoved:jt,onCellFocused:_t,onCellEditingStopped:Mt,onBodyScroll:Pe,onRangeSelectionChanged:kt,onCellMouseDown:Ot,onRowClicked:R,isExternalFilterPresent:Ft},$t=(0,n.useCallback)((e=>{const{nodeA:t,nodeB:i}=e;return Ct(t,i)}),[Ct]),Gt=(0,n.useMemo)((()=>({editable:o||j,syncChange:!j})),[o,j]);u||(Lt.groupDefaultExpanded=-1,Lt.groupDisplayType="groupRows",Lt.groupRowRenderer=qe,Lt.groupRowRendererParams=Gt,Lt.groupTotalRow="bottom",Lt.initialGroupOrderComparator=$t,Lt.getRowHeight=wt,Lt.getRowStyle=It);const Bt=(0,n.useMemo)((()=>({statusPanels:[{statusPanel:xe,align:"left"},{statusPanel:Ve,align:"center",key:"advancedStatusBar",statusPanelParams:{editable:o||j,syncChange:!j}}]})),[o,j]);return v&&(Lt.statusBar=Bt),u&&Object.assign(Lt,Xe),(0,b.jsx)($.ZP,{prefixCls:w,button:{autoInsertSpace:!1},locale:"zh-CN"!==I?B.Z:G.Z,children:(0,b.jsxs)("div",{style:{height:"100%"},children:[(0,b.jsx)(ht.M,{testId:"grid",...Lt},i),n.isValidElement(d)&&n.cloneElement(d,{container:he.current}),(0,b.jsx)(se.zZ,{})]})})},bt=n.memo(gt),yt={preview:"relatedEditorModal_preview__D9wYG",loading:"relatedEditorModal_loading__l26bO"},Ct=e=>{let{value:t,typeOptions:i,dialog:o,onOk:l,onCancel:a}=e;const d=(0,s.Z)(),{entity:u}=(0,f.$1)(f.vK.related),{useParameters:v,useWorkspaces:m,useProject:p,useTableNodeDetail:g,useTableFilter:y,formatDateByRule:C,useView:x,useSelector:_,config:w}=u,{workspaceId:I,workspaceType:j,projectId:k,tableNodeId:D}=v(),N=_((e=>e.app.newLocale)),{view:E}=x(null===i||void 0===i?void 0:i.relatedTableNodeID,null===i||void 0===i?void 0:i.relatedViewID,k),{workspace:T}=m(j,I),{project:M}=p(T,k),{filter:P,doesExternalFilterPass:A}=y(null===i||void 0===i?void 0:i.relatedTableNodeID,null===i||void 0===i?void 0:i.relatedViewID,{mondayFirst:null===M||void 0===M?void 0:M.weekStartOnMonday,timezone:null===M||void 0===M?void 0:M.timezone}),F=(0,n.useMemo)((()=>{var e;return null===(e=c()(null===M||void 0===M?void 0:M.tableNodes,(e=>e.id===(null===i||void 0===i?void 0:i.relatedTableNodeID))))||void 0===e?void 0:e.name}),[null===M||void 0===M?void 0:M.tableNodes,null===i||void 0===i?void 0:i.relatedTableNodeID]),L=(0,n.useMemo)((()=>{var e;return null===(e=c()(null===M||void 0===M?void 0:M.tableNodes,(e=>e.id===D)))||void 0===e?void 0:e.name}),[null===M||void 0===M?void 0:M.tableNodes,D]),{data:$,isFetching:G}=g(k,null===i||void 0===i?void 0:i.relatedTableNodeID),B=(0,n.useMemo)((()=>{if($)return c()($.columns,(e=>e.isPrimary))}),[$]),H=(0,n.useMemo)((()=>{const e={};return Z()(t,(t=>{e[t.rowID]=!0})),e}),[t]),[V,K]=(0,n.useState)();return(0,b.jsxs)(h.Vq,{visible:o.visible,className:yt.modal,width:640,title:"".concat(d.$t({id:"QDSjL3",defaultMessage:"Select related table"}),": ").concat(F),onCancel:a,onOk:function(){if(V&&B){var e;const t=r()(null===(e=V.getSelectedNodes())||void 0===e?void 0:e.filter((e=>!O()(e.id))),(e=>{var t,i;const n=null!==(t=null===(i=e.data)||void 0===i?void 0:i[null===B||void 0===B?void 0:B.id])&&void 0!==t?t:"",o="datetime"===B.type?C(n,B.typeOptions,null===M||void 0===M?void 0:M.timezone):R()(n);return{rowID:e.id,displayName:o}}));l(t)}else a()},children:[(0,b.jsx)("div",{children:"".concat(d.$t({id:"WLvWZU",defaultMessage:"Related table"}),"\uff1a").concat(L)}),(0,b.jsxs)("div",{className:yt.preview,children:[!G&&$&&(null===i||void 0===i?void 0:i.relatedViewID)&&(0,b.jsx)(bt,{projectId:k,tableNodeId:$.id,prefixCls:w.antdPrefix,locale:null!==N&&void 0!==N?N:"zh-CN",view:E,editable:!1,data:$,filter:P.filter,doesExternalFilterPass:A,isRowSelector:!0,isBigTable:!1,isUpdateCollaborator:!1,showStatusBar:!1,selectedRowIds:H,timezone:null===M||void 0===M?void 0:M.timezone,mondayFirst:null===M||void 0===M?void 0:M.weekStartOnMonday,onGridReady:function(e){K(e)}}),G&&(0,b.jsx)("div",{className:yt.loading,children:(0,b.jsx)(S.Z,{size:"large"})})]})]})},xt=e=>{const{hideRenderer:t,typeOptions:i,stopEditing:o,inGrid:l=!1,value:a,save:s,onChange:d}=e,{entity:r,injector:u}=(0,f.$1)(f.vK.related),{useDialogState:c}=r,v=c(l),p=(0,n.useCallback)((()=>{v.open()}),[v]),h=(0,n.useCallback)((e=>{_()(a)||(null===d||void 0===d||d(m()(a,(t=>t.rowID!==e.rowID))),setTimeout((()=>null===o||void 0===o?void 0:o()),0))}),[a,d,o]),g=(0,n.useCallback)((e=>{null===o||void 0===o||o(),l||(v.close(),e&&s&&s(e))}),[o,l,v,s]),y=(0,n.useCallback)((()=>{g()}),[g]),C=(0,n.useCallback)((e=>{null===d||void 0===d||d(e),setTimeout((()=>g(e)),0)}),[d,g]);return(0,b.jsxs)(b.Fragment,{children:[!t&&(0,b.jsx)(I,{value:a,inGrid:l,editable:!0,onAdd:p,onRemove:h,injector:u}),(0,b.jsx)(Ct,{dialog:v,value:a,typeOptions:i,onOk:C,onCancel:y})]})}},63796:(e,t,i)=>{i.d(t,{nM:()=>ue,O1:()=>oe,v9:()=>P,V5:()=>se});var n=i(57435),o=i(95620),l=i(17722),a=i(27371),s=i(89166),d=i(33718),r=i(7070),u=i.n(r),c=i(19087),v=i.n(c),m=i(23903),p=i.n(m),h=i(5512),f=i.n(h),g=i(78587),b=i.n(g),y=i(96271),C=i(19735),x=i(83580),_=i(75801),w=i(57878);const I="selectEditor_option__vE8KP",j="selectEditor_tag__KwXqb",k="selectEditor_select__xAnSu",D="selectEditor_singleSelect__5p-e4",N="selectEditor_multiSelect__W0kA0",E="selectEditor_tagName__inoY-",T="selectEditor_addChoice__EQd7M",M="selectEditor_addChoiceBtn__MSABt";var S=i(94553);const P=e=>{var t,i;const{inGrid:r=!1,disabled:c,size:m="middle",stopEditing:h,tableNodeId:g,allowAddChoice:P=!0,eGridCell:R,localChoiceOptions:A=[],onLocalColumnChoiceAdd:Z}=e,{entity:F,dispatch:O}=(0,_.$1)(_.vK.common),{useParameters:L,updateColumn:$}=F,{tableNodeId:G}=L(),B=g||G,H=(0,n.useRef)(e.value||void 0),[,V]=(0,n.useState)(0),{type:K,onBlur:z=v(),onChange:U}=e,{typeOptions:q}=(0,w.P)(e),W=(0,n.useRef)(null),[J,Y]=(0,n.useState)(!1),[X,Q]=(0,n.useState)(""),[ee,te]=(0,n.useState)(!1),ie=(0,o.Z)(),ne=(0,n.useMemo)((()=>{var e;return Object.assign({},q,{choices:[...null!==(e=q.choices)&&void 0!==e?e:[],...A]})}),[A,q]),oe=(0,n.useCallback)((e=>{var t;(H.current=e,null===U||void 0===U||U(e),V((e=>e+1)),"singleChoice"===K)&&(null===(t=W.current)||void 0===t||t.blur())}),[U,K]),le=(0,n.useCallback)((e=>{const t="singleChoice"===K?e:H.current?[...H.current,e]:[e];null===oe||void 0===oe||oe(t)}),[K,oe]),ae=(0,n.useCallback)((async()=>{var t;if(""===X.trim())return void a.ZP.warning(ie.$t({id:"OLA01a",defaultMessage:"Option cannot be empty"}));let i;if(null!==(t=e.colDef)&&void 0!==t&&t.field){var n;if(Z){var o;const e={color:null!==(o=f()(Object.keys(y.Jp)))&&void 0!==o?o:"redLight",name:X};i=Z(e)}else if(B){te(!0);try{var l,s,d,r,u;const{payload:t}=await O($({id:B,columnId:null===(l=e.colDef)||void 0===l?void 0:l.field,name:null===(s=e.colDef)||void 0===s?void 0:s.headerName,typeOptions:{...q,choices:[...q.choices,{color:null!==(d=f()(Object.keys(y.Jp)))&&void 0!==d?d:"redLight",name:X}]}})),n=null===t||void 0===t?void 0:t.wsSyncedData;i=null===(r=p()(null===n||void 0===n||null===(u=n.updatedFields)||void 0===u||null===(u=u.typeOptions)||void 0===u?void 0:u.choices,(e=>e.name===X)))||void 0===r?void 0:r.id}finally{te(!1)}}i&&le(i),null===(n=W.current)||void 0===n||n.blur()}}),[X,null===(t=e.colDef)||void 0===t?void 0:t.field,null===(i=e.colDef)||void 0===i?void 0:i.headerName,ie,Z,B,le,O,$,q]);(0,n.useEffect)((()=>{if(b()(e.value))H.current=e.value;else{var t;const i=null===q||void 0===q||null===(t=q.choices)||void 0===t?void 0:t.find((t=>t.id===e.value));null!==i&&void 0!==i&&i.name?H.current=e.value:H.current=void 0}var i;(V((e=>e+1)),r)&&(null===(i=W.current)||void 0===i||i.focus())}),[e.value,q,r]);const se=(0,n.useMemo)((()=>P?{notFoundContent:(0,S.jsxs)(s.ZP,{type:"link",loading:ee,onClick:ae,className:M,children:[ie.$t({id:"rRm3l8",defaultMessage:"Create options"}),(0,S.jsx)("span",{className:T,children:X})]})}:{}),[P,X,ee,ie,ae]),de=(0,n.useCallback)((e=>{if("Enter"===e.key&&X){const e=p()(null===ne||void 0===ne?void 0:ne.choices,(e=>{var t;return-1!==(null===(t=e.name)||void 0===t?void 0:t.indexOf(X))}));if(e)return void(H.current=e.id);ae()}}),[X,null===ne||void 0===ne?void 0:ne.choices,ae]);return(0,S.jsx)(x.Ph,{ref:W,onInputKeyDown:de,style:{width:null===R||void 0===R?void 0:R.clientWidth,minHeight:null===R||void 0===R?void 0:R.clientHeight},value:H.current,open:J,disabled:c,className:(0,d.default)(k,{[D]:"singleChoice"===K,[N]:"multiChoice"===K}),variant:r?"borderless":"outlined",autoFocus:r,placeholder:ie.$t({id:"xmcVZ0",defaultMessage:"Search"}),filterOption:(e,t)=>!(null===t||void 0===t||!t.title)&&String(t.title).includes(e),showSearch:!0,onSearch:Q,tagRender:e=>{var t;const{value:i,closable:n,onClose:o}=e,a=null===ne||void 0===ne||null===(t=ne.choices)||void 0===t?void 0:t.find((e=>e.id===i));return null!==a&&void 0!==a&&a.name?(0,S.jsx)(l.Z,{className:j,color:(0,C.O)(a.color,"bg"),closable:n,onClose:o,children:(0,S.jsx)("span",{className:E,style:{color:(0,C.O)(a.color,"text")},children:a.name})}):(0,S.jsx)(S.Fragment,{})},mode:"multiChoice"===K?"multiple":void 0,onBlur:function(){null===h||void 0===h||h(!0),z(H.current),Y(!1)},onChange:oe,allowClear:"singleChoice"===K,getPopupContainer:e=>e.parentElement,onFocus:()=>Y(!0),size:m,...se,children:u()(null===ne||void 0===ne?void 0:ne.choices,(e=>(0,S.jsx)(x.Ph.Option,{value:e.id,title:e.name,children:(0,S.jsx)("div",{className:I,children:(0,S.jsx)(l.Z,{className:j,color:(0,C.O)(e.color,"bg"),children:(0,S.jsx)("span",{style:{color:(0,C.O)(e.color,"text")},children:e.name})})})},e.id)))})};var R=i(10485),A=i(89614),Z=i(7639),F=i(23705),O=i(79246),L=i(88716),$=i.n(L),G=i(56356),B=i.n(G),H=i(68429);const V="selectConfig_list__UY+v8",K="selectConfig_movableItem__WZaK4",z="selectConfig_icon__eEg+O",U="selectConfig_input__KLdrM",q="selectConfig_colorPalette__nCtzS",W="selectConfig_blankRow__j0Jyi",J="selectConfig_active__Y9o9u",Y="selectConfig_colorPicker__qkHbv",X="selectConfig_colorPickerButton__+aqrB",Q="selectConfig_colorPickerDropdown__rUHpA",ee="selectConfig_color__P-xGH",te="selectConfig_errors__3kQPE",ie=e=>{const{onChange:t=v(),value:i}=e,[o,l]=(0,n.useState)(!1),[a,s]=(0,n.useState)(i);(0,n.useEffect)((()=>{s(i)}),[i]);return(0,S.jsx)(R.Z,{content:()=>{const e=Object.entries(y.R$).map((e=>({name:e[0],color:e[1]})));return(0,S.jsx)("div",{className:q,children:e.map(((e,i)=>(0,S.jsxs)(n.Fragment,{children:[(0,S.jsx)("div",{className:(0,d.default)(ee,e.name===a&&J),style:{background:e.color},onClick:()=>{return i=e.name,s(i),t(i),void l(!1);var i}}),(9===i||19===i)&&(0,S.jsx)("div",{className:W})]},i)))})},placement:"left",open:o,trigger:"click",onOpenChange:l,children:(0,S.jsx)("div",{className:Y,children:(0,S.jsx)("div",{className:X,style:{background:a&&y.R$[a]},onClick:()=>l(!0),children:(0,S.jsx)("div",{className:Q})})})})},ne=n.forwardRef(((e,t)=>{let{children:i,...n}=e;return(0,S.jsx)("div",{ref:t,...n,className:K,children:i})})),oe=e=>{let{selectOptions:t,form:i}=e;const[l]=A.Z.useForm(),a=(0,n.useRef)(),d=(0,o.Z)();function r(e){var t;return null===(t=a.current)||void 0===t||null===(t=t.querySelectorAll("input"))||void 0===t?void 0:t[e]}return(0,n.useEffect)((()=>{$()(t)||l.setFieldsValue({choices:t})}),[l,t]),(0,n.useImperativeHandle)(i,(()=>l)),(0,S.jsx)(A.Z,{form:l,autoComplete:"off",validateTrigger:"onSubmit",children:(0,S.jsx)(A.Z.List,{name:"choices",initialValue:[{color:"redLight",name:""}],rules:[{validator:async(e,t)=>{if(null!==t&&void 0!==t&&t.some((e=>$()(e.name))))return Promise.reject(new Error(d.$t({id:"OLA01a",defaultMessage:"Option cannot be empty"})))}}],children:(e,t,i)=>{let{add:n,remove:o,move:l}=t,{errors:u}=i;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(F.aV,{lockVertically:!0,values:e,onChange:e=>{let{oldIndex:t,newIndex:i}=e;return l(t,i)},renderList:e=>{let{children:t,props:i}=e;return a.current=i.ref.current,(0,S.jsx)("ul",{...i,className:V,children:t})},renderItem:e=>{let{value:t,props:i}=e;return(0,S.jsx)(ne,{...i,children:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s.ZP,{type:"text",size:"small","data-movable-handle":!0,icon:(0,S.jsx)(H.Z,{type:"movable",className:z})}),(0,S.jsx)(A.Z.Item,{noStyle:!0,name:[t.name,"color"],children:(0,S.jsx)(ie,{})}),(0,S.jsx)(A.Z.Item,{noStyle:!0,name:[t.name,"name"],rules:[{required:!0}],children:(0,S.jsx)(Z.default,{placeholder:d.$t({id:"KdpSoB",defaultMessage:"Please enter option"}),className:U,onPressEnter:e=>{var t;if($()(B()(e.currentTarget.value)))return;const o=(null!==(t=null===i||void 0===i?void 0:i.key)&&void 0!==t?t:0)+1,l=r(o);l?l.focus():(n({color:f()(Object.keys(y.Jp))}),setTimeout((()=>{const e=r(o);null===e||void 0===e||e.focus()})))}})}),(0,S.jsx)(s.ZP,{type:"text",size:"small",onClick:()=>o(t.name),icon:(0,S.jsx)(H.Z,{type:"close",className:z})})]})})}}),(0,S.jsx)(A.Z.ErrorList,{errors:u,className:te}),(0,S.jsx)(A.Z.Item,{children:(0,S.jsx)(s.ZP,{icon:(0,S.jsx)(O.Z,{}),size:"small",type:"link",onClick:()=>n({color:f()(Object.keys(y.Jp))}),children:d.$t({id:"mvYCOs",defaultMessage:"New option"})})})]})}})})},le="selectRenderer_renderer__99P4b",ae="selectRenderer_tag__AH8ct",se=e=>{const{value:t,typeOptions:i}=e;let n=[];if(t)if(Array.isArray(t))n=t.flatMap((e=>{const t=p()(null===i||void 0===i?void 0:i.choices,(t=>t.id===e));return t?[t]:[]}));else{const e=p()(null===i||void 0===i?void 0:i.choices,(e=>e.id===t));n=e?[e]:[]}return 0===n.length&&"string"===typeof t?(0,S.jsx)("span",{className:ae,children:t}):(0,S.jsx)("div",{className:(0,d.default)(le,e.className),children:n.filter((e=>void 0!==e.name)).map(((e,t)=>{var i;if(null!==e&&void 0!==e&&null!==(i=e.color)&&void 0!==i&&i.bgColor){const i=e.color;return(0,S.jsx)("span",{className:ae,style:{backgroundColor:i.bgColor,color:i.textColor},children:e.name},t)}{const i=e.color,n=i?y.R$[i]:void 0,o=Object.keys(y.Cq).includes(i)?"#fff":void 0;return(0,S.jsx)("span",{className:ae,style:{backgroundColor:n,color:o},children:e.name},t)}}))})};var de=i(46940),re=i(98030);class ue extends re.Z{init(e){var t;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const i=this.createEL();i.innerHTML=de.renderToStaticMarkup((0,S.jsx)(se,{value:this.value,typeOptions:this.typeOptions})),this.eGui=this.withDecoration(i,null===(t=this.params)||void 0===t?void 0:t.collaborator,de.renderToStaticMarkup((0,S.jsx)(H.Z,{type:"sync"})))}getGui(){return this.eGui}}},85513:(e,t,i)=>{i.d(t,{U:()=>m,O:()=>r});var n=i(7070),o=i.n(n),l=i(67513),a=i(75801);const s={wrap:"userRenderer_wrap__cq4BS",user:"userRenderer_user__V3MWQ",avatar:"userRenderer_avatar__FSMgn",avatarDefault:"userRenderer_avatarDefault__lHwFJ"};var d=i(94553);const r=e=>{const{value:t,members:i,injector:n}=e,{getPublicThumbnailUrl:r}=n.get(a.vK.common);return(0,d.jsx)("div",{className:s.wrap,children:o()(t,(e=>{const t=null===i||void 0===i?void 0:i.find((t=>t.id===e));return t?(0,d.jsxs)("div",{className:s.user,children:[t.avatar?(0,d.jsx)("img",{className:s.avatar,src:r(t.avatar),alt:t.name}):(0,d.jsx)("div",{className:s.avatarDefault,children:(0,d.jsx)(l.Z,{})}),(0,d.jsx)("span",{className:s.name,children:t.name})]},e):null}))})};var u=i(46940),c=i(68429),v=i(98030);class m extends v.Z{init(e){var t;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const i=this.createEL();i.innerHTML=u.renderToStaticMarkup((0,d.jsx)(r,{value:this.value,injector:this.params.context.injector})),this.eGui=this.withDecoration(i,null===(t=this.params)||void 0===t?void 0:t.collaborator,u.renderToStaticMarkup((0,d.jsx)(c.Z,{type:"sync"})))}getGui(){return this.eGui}}},31831:(e,t,i)=>{i.d(t,{M:()=>l});var n=i(57875),o=i(94553);function l(e){const{testId:t,className:i,gridWrap:l,onKeyDown:a}=e;return(0,o.jsx)("div",{ref:l,className:i||"ag-theme-alpine",style:{height:"100%"},onKeyDown:a,"data-testid":t,children:(0,o.jsx)(n.s,{...e})})}},26657:(e,t,i)=>{i.d(t,{Z:()=>l});var n=i(63679),o=i.n(n);const l={"highlight-cell":function(e){const{context:t,node:i,colDef:n}=e,l=t.getState();return-1!==o()(l.tableNode.searchResults,(e=>e.colId===(null===n||void 0===n?void 0:n.field)&&e.rowIndex===i.rowIndex))}}},11648:(e,t,i)=>{i.d(t,{wy:()=>kt,MP:()=>wt,ig:()=>jt,ck:()=>It,Pr:()=>Dt});var n=i(53813),o=i.n(n),l=i(57435),a=i(95620),s=i(27371),d=i(10485),r=i(47752),u=i(79246),c=i(98238),v=i(18451),m=i(79129),p=i(84527),h=i.n(p),f=i(7639),g=i(71105),b=i(15905),y=i(89166),C=i(85427),x=i(33718),_=i(68429),w=i(11546),I=i(45818),j=i(83580),k=i(75801),D=i(49544),N=i(17087),E=i(63796);const T="formulaEditor_textarea__B5hXW",M="formulaEditor_hint__fcrHp";var S=i(94553);const{TextArea:P}=f.default,R=e=>{var t;const{inGrid:i=!1,typeOptions:n,value:o}=e,l="boolean"===(null===n||void 0===n?void 0:n.expectedType),s=(0,a.Z)();return(0,S.jsxs)("div",{style:{width:null===(t=e.eGridCell)||void 0===t?void 0:t.clientWidth},children:[(0,S.jsx)(P,{className:T,variant:i?"borderless":"outlined",value:l?o?"true":"false":o,readOnly:!0,autoSize:{minRows:2,maxRows:5}}),(0,S.jsx)("div",{className:M,children:s.$t({id:"V9YJWn",defaultMessage:"This column is computed automatically"})})]})};var A=i(89614),Z=i(11347),F=i(57316),O=i(19087),L=i.n(O),$=i(74720),G=i.n($),B=i(13307),H=i.n(B);const V={editorWrapper:"formulaExpressionEditor_editorWrapper__-yvUx",editor:"formulaExpressionEditor_editor__RxEPN",empty:"formulaExpressionEditor_empty__xg9Fj",invalid:"formulaExpressionEditor_invalid__OQiF8",emptyMessage:"formulaExpressionEditor_emptyMessage__UVyBl",error:"formulaExpressionEditor_error__17YYo",groupContainer:"formulaExpressionEditor_groupContainer__J-+5r",groupTitle:"formulaExpressionEditor_groupTitle__fC7RV",icon:"formulaExpressionEditor_icon__maofw",formulaOperators:"formulaExpressionEditor_formulaOperators__IGi4Y"},K={popover:"popover_popover__m0-V1",popoverTitle:"popover_popoverTitle__3fKpt",popoverDescription:"popover_popoverDescription__rXli7",itemTitle:"popover_itemTitle__lduwk",itemValue:"popover_itemValue__txxxH"};function z(e){var t;let{formula:i}=e;const n=(0,a.Z)();return(0,S.jsxs)("div",{className:K.popover,children:[(0,S.jsx)("div",{className:K.popoverTitle,children:i.declaration}),(0,S.jsx)("div",{className:K.popoverDescription,children:n.$t({id:i.description,defaultMessage:[]})}),(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:K.itemTitle,children:n.$t({id:"xrCRnH",defaultMessage:"Example"})}),(0,S.jsx)("div",{className:K.itemValue,children:i.example})]}),null===(t=i.args)||void 0===t?void 0:t.map((e=>(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:K.itemTitle,children:n.$t({id:e.name,defaultMessage:[]})}),(0,S.jsx)("div",{className:K.itemValue,children:n.$t({id:e.description,defaultMessage:[]})})]},e.name)))]})}const U=200;function q(e){const t=(0,a.Z)(),{entity:i}=(0,k.$1)(k.vK.formula),{useContentEditor:n,useFormula:o,checkFormula:s}=i,{columnId:r,formula:u="",onChange:c=L(),onValid:v=L()}=e,m=(0,l.useRef)(null),[p,h]=(0,l.useState)(0),{range:f,autoCompleteText:g,formulaExpression:b,insertNode:y,removeNode:C}=n(m,p,u),[w,I]=(0,l.useState)(u),{formulaGroups:j,computableColumns:D,viewColumns:N,getFieldNode:E,getFormulaNode:T}=o(g),[M,P]=(0,l.useState)(!0),[R,A]=(0,l.useState)(""),[Z,F]=(0,l.useState)(!u),O=(0,l.useCallback)((async e=>{var i;const n=await s(e),o=null!==(i=n.message)&&void 0!==i?i:"formula.error.format";let l=o;if(String(o).startsWith("formula.error.")){const e=G()(n,"detail.funcName","");l=t.$t({id:o,defaultMessage:[]},{func:e})}const a="OK"===o;P(a),v(a,e),A(l),c(a?e:"")}),[t,c,v,s]),$=(0,l.useRef)(H()(O,U));(0,l.useEffect)((()=>{$.current=H()(O,U)}),[O]),(0,l.useEffect)((()=>{b?(b!==w?(I(b),$.current(b)):c(b),F(!1)):(F(!0),c(""))}),[b,w,c]);const B=()=>{document.activeElement===m.current&&h(Date.now())},K=(e,t)=>{t.preventDefault(),"clear"===e?m.current&&(m.current.textContent=""):"delete"===e?C():y(e,!0)};(0,l.useEffect)((()=>{m.current&&!f&&m.current.focus(),document.onselectionchange=B}),[m,f]);return(0,l.useLayoutEffect)((()=>{const e=new MutationObserver((e=>{e.forEach((e=>{var t,i;"childList"===e.type&&("\n"!==(null===(t=m.current)||void 0===t||null===(t=t.lastChild)||void 0===t?void 0:t.textContent)&&(null===(i=m.current)||void 0===i||i.appendChild(document.createTextNode("\n"))))}))}));return m.current&&e.observe(m.current,{childList:!0,subtree:!0}),()=>{e.disconnect()}}),[]),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:V.editorWrapper,children:[(0,S.jsx)("div",{ref:m,className:(0,x.default)(V.editor,Z?V.empty:"",M?"":V.invalid),contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:B,onMouseDown:B}),Z&&(0,S.jsx)("div",{className:V.emptyMessage,children:t.$t({id:"Wv/nEG",defaultMessage:"Please insert a column or formula"})})]}),(0,S.jsx)("div",{className:V.error,children:!Z&&!M&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(_.Z,{type:"info"}),R]})}),(0,S.jsxs)("div",{className:V.formulaOperators,children:[(0,S.jsx)("span",{onClick:e=>K("+",e),children:"+"}),(0,S.jsx)("span",{onClick:e=>K("-",e),children:"-"}),(0,S.jsx)("span",{onClick:e=>K("*",e),children:"\xd7"}),(0,S.jsx)("span",{onClick:e=>K("/",e),children:"\xf7"}),(0,S.jsx)("span",{onClick:e=>K(",",e),children:","}),(0,S.jsx)("span",{onClick:e=>K("clear",e),children:t.$t({id:"/GCoTA",defaultMessage:"Clear"})}),(0,S.jsx)("span",{onClick:e=>K("delete",e),children:t.$t({id:"9l3092",defaultMessage:"Backspace"})})]}),(0,S.jsxs)("ul",{className:V.groupContainer,"data-testid":"formulas",children:[(null===D||void 0===D?void 0:D.length)>0&&(0,S.jsx)("li",{className:V.groupTitle,children:t.$t({id:"iJMNSQ",defaultMessage:"Fields"})}),null===D||void 0===D?void 0:D.filter((e=>{var t;return e.id!==r&&!(null!==N&&void 0!==N&&null!==(t=N.find((t=>t.id===e.id)))&&void 0!==t&&t.isHidden)})).map((e=>(0,S.jsxs)("li",{onClick:()=>(e=>{y(E(e)),F(!1)})(e),children:[(0,S.jsx)(_.Z,{type:e.type,className:V.icon})," ",e.name]},e.id))),Object.keys(j).map((e=>{const i=j[e];return i&&i.length?(0,S.jsxs)(l.Fragment,{children:[(0,S.jsx)("li",{className:V.groupTitle,children:t.$t({id:e,defaultMessage:[]})}),i.map((e=>(0,S.jsx)(d.Z,{placement:"left",content:()=>(0,S.jsx)(z,{formula:e}),children:(0,S.jsx)("li",{onClick:()=>(e=>{y(T(e.name,!0)),F(!1)})(e),children:e.name})},e.name)))]},e):null}))]})]})}const W={formulaForm:"formulaConfig_formulaForm__5nHcQ",datetimeDateFormat:"formulaConfig_datetimeDateFormat__+HUpG",advance:"formulaConfig_advance__IUKhT",advanceItem:"formulaConfig_advanceItem__Rt-ks",switchText:"formulaConfig_switchText__Vif4x",isAdvance:"formulaConfig_isAdvance__iJ1eL",formulaItem:"formulaConfig_formulaItem__2MMJE",column:"formulaConfig_column__zUbhd",operator:"formulaConfig_operator__se9f1",noFormat:"formulaConfig_noFormat__gUefv"};function J(e){var t,i,n,o,s,d,r;const u=(0,a.Z)(),{columnId:c,formula:v="",form:m,config:p,tableNodeId:h,onValidate:f}=e,[g]=A.Z.useForm(),[b,y]=(0,l.useState)(v),[C,x]=(0,l.useState)(null!==(t=null===p||void 0===p?void 0:p.expectedType)&&void 0!==t?t:"number"),{entity:_}=(0,k.$1)(k.vK.formula),{getFormulaType:w}=_,I=(0,l.useCallback)((async(e,t)=>{if(e&&t){const e=await w(h,t);x(e),g.setFieldsValue({expectedType:e})}f&&f(e)}),[h,g,w,f]);(0,l.useEffect)((()=>{g.setFieldsValue({formula:b})}),[b,g]),(0,l.useImperativeHandle)(m,(()=>g));const j={formula:v,numberFormat:null!==(i=null===p||void 0===p?void 0:p.numberFormat)&&void 0!==i?i:(0,F.CS)(u)[0].value,numberPrecision:null!==(n=null===p||void 0===p?void 0:p.numberPrecision)&&void 0!==n?n:F._d[0].value,datetimeDateFormat:null!==(o=null===p||void 0===p?void 0:p.datetimeDateFormat)&&void 0!==o?o:Object.keys(F.zT)[0],datetimeTimeFormat:null!==(s=null===p||void 0===p?void 0:p.datetimeTimeFormat)&&void 0!==s?s:Object.keys(F.T_)[2],datetimeShowTimezone:null!==(d=null===p||void 0===p?void 0:p.datetimeShowTimezone)&&void 0!==d&&d,expectedType:null!==(r=null===p||void 0===p?void 0:p.expectedType)&&void 0!==r?r:"number"};return(0,S.jsx)(A.Z,{name:"formula",form:g,initialValues:j,requiredMark:!1,colon:!1,labelCol:{span:6},labelAlign:"left",className:W.formulaForm,children:(0,S.jsx)(Z.Z,{type:"card",size:"small",items:[{key:"formula",label:u.$t({id:"QZEMm+",defaultMessage:"Formula"}),children:(0,S.jsx)(A.Z.Item,{name:"formula",children:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:W.advance,children:u.$t({id:"kAsjP/",defaultMessage:"Formula editor"})}),(0,S.jsx)(q,{columnId:c,formula:v,onChange:y,onValid:I})]})})},{key:"format",label:u.$t({id:"zQLEfz",defaultMessage:"Format"}),children:(0,S.jsx)(Y,{type:C})}]})})}function Y(e){let{type:t}=e;const i=(0,a.Z)();switch(t){case"number":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(A.Z.Item,{label:i.$t({id:"zQLEfz",defaultMessage:"Format"}),name:"numberFormat",children:(0,S.jsx)(j.Ph,{options:(0,F.CS)(i)})}),(0,S.jsx)(A.Z.Item,{label:i.$t({id:"ryneQr",defaultMessage:"Precision"}),name:"numberPrecision",children:(0,S.jsx)(j.Ph,{options:F._d})})]});case"datetime":case"updateTime":case"createTime":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(A.Z.Item,{label:i.$t({id:"zQLEfz",defaultMessage:"Format"}),name:"datetimeDateFormat",className:W.datetimeDateFormat,children:(0,S.jsx)(j.Ph,{options:(0,F.by)(i)})}),(0,S.jsx)(A.Z.Item,{label:i.$t({id:"VZAOCm",defaultMessage:"Show time"}),name:"datetimeTimeFormat",children:(0,S.jsx)(j.Ph,{options:(0,F.wU)(i)})}),(0,S.jsx)(A.Z.Item,{label:i.$t({id:"BxCn3Z",defaultMessage:"Show time zone"}),name:"datetimeShowTimezone",children:(0,S.jsx)(j.Ph,{options:(0,F.rm)(i)})})]});default:return(0,S.jsx)("div",{className:W.noFormat,children:i.$t({id:"p6bh7g",defaultMessage:"The output field is not a number of date type and does not need to be formatted"})})}}var X=i(38981),Q=i.n(X),ee=i(99540),te=i.n(ee),ie=i(39306);const ne="formula_renderer__B2w5Y",oe="formula_text__1bEzi",le="formula_coordinate__z6A1J",ae="formula_mapPin__qu73o",se=e=>{let{inGrid:t,value:i,typeOptions:n,timezone:o,injector:l}=e;const{expectedType:a,numberPrecision:s,numberFormat:d}=null!==n&&void 0!==n?n:{},r="boolean"===(null===n||void 0===n?void 0:n.expectedType);return(0,S.jsxs)("div",{className:ne,children:[(0,S.jsx)("div",{className:(0,x.default)(oe,"coordinate"===a&&le),children:function(){switch(a){case"number":return(0,S.jsx)(N.xz,{inGrid:t,value:null===i?void 0:te()(i),typeOptions:{precision:null!==s&&void 0!==s?s:0,format:d},injector:l});case"multiLineText":case"boolean":return(0,S.jsx)(ie.qr,{value:Q()(r?i?"true":"false":i),truncateLength:60});case"datetime":case"createTime":case"updateTime":return(0,S.jsx)(D.Io,{value:i,typeOptions:{dateFormat:null===n||void 0===n?void 0:n.datetimeDateFormat,timeFormat:null===n||void 0===n?void 0:n.datetimeTimeFormat,showTimezone:null===n||void 0===n?void 0:n.datetimeShowTimezone},timezone:o,injector:l});default:return i}}()}),"coordinate"===a&&i&&(0,S.jsx)(_.Z,{"data-coordinate":"openModal",type:"mapPin",className:ae})]})};var de=i(57323),re=i.n(de),ue=i(46940),ce=i(98030);class ve extends ce.Z{constructor(){super(...arguments),re()(this,"openModalElement",null),re()(this,"openModalHandler",(()=>{var e,t,i,n,o;const l=null===(e=this.params)||void 0===e?void 0:e.context.dispatch,{updateCoordinateEditor:a}=this.params.context.injector.get(k.vK.coordinate),s=te()(null===(t=this.params)||void 0===t?void 0:t.tableNodeId),d=null===(i=this.params)||void 0===i?void 0:i.data.id,r=null===(n=this.params)||void 0===n||null===(n=n.colDef)||void 0===n?void 0:n.field;l(a({visible:!0,readonly:!0,trigger:"open",tableNode:{id:s,rowId:d,cells:{[r]:null===(o=this.params)||void 0===o?void 0:o.data[r]}}}))}))}init(e){var t,i,n,o;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const l=this.createEL();l.innerHTML=ue.renderToStaticMarkup((0,S.jsx)(se,{inGrid:null===(t=this.params)||void 0===t?void 0:t.inGrid,value:this.value,typeOptions:this.typeOptions,timezone:null===(i=this.params)||void 0===i?void 0:i.timezone,injector:null===(n=this.params)||void 0===n?void 0:n.context.injector})),this.openModalElement=l.querySelector('[data-coordinate="openModal"]'),this.openModalElement&&this.openModalElement.addEventListener("click",this.openModalHandler),this.eGui=this.withDecoration(l,null===(o=this.params)||void 0===o?void 0:o.collaborator,ue.renderToStaticMarkup((0,S.jsx)(_.Z,{type:"sync"})))}getGui(){return this.eGui}destroy(){this.openModalElement&&this.openModalElement.removeEventListener("click",this.openModalHandler)}}var me=i(48863),pe=i(89084),he=i(31973);const fe={current:"gridFieldConfig_current__ZurxQ",disabled:"gridFieldConfig_disabled__iY51o",selected:"gridFieldConfig_selected__RHiKS",select:"gridFieldConfig_select__xKLlx",selectItem:"gridFieldConfig_selectItem__PyLq5",active:"gridFieldConfig_active__jDPcK",wrap:"gridFieldConfig_wrap__5rKwr",lookup:"gridFieldConfig_lookup__5Z3GM",block:"gridFieldConfig_block__cVq84",config:"gridFieldConfig_config__pfGSo",configWithoutBorder:"gridFieldConfig_configWithoutBorder__qtG5Z",helpInfo:"gridFieldConfig_helpInfo__JMvIf",primary:"gridFieldConfig_primary__whsdx",primaryButton:"gridFieldConfig_primaryButton__Q+jPq"},ge="multiLineText";function be(e){var t,i;let{colId:n,fieldConfig:o,gridApi:s,defaultName:d,onCancel:r,onSubmit:u,onSetPrimary:c,isPrimary:v,isAddColumn:p,isBigTable:T=!1,enableFieldTypes:M,editDesc:P=!1,optionsOnly:R=!1,enableSelectOption:A=!0,timezone:Z}=e;const{entity:F}=(0,k.$1)(k.vK.grid),{useFieldConfig:O}=F,L=(0,a.Z)(),[$,G]=(0,l.useState)((()=>p&&"string"===typeof d?d:"")),[B,H]=(0,l.useState)(),[V,K]=(0,l.useState)(ge),[z,U]=(0,l.useState)(!0),q=(0,l.useRef)(null),[W,Y]=(0,l.useState)([]),[X,Q]=(0,l.useState)(""),ee=(0,l.useRef)(null),{tableNodeId:te,getFieldChoices:ie}=O(n,V,o,s),ne=!v&&c&&w.OU.includes(V),oe=(0,l.useMemo)((()=>{var e;const t=M?h()(w.Z9,M):w.Z9;if(!T||!o)return t;const i=null===(e=w.Z9[o.type])||void 0===e?void 0:e.bigTableType,n=Object.entries(t).filter((e=>{let[t,n]=e;return void 0!==n.bigTableType&&(n.bigTableType===i||"meta"!==n.bigTableType&&"any"===i)})).map((e=>{let[t,i]=e;return i.type}));return h()(w.Z9,n)}),[T,o,M]);function le(e){return e?L.$t({id:"field.name.".concat(e),defaultMessage:[]}):""}(0,l.useEffect)((()=>{o?(G(o.name),H(o.desc),K(o.type),o.typeOptions&&(Y(o.typeOptions.choices),"formula"===o.type&&Q(o.typeOptions.formula)),U(!1)):K(ge)}),[o]);const ae=null===o||void 0===o?void 0:o.typeOptions;const[se,de]=(0,l.useState)(!1);return(0,S.jsxs)("div",{className:(0,x.default)(fe.wrap,"lookup"===V?fe.lookup:""),"data-testid":"gridFieldConfig",children:[(0,S.jsxs)("div",{className:fe.block,children:[(0,S.jsx)("label",{children:L.$t({id:"yMJMfH",defaultMessage:"Field name"})}),(0,S.jsx)(f.default,{"data-testid":"gridFieldConfigNameInput",ref:ee,value:$,placeholder:L.$t({id:"GuhCAT",defaultMessage:"Enter field name"}),autoComplete:"off",onChange:e=>G(e.target.value),disabled:R})]}),P&&(0,S.jsxs)("div",{className:fe.block,children:[(0,S.jsx)("label",{children:L.$t({id:"hrsjmr",defaultMessage:"Field description"})}),(0,S.jsx)(f.default,{"data-testid":"gridFieldConfigNameInput",ref:ee,value:B,placeholder:L.$t({id:"1rDPBK",defaultMessage:"Enter field description"}),autoComplete:"off",onChange:e=>H(e.target.value),disabled:R})]}),(0,S.jsxs)("div",{className:fe.block,children:[(0,S.jsxs)("label",{children:[L.$t({id:"40nKoW",defaultMessage:"Field type"}),(0,S.jsx)(I.L0,{text:(0,m.Em)({id:"OQ1M4o",defaultMessage:"A field type specifies the kind or format of data stored in a given field. <a>Learn more about supported field types.</a>"}),color:"white",link:"fieldType"})]}),!z&&(0,S.jsxs)("div",{className:fe.current,onClick:()=>!R&&U(!0),role:"button","aria-expanded":"false",children:[(0,S.jsxs)("div",{className:fe.selected,children:[(0,S.jsx)(_.Z,{type:null===(t=w.Z9[V])||void 0===t?void 0:t.icon}),le(null===(i=w.Z9[V])||void 0===i?void 0:i.type)]}),!R&&(0,S.jsx)(C.Z,{})]})]}),z?(0,S.jsx)(g.Z,{gutter:[12,12],className:fe.select,children:Object.values(oe).map((e=>(0,S.jsx)(b.Z,{span:8,children:(0,S.jsxs)("div",{role:"button","aria-label":e.type,className:(0,x.default)(fe.selectItem,V===e.type?fe.active:""),onClick:()=>function(e){const t=ie(e,Z);t&&Y(t),K(e),U(!1),p&&!$&&d&&G("string"===typeof d?d:d(e))}(e.type),children:[(0,S.jsx)(_.Z,{type:e.icon}),le(e.type)]})},e.type)))}):(0,S.jsxs)("div",{className:(0,x.default)(["lookup"].includes(V)?fe.configWithoutBorder:fe.config),"data-testid":"field-config",children:["lookup"===V&&(0,S.jsx)("div",{className:fe.helpInfo,children:(0,S.jsx)(I.BQ,{text:(0,m.Em)({id:"AChion",defaultMessage:"Use lookup field to return values that meet the specified criteria. <a>How to use?</a>"}),link:"lookupField"})}),("datetime"===V||"createTime"===V||"updateTime"===V)&&(0,S.jsx)(D.xM,{form:q,config:ae}),"number"===V&&(0,S.jsx)(N.xS,{form:q,config:ae}),("singleChoice"===V||"multiChoice"===V)&&A&&(0,S.jsx)(E.O1,{selectOptions:W,form:q}),"formula"===V&&(0,S.jsx)(J,{tableNodeId:te,columnId:n,formula:X,form:q,config:ae,onValidate:e=>de(!e)}),"member"===V&&(0,S.jsx)(me._G,{config:ae,form:q}),"related"===V&&(0,S.jsx)(pe.b5,{name:$,config:ae,form:q}),"lookup"===V&&(0,S.jsx)(he.YO,{config:ae,form:q})]}),ne&&(0,S.jsx)("div",{className:fe.primary,children:(0,S.jsx)(y.ZP,{type:"link",onClick:function(){null===c||void 0===c||c(n),r()},className:fe.primaryButton,children:L.$t({id:"mlfC8I",defaultMessage:"Set as primary field"})})}),(0,S.jsx)(j.RI,{isInline:!0,items:[{onClick:r,children:L.$t({id:"47FYwb",defaultMessage:"Cancel"})},{type:"primary",onClick:async function(){var e;const t=await(null===(e=q.current)||void 0===e?void 0:e.validateFields());u({name:(null===$||void 0===$?void 0:$.trim())||"",desc:B,type:V,typeOptions:{...ae,...t}})},disabled:se,"data-testid":"gridFieldConfigSubmit",children:L.$t({id:"N2IrpM",defaultMessage:"Confirm"})}]})]})}const ye={button:"girdColumnAdder_button__iAUi0",column:"girdColumnAdder_column__SnTkx"};function Ce(e){let{api:t,onColumnAdd:i,enableFieldTypes:n,timezone:o}=e;const m=(0,a.Z)(),[p,h]=(0,l.useState)(!1);function f(){return t.getAllGridColumns().filter((e=>e&&![v._m,v.hK,v.kl].includes(e.getColId())))}return(0,S.jsx)(d.Z,{placement:"bottomRight",content:(0,S.jsx)(be,{isAddColumn:!0,defaultName:function(e){const t=f().map((e=>e.getColDef().headerName)).filter(Boolean);return(0,c.D8)(new Set(t),m.$t({id:"field.name.".concat(e),defaultMessage:[]}))},onSubmit:async function(e){var n;if(!e.type)return s.ZP.error(m.$t({id:"JgaAcB",defaultMessage:"Please select a field type"}));const o=f(),l=null===(n=o[o.length-1])||void 0===n?void 0:n.getColId();l?i(l,e).then((e=>{var i;const n=null===(i=e.payload)||void 0===i||null===(i=i.wsSyncedData)||void 0===i?void 0:i.id;n&&t.ensureColumnVisible(n),h(!1)})):h(!1)},onCancel:()=>h(!1),enableFieldTypes:n,timezone:o}),trigger:"click",open:p,onOpenChange:h,destroyOnHidden:!0,children:(0,S.jsx)(r.Z,{placement:"top",title:m.$t({id:"kRcjv4",defaultMessage:"Add a field"}),children:(0,S.jsx)("div",{className:ye.column,onClick:()=>h(!0),"data-testid":"gridColumnAdder",children:(0,S.jsx)(u.Z,{className:ye.button})})})})}const xe="gridRowIndex_container__-38oS",_e="gridRowIndex_index__Cxjd0",we="gridRowIndex_expandButton__IejS1",Ie="gridRowIndex_indexHidden__7KdQH";class je extends ce.Z{constructor(){super(...arguments),re()(this,"toggleIndexNumber",(e=>{var t,i;e?null===(t=this.eGui.querySelector(".ag-row-index"))||void 0===t||t.classList.add(Ie):null===(i=this.eGui.querySelector(".ag-row-index"))||void 0===i||i.classList.remove(Ie)})),re()(this,"showDetail",(()=>{var e;null===(e=this.onDetailOpen)||void 0===e||e.call(this,this.id)})),re()(this,"showTooltip",(()=>{var e;const t=null===(e=this.params)||void 0===e?void 0:e.context.injector,i=null===t||void 0===t?void 0:t.get(k.vK.common),n=this.eGui.querySelector(".ag-expand-button"),o=document.createElement("div");if(o.className="mt-grid-cell-tooltip",o.textContent=i.formatMessage({id:"0oLj/t",defaultMessage:"Expand"}),n&&o){const{top:e,left:t}=n.getBoundingClientRect();o.style.top="".concat(e-30,"px"),o.style.left="".concat(t-20,"px"),o.style.display="block",this.tooltip=o,document.body.appendChild(this.tooltip)}})),re()(this,"hideTooltip",(()=>{this.tooltip&&this.tooltip.remove()}))}init(e){this.params=e,this.value=null===e||void 0===e?void 0:e.value,this.id=e.node.id,this.onDetailOpen=e.onDetailOpen;const t=this.createEL();t.innerHTML=ue.renderToStaticMarkup((0,S.jsxs)("div",{className:xe,children:[(0,S.jsx)("div",{className:(0,x.default)("ag-row-index",_e),children:this.value}),this.onDetailOpen&&(0,S.jsx)("div",{className:(0,x.default)("ag-expand-button",we),"data-testid":"gridExpandButton",children:(0,S.jsx)(_.Z,{type:"expandArrow"})})]}));const i=t.querySelector(".ag-expand-button");var n,o;(null===i||void 0===i||i.addEventListener("click",this.showDetail),null===i||void 0===i||i.addEventListener("mouseenter",this.showTooltip),null===i||void 0===i||i.addEventListener("mouseleave",this.hideTooltip),e.eGridCell)&&(this.checkbox=e.eGridCell.querySelector('.ag-selection-checkbox [ref="eInput"]'),this.observer=new MutationObserver((e=>{e.forEach((e=>{if("attributes"===e.type){const t=e.target.checked;this.toggleIndexNumber(t)}}))})),this.checkbox&&this.observer.observe(this.checkbox,{attributes:!0}),null!==(n=this.checkbox)&&void 0!==n&&n.checked&&(null===(o=t.querySelector(".ag-row-index"))||void 0===o||o.classList.add(Ie)));this.eGui=t}getGui(){return this.eGui}destroy(){var e;const t=this.eGui.querySelector(".ag-expand-button");null===t||void 0===t||t.removeEventListener("click",this.showDetail),null===t||void 0===t||t.removeEventListener("mouseenter",this.showTooltip),null===t||void 0===t||t.removeEventListener("mouseleave",this.hideTooltip),null===(e=this.observer)||void 0===e||e.disconnect(),this.hideTooltip()}}var ke=i(63668),De=i(31562),Ne=i(73681),Ee=i(10560),Te=i(53029),Me=i(95775),Se=i(76625),Pe=i(50239);const Re={permissionMenu:"permissionMenu_permissionMenu__FYgDT",radioTitle:"permissionMenu_radioTitle__hBOyx",radioDesc:"permissionMenu_radioDesc__4njnK",radio:"permissionMenu_radio__q2nnz",active:"permissionMenu_active__xqOua",checkedIcon:"permissionMenu_checkedIcon__3dWaX"};function Ae(e){let{value:t="public",type:i,onChange:n}=e;const o=(0,a.Z)(),s=(0,l.useMemo)((()=>"table"===i?[{value:"public",title:o.$t({id:"cwXz31",defaultMessage:"Collaborative table"}),desc:o.$t({id:"9CSGUZ",defaultMessage:"This table can be edited by editors."})},{value:"restricted",title:o.$t({id:"z077+B",defaultMessage:"Restricted table"}),desc:o.$t({id:"K7V96G",defaultMessage:"This table can be updated by admins only."})},{value:"locked",title:o.$t({id:"3/zz6/",defaultMessage:"Locked table"}),desc:o.$t({id:"LT3HKz",defaultMessage:"This table cannot be updated by anyone."})}]:"column"===i?[{value:"public",title:o.$t({id:"NP9DhZ",defaultMessage:"Collaborative field"}),desc:o.$t({id:"TNueaA",defaultMessage:"This field can be edited by editors."})},{value:"restricted",title:o.$t({id:"420Tx5",defaultMessage:"Restricted field"}),desc:o.$t({id:"5eGFRW",defaultMessage:"This field can be updated by admins only."})},{value:"locked",title:o.$t({id:"roOG+T",defaultMessage:"Locked field"}),desc:o.$t({id:"DYK9Z8",defaultMessage:"This field cannot be updated by anyone."})}]:"view"===i?[{value:"public",title:o.$t({id:"RwslZ4",defaultMessage:"Collaborative view"}),desc:o.$t({id:"7KaX98",defaultMessage:"This view can be edited by editors."})},{value:"personal",title:o.$t({id:"RliWHD",defaultMessage:"Personal view"}),desc:o.$t({id:"smNAKt",defaultMessage:"This view is private to you."})},{value:"locked",title:o.$t({id:"ZnuVC7",defaultMessage:"Locked view"}),desc:o.$t({id:"75gNZI",defaultMessage:"This is a read-only view."})}]:[]),[o,i]),[d,r,u]=s;return(0,S.jsx)(Me.ZP.Group,{onChange:n,className:Re.permissionMenu,defaultValue:t,children:(0,S.jsxs)(Se.Z,{direction:"vertical",children:[(0,S.jsx)(Me.ZP,{className:Re.radio,value:d.value,children:(0,S.jsxs)(Pe.Z,{align:"center",gap:6,children:[(0,S.jsx)(_.Z,{type:"groupFill"}),(0,S.jsxs)(Pe.Z,{vertical:!0,children:[(0,S.jsx)("div",{className:Re.radioTitle,children:d.title}),(0,S.jsx)("div",{className:Re.radioDesc,children:d.desc})]}),(0,S.jsx)(_.Z,{type:"check",className:Re.checkedIcon})]})}),(0,S.jsx)(Me.ZP,{className:Re.radio,value:r.value,children:(0,S.jsxs)(Pe.Z,{align:"center",gap:6,children:[(0,S.jsx)(_.Z,{type:"userFill"}),(0,S.jsxs)(Pe.Z,{vertical:!0,children:[(0,S.jsx)("span",{className:Re.radioTitle,children:r.title}),(0,S.jsx)("span",{className:Re.radioDesc,children:r.desc})]}),(0,S.jsx)(_.Z,{type:"check",className:Re.checkedIcon})]})}),(0,S.jsx)(Me.ZP,{className:Re.radio,value:u.value,children:(0,S.jsxs)(Pe.Z,{align:"center",gap:6,children:[(0,S.jsx)(_.Z,{type:"lockFill"}),(0,S.jsxs)(Pe.Z,{vertical:!0,children:[(0,S.jsxs)("span",{className:Re.radioTitle,children:[u.title," ",(0,S.jsx)(Te.Z,{})]}),(0,S.jsx)("span",{className:Re.radioDesc,children:u.desc})]}),(0,S.jsx)(_.Z,{type:"check",className:Re.checkedIcon})]})})]})})}var Ze=i(53926),Fe=i.n(Ze),Oe=i(25354),Le=i(8942),$e=i.n(Le);const Ge="changeFieldType_confirmContent__V8yd4",Be=e=>{const{colId:t,fieldConfig:i,dialog:n,gridApi:o,onSetPrimary:l,onColumnUpdate:r,onCancel:u,enableFieldTypes:c,ignoreChangeConfirm:v,isPrimary:m,placement:p,isBigTable:h=!1,optionsOnly:f=!1,timezone:g}=e,{entity:b}=(0,k.$1)(k.vK.common),{useConfirmDialog:y,BorderedText:C,HIDDEN_CHANGE_FIELD_TYPE_CONFIRM_MODAL:x}=b,I=(0,a.Z)(),j=(0,S.jsxs)("div",{className:Ge,children:[(0,S.jsxs)("div",{children:[I.$t({id:"kwnUnx",defaultMessage:"Converting to this field type may clear some cell data in the table."}),h?(0,S.jsx)("span",{children:I.$t({id:"oIGIMZ",defaultMessage:"Big table does not support undoing"})}):(0,S.jsxs)("span",{children:[I.$t({id:"4CrlkY",defaultMessage:"If conversion causes problems, you can press"})," ",(0,S.jsx)(C,{children:"ctrl"}),(0,S.jsx)(C,{children:"Z"})," ",I.$t({id:"4wpUNc",defaultMessage:"Or"})," ",(0,S.jsx)(_.Z,{type:"undo"}),I.$t({id:"JkS37H",defaultMessage:"Undo"})]})]}),(0,S.jsx)(Oe.Z,{onChange:function(e){Fe().set(x,e.target.checked)},children:I.$t({id:"DCi7pc",defaultMessage:"Do not show this message again"})})]}),D=y({title:I.$t({id:"AUvx1W",defaultMessage:"Are you sure you want to convert to this field type?"}),okText:I.$t({id:"WrGSr6",defaultMessage:"Convert"}),content:j,closable:!1});function N(e){return e.name?e.type?void(t&&r(t,{name:e.name,type:e.type===i.type?void 0:e.type,typeOptions:e.typeOptions})):s.ZP.error(I.$t({id:"JgaAcB",defaultMessage:"Please select a field type"})):s.ZP.error(I.$t({id:"IWpUj8",defaultMessage:"Please enter a field name"}))}return(0,S.jsx)(d.Z,{placement:p||(m?"bottomLeft":"bottom"),content:(0,S.jsx)(be,{colId:t,fieldConfig:i,gridApi:o,onSubmit:function(e){const t=!$e()(e,i),o=e.type!==i.type&&(h||w.Z9[e.type].needConfirm);t&&o&&!v?Fe().get(x)?N(e):D().then((()=>N(e))):N(e),n.close()},onCancel:()=>{null===u||void 0===u||u(),n.close()},onSetPrimary:l,isPrimary:m,isBigTable:h,optionsOnly:f,timezone:g,enableFieldTypes:c}),trigger:"click",open:n.visible,onOpenChange:e=>e?n.open():n.close()})},He="changeFieldDesc_content__4E4wg",Ve=e=>{const{colId:t,desc:i,dialog:n,onColumnUpdate:o,isPrimary:s,placement:r}=e,[u,c]=(0,l.useState)(i),v=(0,a.Z)();return(0,S.jsx)(d.Z,{placement:r||(s?"bottomLeft":"bottom"),content:(0,S.jsxs)("div",{className:He,children:[(0,S.jsx)(f.default,{defaultValue:i,onChange:e=>c(e.target.value),placeholder:v.$t({id:"1rDPBK",defaultMessage:"Enter field description"})}),(0,S.jsx)(j.RI,{items:[{children:v.$t({id:"47FYwb",defaultMessage:"Cancel"}),onClick:n.close},{children:v.$t({id:"N2IrpM",defaultMessage:"Confirm"}),type:"primary",onClick:function(){t&&o(t,{desc:u}),n.close()}}]})]}),trigger:"click",open:n.visible,onOpenChange:e=>e?n.open():n.close()})},Ke={container:"gridHeader_container__--Ay8",header:"gridHeader_header__rsSAL",grouping:"gridHeader_grouping__PyGrI",headerText:"gridHeader_headerText__7AHT5",caret:"gridHeader_caret__TpJnt",active:"gridHeader_active__Acfje",iconBox:"gridHeader_iconBox__GIOSc",icon:"gridHeader_icon__jXBkH",sync:"gridHeader_sync__BmrP6",errorIcon:"gridHeader_errorIcon__kLsE0",descIcon:"gridHeader_descIcon__CTcso",descTip:"gridHeader_descTip__Y1Jiq",loading:"gridHeader_loading__HGfCr",permissionItem:"gridHeader_permissionItem__sOJig"};function ze(e){var t,i,n;const{column:o,displayName:s,api:d,typeOptions:u,type:c,editable:v,enableFieldTypes:m,onColumnUpdate:p,onColumnLeftInsert:h,onColumnRightInsert:f,onColumnCopy:g,onColumnHide:b,onColumnRemove:y,onColumnFilter:C,onColumnGroup:I,onColumnSort:j,ignoreChangeConfirm:D,isPrimary:N,isBigTable:E,isConnected:T,isLocked:M,canInsertDataColumn:P,timezone:R,sortType:A,isAdmin:Z,state:F,tableNodeState:O}=e,{entity:L}=(0,k.$1)(k.vK.common),{useDialogState:$}=L,G=(0,a.Z)(),[B,H]=(0,l.useState)(!1),V=o.getColDef().headerComponentParams,K=e.column.getColDef().field,z="subscribed"===(null===(t=e.column.getColDef())||void 0===t||null===(t=t.cellEditorParams)||void 0===t?void 0:t.mode)||"connected"===(null===(i=e.column.getColDef())||void 0===i||null===(i=i.cellEditorParams)||void 0===i?void 0:i.mode),U=("singleChoice"===c||"multiChoice"===c)&&(null===V||void 0===V?void 0:V.connectedUnEditable),q=$(!1),W=$(!1),[J,Y]=(0,l.useState)(),X=T?E?w.n_:P?m:w.aE:m,Q=!Z&&"restricted"===F||"locked"===F||!v&&z;function ee(){const e=d.getDisplayedRowCount()-2;d.clearRangeSelection(),d.addCellRange({rowStartIndex:0,rowEndIndex:e,columns:[o]}),d.setFocusedCell(0,o)}function te(e){(v||Z||"public"!==F)&&(e.preventDefault(),e.stopPropagation(),d.stopEditing(),H(!0))}function ie(e){H(!1),null===j||void 0===j||j(o.getColId(),e)}(0,l.useEffect)((()=>{"lookup"===c&&u.lookupExceedMaxNumError?Y(G.$t({id:"KaYutv",defaultMessage:"Number of lookup field cells returned exceeds 200 items"})):"formula"!==c||u.valid?Y(void 0):Y(G.$t({id:"LTsNXm",defaultMessage:"Errors in the column settings. Please change the config for this column"}))}),[G,u,c]);const ne=(e,t)=>{switch(t){case"alphabetically":return"asc"===e?(0,S.jsxs)(S.Fragment,{children:["A ",(0,S.jsx)(ke.Z,{})," Z"]}):(0,S.jsxs)(S.Fragment,{children:["Z ",(0,S.jsx)(ke.Z,{})," A"]});case"numeric":return"asc"===e?(0,S.jsxs)(S.Fragment,{children:["0 ",(0,S.jsx)(ke.Z,{})," 9"]}):(0,S.jsxs)(S.Fragment,{children:["9 ",(0,S.jsx)(ke.Z,{})," 0"]});case"order":return"asc"===e?G.$t({id:"u7djqV",defaultMessage:"Ascending"}):G.$t({id:"aleGqT",defaultMessage:"Descending"});case"boolean":return"asc"===e?(0,S.jsxs)(S.Fragment,{children:[G.$t({id:"KKkUks",defaultMessage:"True"})," ",(0,S.jsx)(ke.Z,{})," ",G.$t({id:"rxqs5U",defaultMessage:"False"})]}):(0,S.jsxs)(S.Fragment,{children:[G.$t({id:"rxqs5U",defaultMessage:"False"})," ",(0,S.jsx)(ke.Z,{})," ",G.$t({id:"KKkUks",defaultMessage:"True"})]});default:return null}},oe=[p?{key:"meta","data-testid":"gridHeaderMenuEdit_".concat(K),label:G.$t({id:"LiNNTn",defaultMessage:"Edit field"}),onClick:function(){q.open(),H(!1)},disabled:Q}:null,p?{key:"desc",label:G.$t({id:"UX+iDs",defaultMessage:"Edit field description"}),onClick:function(){W.open(),H(!1)},disabled:Q}:null,Z?{key:"permission",label:G.$t({id:"RuguTI",defaultMessage:"Edit field permission"}),popupClassName:Ke.permissionItem,disabled:Q,children:[{key:"field",label:(0,S.jsx)(Ae,{onChange:function(e){const t=e.target.value;t&&K&&(null===p||void 0===p||p(K,{state:t}))},value:null!==F&&void 0!==F?F:"public",type:"column"})}]}:null,null,h||f?{type:"divider"}:null,h?{key:"insert-l",label:G.$t({id:"B/dGkU",defaultMessage:"Insert left"}),onClick:function(){var e;const t=null===(e=d.getDisplayedColBefore(o))||void 0===e?void 0:e.getColId();null===h||void 0===h||h("index"===t?void 0:t),H(!1)}}:null,f?{key:"insert-r",label:G.$t({id:"8k0aO6",defaultMessage:"Insert right"}),onClick:function(){null===f||void 0===f||f(o.getColId()),H(!1)}}:null,!M&&j?{type:"divider"}:null,!M&&j?{key:"sort-asc",label:(0,S.jsxs)(S.Fragment,{children:[G.$t({id:"FjxWsX",defaultMessage:"Sort:"})," ",ne("asc",A)]}),onClick:()=>ie("asc")}:null,!M&&j?{key:"sort-desc",label:(0,S.jsxs)(S.Fragment,{children:[G.$t({id:"FjxWsX",defaultMessage:"Sort:"})," ",ne("desc",A)]}),onClick:()=>ie("desc")}:null,M||!C&&!I?null:{type:"divider"},!M&&C?{key:"filter",label:G.$t({id:"qj8UBM",defaultMessage:"Filter by this field"}),onClick:function(){H(!1),null===C||void 0===C||C(o.getColId())}}:null,!M&&I?{key:"group",label:G.$t({id:"DTR7Hm",defaultMessage:"Group by this field"}),onClick:function(){H(!1),null===I||void 0===I||I(o.getColId())}}:null,!M&&b||y?{type:"divider"}:null,!M&&b?{key:"hide",label:G.$t({id:"+SRAwH",defaultMessage:"Hide this field"}),onClick:function(){H(!1),null===b||void 0===b||b(o.getColId())}}:null,y?{key:"remove",danger:!0,label:G.$t({id:"zp5QDy",defaultMessage:"Delete this field"}),disabled:Q,onClick:function(){null!==y&&void 0!==y&&y(o.getColId())&&d.setColumnsVisible([o],!1),H(!1)}}:null].filter(Boolean);return(0,S.jsxs)("div",{className:Ke.container,children:[(0,S.jsx)(Ee.Z,{overlayStyle:{minWidth:100,float:"right"},"data-testid":"gridHeaderMenu_".concat(K),menu:{items:oe,"data-testid":"grid-header-menu"},placement:"bottomRight",open:B,onOpenChange:function(e){H(e)},trigger:["click"],children:(0,S.jsxs)("div",{"data-testid":"gridHeader","data-id":K,"data-type":V.type,className:Ke.header,onContextMenu:te,onClick:function(){v&&!E?ee():!v&&U&&q.open()},children:[V.grouping&&(0,S.jsx)("div",{className:Ke.grouping}),(0,S.jsxs)("div",{className:Ke.iconBox,children:[(0,S.jsx)(_.Z,{type:null===(n=w.Z9[V.type])||void 0===n?void 0:n.icon,className:Ke.icon}),z&&(0,S.jsx)(_.Z,{type:"sync",className:Ke.sync})]}),(0,S.jsxs)("div",{className:Ke.headerText,"data-id":K,"data-type":V.type,children:[s,N&&(0,S.jsx)(r.Z,{styles:{root:{maxWidth:"300px"}},title:G.$t({id:"0Gak+U",defaultMessage:"Primary field\uff1ais used to identify each record and cannot be deleted, moved or hidden"}),children:(0,S.jsx)(De.Z,{})})]}),V.updating&&(0,S.jsx)(_.Z,{type:"operationSaving",className:Ke.loading}),J&&(0,S.jsx)(r.Z,{placement:"bottom",title:J,children:(0,S.jsx)(Ne.Z,{className:Ke.errorIcon})}),V.desc&&(0,S.jsx)(r.Z,{placement:"bottom",title:V.desc,children:(0,S.jsx)(_.Z,{type:"infoReverse",className:Ke.descIcon})}),(v||U||Z&&"public"!==F)&&"locked"!==O&&(0,S.jsx)("div",{className:(0,x.default)(Ke.caret,{[Ke.active]:B}),onClick:te,children:(0,S.jsx)(_.Z,{type:"caretBottom"})}),("restricted"===F||"locked"===F)&&(0,S.jsx)(r.Z,{title:"restricted"===F?G.$t({id:"5eGFRW",defaultMessage:"This field can be updated by admins only."}):G.$t({id:"DYK9Z8",defaultMessage:"This field cannot be updated by anyone."}),children:(0,S.jsx)(_.Z,{type:"lockFill"})})]})}),q.visible&&p&&(0,S.jsx)(Be,{dialog:q,fieldConfig:V,colId:K,gridApi:e.api,onColumnUpdate:p,enableFieldTypes:X,ignoreChangeConfirm:D,optionsOnly:!v&&U,isPrimary:N,isBigTable:E,timezone:R}),W.visible&&p&&(0,S.jsx)(Ve,{dialog:W,desc:V.desc,colId:K,onColumnUpdate:p,isPrimary:N})]})}var Ue=i(49623),qe=i.n(Ue),We=i(85521),Je=i(89983),Ye=i(57875);const Xe="coordinate_renderer__y+vu6",Qe="coordinate_text__+JZJt",et="coordinate_noWrap__rp1dV",tt="coordinate_placeholder__Kagea",it="coordinate_editor__0XqsI",nt="coordinate_mapPinBox__Yia-J",ot="coordinate_mapPin__1j9Dr",lt="coordinate_active__4A3Pa";const at=e=>{var t,i,n,o;const{entity:a}=(0,k.$1)(k.vK.coordinate),{useSelector:s}=a,d=s((e=>e.project.coordinateEditor)),r=null===(t=e.data)||void 0===t?void 0:t.id,u=null===(i=e.colDef)||void 0===i?void 0:i.field,c=(null===(n=e.data)||void 0===n?void 0:n.tableNodeId)||(null===(o=e.colDef)||void 0===o?void 0:o.cellEditorParams.tableNodeId),v="Backspace"===e.eventKey||"Delete"===e.eventKey,{stopEditing:m=L(),onBlur:p=L(),value:h,inGrid:f}=e;return(0,Ye.E9)({isCancelAfterEnd(){if(""!==h)try{return(0,Je.HF)(h),!1}catch{return!0}return!1}}),function(e){const{tableNodeId:t,rowId:i,cellId:n,coordinate:o,isDeletePressed:a}=e,{entity:s,dispatch:d}=(0,k.$1)(k.vK.coordinate),{updateCoordinateEditor:r}=s;(0,l.useEffect)((()=>(a||d(r({visible:!0,trigger:"open",tableNode:{id:t,rowId:i,cells:{[n]:o}}})),()=>{d(r({trigger:null}))})),[d,t,i,n,o,a,r])}({tableNodeId:c,rowId:r,cellId:u,coordinate:h,isDeletePressed:v}),function(e){const{coordinateEditor:t,stopEditing:i,inGrid:n,onBlur:o}=e;(0,l.useEffect)((()=>{t.visible||"close"!==t.trigger||(n?i():o())}),[t,i,n,o])}({coordinateEditor:d,stopEditing:m,inGrid:f,onBlur:p}),(0,S.jsxs)("div",{className:it,children:[(0,S.jsx)("div",{className:Qe,children:h||(0,S.jsx)("span",{className:tt})}),(0,S.jsx)(_.Z,{type:"mapPin",className:(0,x.default)(ot,lt)})]})},st=e=>{const{value:t,isPlain:i,rowHeight:n}=e;return(0,S.jsxs)("div",{className:Xe,children:[(0,S.jsx)("div",{className:(0,x.default)(Qe,{[et]:"low"===n}),children:t||(0,S.jsx)("span",{className:tt,children:!i&&""})}),!i&&(0,S.jsx)("div",{className:nt,children:(0,S.jsx)(_.Z,{"data-coordinate":"openModal",type:"mapPin",className:ot})})]})};var dt=i(88716),rt=i.n(dt);class ut extends ce.Z{constructor(){super(...arguments),re()(this,"openModalElement",null),re()(this,"openModalHandler",(()=>{var e,t,i,n,o,l;const a=null===(e=this.params)||void 0===e||null===(e=e.context)||void 0===e?void 0:e.dispatch,{updateCoordinateEditor:s}=this.params.context.injector.get(k.vK.coordinate),d=te()(null===(t=this.params)||void 0===t?void 0:t.tableNodeId),r=null===(i=this.params)||void 0===i?void 0:i.data.id,u=null===(n=this.params)||void 0===n||null===(n=n.colDef)||void 0===n?void 0:n.field,c=null===(o=this.params)||void 0===o?void 0:o.data[u];a(s({visible:!0,readonly:this.subscribed||!(null!==(l=this.params)&&void 0!==l&&l.editable),trigger:"open",tableNode:{id:d,rowId:r,cells:{[u]:c}}}))}))}init(e){var t,i,n;this.value=null===e||void 0===e?void 0:e.realValue,this.typeOptions=null===e||void 0===e?void 0:e.typeOptions,this.params=e,this.checkSubscribed();const o=this.createEL();o.innerHTML=ue.renderToStaticMarkup((0,S.jsx)(st,{value:this.value,rowHeight:null===(t=this.params)||void 0===t?void 0:t.rowHeight,isPlain:(!(null!==(i=this.params)&&void 0!==i&&i.editable)||this.subscribed)&&rt()(this.value)})),this.openModalElement=o.querySelector('[data-coordinate="openModal"]'),this.openModalElement&&this.openModalElement.addEventListener("click",this.openModalHandler),this.eGui=this.withDecoration(o,null===(n=this.params)||void 0===n?void 0:n.collaborator,ue.renderToStaticMarkup((0,S.jsx)(_.Z,{type:"sync"})))}getGui(){return this.eGui}destroy(){this.openModalElement&&this.openModalElement.removeEventListener("click",this.openModalHandler)}}var ct=i(28827),vt=i(85513);const mt=(0,l.forwardRef)(((e,t)=>{const{type:i,colDef:n,context:o,onValueChange:a,eventKey:s}=e,{entity:d}=(0,k.$1)(k.vK.multiLineText),{useCellCollaborators:r}=d,{name:u,color:c}=r(e.column.getColId(),e.data.id),v=n.field,m=(0,l.useMemo)((()=>{return{...e,value:(t=e.value,qe()(t)&&"realValue"in t?t.realValue:t),rowId:e.data.id,columnId:v,injector:o.injector,rowHeight:o.rowHeight};var t}),[v,o.injector,o.rowHeight,e]);(0,l.useEffect)((()=>(null===a||void 0===a||a(m.value),()=>{null===a||void 0===a||a(m.value)})),[]),(0,l.useEffect)((()=>{!s||"Enter"===s||"multiLineText"!==i&&"number"!==i&&"hyperlink"!==i||("number"===i?null===a||void 0===a||a(parseInt(s)):null===a||void 0===a||a(s))}),[s,i,a]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"ag-grid-collaborator-cell","data-collaborator-cell":!!u,style:{borderColor:c},children:(0,S.jsx)("span",{style:{backgroundColor:c},children:u})}),(()=>{switch(i){case"attachment":return(0,S.jsx)(We.rK,{...m});case"coordinate":return(0,S.jsx)(at,{...m});case"datetime":return(0,S.jsx)(D.nV,{...m,onChange:a});case"multiLineText":return(0,S.jsx)(ie.fO,{...m,onChange:a});case"singleChoice":case"multiChoice":return(0,S.jsx)(E.v9,{...m,onChange:a});case"formula":return(0,S.jsx)(R,{...m});case"number":return(0,S.jsx)("div",{style:{height:"100%",display:"flex",alignItems:"center"},children:(0,S.jsx)(N.cp,{...m,onChange:a})});case"hyperlink":return(0,S.jsx)(ct.Cz,{...m,onChange:a});case"creator":case"updater":return(0,S.jsx)(vt.O,{...m});case"member":return(0,S.jsx)(me.Up,{...m,onChange:a});case"related":return(0,S.jsx)(pe.v$,{...m,onChange:a});case"createTime":case"updateTime":return(0,S.jsx)(D.Io,{...m})}})()]})}));var pt=i(76825),ht=i(23903),ft=i.n(ht),gt=i(17646),bt=i.n(gt),yt=i(74110),Ct=i(85790);const xt={singleChoice:E.nM,multiChoice:E.nM,number:N.Fp,datetime:D.Vy,createTime:D.Vy,updateTime:D.Vy,coordinate:ut,formula:ve,multiLineText:ie.zp,attachment:We.ef,boolean:Ct.t,creator:vt.U,updater:vt.U,member:me.DJ,hyperlink:ct.eD,related:pe.ME,lookup:he.tt};function _t(e){var t,i,n,o;if(null===e||void 0===e||!e.data)return{};const{column:l}=e,a=null===l||void 0===l?void 0:l.getColDef(),s=e.context,d=null===l||void 0===l?void 0:l.getColId(),r=null===e||void 0===e?void 0:e.data.id,u=s.getState(),c=G()(null===(t=u.tableNode)||void 0===t?void 0:t.entities,null!==(i=s.tableNodeId)&&void 0!==i?i:""),v=(null===c||void 0===c?void 0:c.type)===yt.e.bigTable?null===e||void 0===e?void 0:e.data[d]:null===c||void 0===c||null===(n=c.rows.find((e=>e.id===r)))||void 0===n?void 0:n.cells[d],m=ft()(null===c||void 0===c?void 0:c.columns,(e=>e.id===d)),p="".concat(d,",").concat(r),h=[];let f="transparent";const g=G()(null===(o=u.collaborator)||void 0===o?void 0:o.cellCollaborators,p);bt()(g,(e=>{h.push(e.name),f=e.color}));const b=null===m||void 0===m?void 0:m.type,y={realValue:v,editable:null===a||void 0===a?void 0:a.editable,typeOptions:null===m||void 0===m?void 0:m.typeOptions,type:null===m||void 0===m?void 0:m.type,name:null===m||void 0===m?void 0:m.name,inGrid:!0,tableNodeId:s.tableNodeId,viewId:s.viewId,rowHeight:s.rowHeight,timezone:s.timezone,collaborator:rt()(h)?void 0:{name:h,color:f}};return{component:G()(xt,null!==b&&void 0!==b?b:""),params:y}}function wt(e){return{field:v.hK,maxWidth:40,menuTabs:[],suppressHeaderMenuButton:!0,suppressMovable:!0,suppressNavigable:!0,headerComponent:Ce,editable:!1,resizable:!1,cellClass:"mt-hidden-column",suppressHeaderContextMenu:!0,...e}}function It(e){return{field:v._m,hide:!0,suppressHeaderContextMenu:!0,...e}}function jt(e){return{valueGetter(e){var t;return((null===(t=e.node)||void 0===t?void 0:t.rowIndex)||0)+1},rowDrag:!0,suppressHeaderMenuButton:!0,field:v.kl,headerName:"",maxWidth:300,editable:!1,pinned:"left",lockPinned:!0,cellClass:"cell-id",cellRenderer:je,enableCellChangeFlash:!1,suppressMovable:!0,suppressNavigable:!0,checkboxSelection:!0,headerCheckboxSelection:!0,headerCheckboxSelectionFilteredOnly:!0,suppressHeaderContextMenu:!0,...e}}function kt(e,t){return{cellClass:"".concat(e.type," ag-customize-cell"),headerName:e.name,field:e.id,width:e.width,cellEditor:mt,valueGetter:t=>t.data?{rowId:t.data.id,columnId:t.colDef.field,realValue:t.data[t.colDef.field],typeOptions:o()(e.typeOptions),type:t.colDef.headerComponentParams.type,order:t.colDef.headerComponentParams.groupOrder}:null,keyCreator:e=>e&&e.value?JSON.stringify({id:e.value.columnId,value:void 0===e.value.realValue?null:e.value.realValue,order:e.value.order}):"{}",equals:(e,t)=>e.realValue===t.realValue&&e.type===t.type&&e.typeOptions===t.typeOptions,cellRendererSelector:_t,sortable:!0,suppressHeaderContextMenu:!0,comparator:pt.U,headerComponent:ze,...t}}function Dt(e){return e?e.headerComponentParams:null}},76825:(e,t,i)=>{i.d(t,{U:()=>_});var n=i(23903),o=i.n(n),l=i(88716),a=i.n(l),s=i(99540),d=i.n(s),r=i(7070),u=i.n(r),c=i(82959),v=i.n(c),m=i(75538),p=i.n(m),h=i(55349),f=i.n(h),g=i(62618),b=i.n(g);function y(e,t){return e===t?0:void 0===e?-1:void 0===t||e>t?1:-1}function C(e,t){return f()(e)&&f()(t)?0:f()(e)?-1:f()(t)?1:d()(e)-d()(t)}function x(e,t){return f()(e)&&f()(t)||a()(e)&&a()(t)?0:f()(e)||a()(e)?-1:(f()(t)||a()(t),1)}function _(e,t){if(!e||!t)return e?1:t?-1:0;let i=e.realValue,n=t.realValue;const l=e.typeOptions,a=t.typeOptions,s=e.type,d="formula"===s,r=d&&"number"===(null===l||void 0===l?void 0:l.expectedType),c=d&&"multiLineText"===(null===l||void 0===l?void 0:l.expectedType);var m,h;if("multiLineText"===s||c||"hyperlink"===s)return i=null!==(m=i)&&void 0!==m?m:"",n=null!==(h=n)&&void 0!==h?h:"",y(i,n);if("number"===s||r)return C(i,n);if("singleChoice"===s){var f,g,_,w;if(l&&a&&(null===(f=l.choices)||void 0===f?void 0:f.length)===(null===(g=a.choices)||void 0===g?void 0:g.length)){if(i===n)return 0;for(const e of l.choices){if(e.id===i)return-1;if(e.id===n)return 1}return 0}return y(null===(_=o()(null===l||void 0===l?void 0:l.choices,(e=>e.id===i)))||void 0===_?void 0:_.name,null===(w=o()(null===a||void 0===a?void 0:a.choices,(e=>e.id===n)))||void 0===w?void 0:w.name)}if("multiChoice"===s){return y(p()(b()(v()(u()(i,(e=>{var t;return null===(t=o()(null===l||void 0===l?void 0:l.choices,(t=>t.id===e)))||void 0===t?void 0:t.name}))))),p()(b()(v()(u()(n,(e=>{var t;return null===(t=o()(null===a||void 0===a?void 0:a.choices,(t=>t.id===e)))||void 0===t?void 0:t.name}))))))}if("member"===s)return x(i,n);if("datetime"===s||"updateTime"===s||"createTime"===s){return C(i&&new Date(i).getTime(),n&&new Date(n).getTime())}return"attachment"===s?x(i,n):"boolean"===s?function(e,t){const i=e?1:0,n=t?1:0;return i===n?0:i>n?-1:1}(i,n):0}},18451:(e,t,i)=>{i.d(t,{_m:()=>n,hK:()=>l,kl:()=>o,ok:()=>a});const n="#ADD-ROW",o="#INDEX-COLUMN",l="#ADD-COLUMN",a={id:n,order:-1}},19611:(e,t,i)=>{i.d(t,{$:()=>l,C:()=>o});var n=i(57435);const o=(0,n.createContext)({injector:null,getState:null,dispatch:null});function l(e){const{injector:t,getState:i,dispatch:l}=(0,n.useContext)(o);if(!t||!i||!l)throw new Error("No context provided: useInjection() can only be used in a descendant of <DependencyInjectionProvider>");const a=t.get(e);return{injector:t,entity:a,getState:i,dispatch:l}}},75801:(e,t,i)=>{i.d(t,{$1:()=>o.$,vK:()=>n.v});var n=i(40431),o=(i(65502),i(19611))},65502:(e,t,i)=>{i.d(t,{z:()=>l});var n=i(57323),o=i.n(n);class l{constructor(){o()(this,"bindings",new Map)}bind(e,t){if(this.bindings.has(e))throw new Error("Identifier ".concat(e.toString()," already exists"));return this.bindings.set(e,t),this}get(e){if(this.bindings.has(e)){const t=this.bindings.get(e);if("function"===typeof t){const i=new t;return this.bindings.set(e,i),i}return t}throw new Error("Identifier ".concat(e.toString()," does not exist"))}}},40431:(e,t,i)=>{i.d(t,{v:()=>n});const n={common:Symbol.for("common"),multiLineText:Symbol.for("multiLineText"),select:Symbol.for("select"),number:Symbol.for("number"),datetime:Symbol.for("datetime"),coordinate:Symbol.for("coordinate"),formula:Symbol.for("formula"),attachment:Symbol.for("attachment"),hyperlink:Symbol.for("hyperlink"),related:Symbol.for("related"),lookup:Symbol.for("lookup"),grid:Symbol.for("grid")}},58564:(e,t,i)=>{i.d(t,{AJ:()=>a,Se:()=>l,_l:()=>o});var n=i(18451);function o(e){var t;const{rowNode:i}=e;return(null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.id)===n._m||!0===(null===i||void 0===i?void 0:i.footer)}function l(e){var t;return(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.id)!==n._m&&!0!==(null===e||void 0===e?void 0:e.footer)}function a(e){var t;return(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.id)===n._m||!0===(null===e||void 0===e?void 0:e.footer)}},57878:(e,t,i)=>{i.d(t,{P:()=>o});var n=i(75801);function o(e){var t,i,o;const{entity:l}=(0,n.$1)(n.vK.multiLineText),{useParameters:a,useColumn:s}=l,{tableNodeId:d}=a(),r=(null===(t=e.column)||void 0===t?void 0:t.getColDef().cellEditorParams)||e,u=null!==(i=s(d,null===(o=e.colDef)||void 0===o?void 0:o.field))&&void 0!==i?i:r;return{typeOptions:u.typeOptions,type:u.type,inGrid:r.inGrid}}},80785:(e,t,i)=>{i.d(t,{GF:()=>Y,Io:()=>X,Nm:()=>W,cW:()=>J});var n=i(57435),o=i(95620),l=i(27371),a=i(7070),s=i.n(a),d=i(85886),r=i.n(d),u=i(62618),c=i.n(u),v=i(97102),m=i.n(v),p=i(15288),h=i.n(p),f=i(17646),g=i.n(f),b=i(82959),y=i.n(b),C=i(8651),x=i.n(C),_=i(41989),w=i.n(_),I=i(77528),j=i.n(I),k=i(18765),D=i.n(k),N=i(34362),E=i.n(N),T=i(84527),M=i.n(T),S=i(65301),P=i.n(S),R=i(74110),A=i(98238),Z=i(11546),F=i(18451),O=i(58564),L=i(30423),$=i(57830),G=i(68885),B=i(67661),H=i(81987),V=i(36689),K=i(1714),z=i(30731);const U=50,q=2e3;function W(e){const t=(0,L.I)(),i=(0,o.Z)(),{tableNodeId:a,projectId:s}=(0,$.F)(),{tableNode:d}=(0,B.Cc)(s,a),r=(null===d||void 0===d?void 0:d.type)===R.e.bigTable,{getTableRowLevelPermission:u}=(0,H.q)(),c=(0,n.useMemo)((()=>u(a)),[a,u]),v=(0,n.useCallback)(((e,i)=>{if(e.finished&&e.column&&e.column.getId()!==F.kl){var n;let o=e.column.getActualWidth();o<U&&(o=U),o>q&&(o=q);(null===i||void 0===i||null===(n=i.columns)||void 0===n||null===(n=n.find((t=>{var i;return t.id===(null===(i=e.column)||void 0===i?void 0:i.getId())})))||void 0===n?void 0:n.width)!==o&&null!==i&&void 0!==i&&i.id&&t((0,G.Uk)({id:a,viewId:i.id,columnIds:[e.column.getId()],params:{width:Math.round(o)}}))}}),[t,a]),m=(0,n.useCallback)((async(e,i,n)=>await t((0,G.v)({id:e,prevRowId:i,cells:n}))),[t]),p=(0,n.useCallback)((e=>c&&c.enabled&&(0,z.UM)(c.filter,e)?(l.ZP.error(i.$t({id:"3iO0eR",defaultMessage:"Not allowed to delete column related to row level permissions"})),!1):(t((0,G.ih)({id:a,columnIds:[e]})),!0)),[t,a,c,i]),h=(0,n.useCallback)(((e,n)=>{const o=(0,A.D8)(new Set(n),i.$t({id:"field.name.multiLineText",defaultMessage:[]}));t((0,G.wy)({id:a,name:o,type:"multiLineText",prevColumnId:e}))}),[t,i,a]),f=(0,n.useCallback)(((e,n)=>{if(c&&c.enabled&&(0,z.UM)(c.filter,e))return l.ZP.error(i.$t({id:"5KSDX0",defaultMessage:"Not allowed to edit column related to row level permissions"})),!1;const o=r?G.Cv:G.Gw;t(o({id:a,columnId:e,name:n.name,desc:n.desc,type:n.type,typeOptions:n.typeOptions,state:n.state}))}),[t,a,r,c,i]);return{resizeColumn:v,removeColumn:p,insertColumn:h,updateCell:(0,n.useCallback)(((e,i)=>{if(void 0===e.newValue)return!0;const n=e.data.id,o=e.colDef.field,l=""===e.newValue?null:e.newValue,a=e.data[o];return e.data[o]=l,t((0,G.I)({id:i,rowId:n,cells:{[o]:l},prevCells:{[o]:a}})),!0}),[t]),clearSelectionAndFocus:(0,n.useCallback)((e=>{null===e||void 0===e||e.clearRangeSelection(),null===e||void 0===e||e.clearFocusedCell()}),[]),addColumn:(0,n.useCallback)(((e,i)=>t((0,G.wy)({id:a,prevColumnId:e,...i}))),[t,a]),updateColumn:f,insertRow:m,scroll:(0,n.useCallback)((t=>{var i,n;"horizontal"===t.direction&&(t.left>0?null===e||void 0===e||null===(i=e.current)||void 0===i||i.classList.add("mt-grid-scroll"):null===e||void 0===e||null===(n=e.current)||void 0===n||n.classList.remove("mt-grid-scroll"))}),[e])}}function J(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=(0,L.v)(K.Em.selectAll),d=(0,n.useMemo)((()=>D()(a,(t=>t.tableNodeID===e.id))),[a,e.id]),u=Y(e,t,l),v=function(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{hasGroup:l}=(0,V.HI)(e.id,null===t||void 0===t?void 0:t.id),a=(0,n.useMemo)((()=>{const n=h()(m()(e.rows,"id"),(e=>e[0])),a=c()(null===t||void 0===t?void 0:t.rows,"order"),d=j()(e.columns,(e=>"subscribed"===e.mode||"connected"===e.mode));return o?e.rows:y()(r()(s()(a,(e=>n[e.id]?{...e,...n[e.id].cells}:void 0)),d||!i||l?void 0:F.ok))}),[e.columns,e.rows,i,o,null===t||void 0===t?void 0:t.rows,l]);return a}(e,t,i,o);return{updatingColumns:d,columnData:u,rowData:v}}function Y(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,n.useMemo)((()=>{if(null===e||void 0===e||!e.columns)return[];const n=h()(m()(e.columns,"id"),(e=>e[0]));let o=null===t||void 0===t?void 0:t.columns;if(i)o=c()(o,"order");else{const t=e.columns.map((e=>e.id));o=t.map((e=>{var t;return null===(t=o)||void 0===t?void 0:t.find((t=>t.id===e))})).filter((e=>void 0!==e))}return y()(s()(o,(e=>n[e.id]?{...e,...n[e.id]}:void 0)))}),[null===e||void 0===e?void 0:e.columns,null===t||void 0===t?void 0:t.columns,i])}function X(e){const{tableNodeId:t,projectId:i}=(0,$.F)(),{tableNode:l}=(0,B.Cc)(i,t),{clearSelectionAndFocus:a}=W(),d=(0,L.I)(),r=(0,o.Z)(),u=(0,n.useCallback)((e=>{var i,n,o,l,a,r,u;const c=null===e||void 0===e||null===(i=e.getCellRanges())||void 0===i?void 0:i[0];if(void 0===c){var v,m,p;const i=null===e||void 0===e?void 0:e.getFocusedCell(),n=null===i||void 0===i||null===(v=i.column)||void 0===v?void 0:v.getId(),o=null===i||void 0===i?void 0:i.rowIndex;if(void 0===n||void 0===o)return!0;const l=null===e||void 0===e?void 0:e.getDisplayedRowAtIndex(o);return d((0,G.Sq)({id:t,params:{destColumnIDs:[n],destRowIDs:[null===l||void 0===l||null===(m=l.data)||void 0===m?void 0:m.id]},destCells:null!==l&&void 0!==l&&null!==(p=l.data)&&void 0!==p&&p.id?{[l.data.id]:{[n]:l.data[n]}}:void 0})),!0}if(j()(null===c||void 0===c?void 0:c.columns,(e=>{var t;return E()(Z.L8,null===(t=e.getColDef())||void 0===t||null===(t=t.cellEditorParams)||void 0===t?void 0:t.type)})))return!1;const h=[],f=null!==(n=x()([null===c||void 0===c||null===(o=c.startRow)||void 0===o?void 0:o.rowIndex,null===c||void 0===c||null===(l=c.endRow)||void 0===l?void 0:l.rowIndex]))&&void 0!==n?n:0,b=null!==(a=w()([null===c||void 0===c||null===(r=c.startRow)||void 0===r?void 0:r.rowIndex,null===c||void 0===c||null===(u=c.endRow)||void 0===u?void 0:u.rowIndex]))&&void 0!==a?a:0,y=s()(null===c||void 0===c?void 0:c.columns,(e=>e.getColId())),C={};for(let t=f;t<=b;t++){const i=null===e||void 0===e?void 0:e.getDisplayedRowAtIndex(t);if(null!==i&&void 0!==i&&i.id){const e=i.id;h.push(e),g()(y,(t=>{C[e]={[t]:i.data[t]}}))}}return d((0,G.Sq)({id:t,params:{destColumnIDs:y,destRowIDs:h},destCells:C})),!0}),[d,t]),c=(0,n.useCallback)((e=>{var i,n,o,l,s,r,u;const c=null===e||void 0===e||null===(i=e.getCellRanges())||void 0===i?void 0:i[0];if(void 0===c){const i=null===e||void 0===e?void 0:e.getFocusedCell();if(void 0===(null===i||void 0===i?void 0:i.rowIndex))return!1;const n=null===e||void 0===e?void 0:e.getDisplayedRowAtIndex(null===i||void 0===i?void 0:i.rowIndex);return!(!n||!n.data)&&(d((0,G.M5)({id:t,rowIDs:[n.data.id]})),a(e),!0)}if(j()(null===c||void 0===c?void 0:c.columns,(e=>{var t;return E()(Z.L8,null===(t=e.getColDef())||void 0===t||null===(t=t.cellEditorParams)||void 0===t?void 0:t.type)})))return!1;const v=[],m=null!==(n=x()([null===c||void 0===c||null===(o=c.startRow)||void 0===o?void 0:o.rowIndex,null===c||void 0===c||null===(l=c.endRow)||void 0===l?void 0:l.rowIndex]))&&void 0!==n?n:0,p=null!==(s=w()([null===c||void 0===c||null===(r=c.startRow)||void 0===r?void 0:r.rowIndex,null===c||void 0===c||null===(u=c.endRow)||void 0===u?void 0:u.rowIndex]))&&void 0!==s?s:0;for(let t=m;t<=p;t++){const i=null===e||void 0===e?void 0:e.getDisplayedRowAtIndex(t);null!==i&&void 0!==i&&i.id&&v.push(i.id)}return d((0,G.M5)({id:t,rowIDs:v})),a(e),!0}),[d,t,a]),v=(0,n.useCallback)((i=>{var n;if(!i.node||!i.column||(0,O.AJ)(i.node))return[];i.api.deselectAll();const o=e?{name:r.$t({id:"he44TW",defaultMessage:"Expand record"}),action:()=>{var t;return e(null===(t=i.node)||void 0===t?void 0:t.data.id)}}:null,s=null===(n=i.api)||void 0===n||null===(n=n.getCellRanges())||void 0===n?void 0:n[0],v=null===l||void 0===l?void 0:l.mode;if("subscribed"===v||"connected"===v||j()(null===s||void 0===s?void 0:s.columns,(e=>{var t;const i=null===(t=e.getColDef())||void 0===t||null===(t=t.cellEditorParams)||void 0===t?void 0:t.mode;return"subscribed"===i||"connected"===i})))return o?[o]:[];const m=j()(null===s||void 0===s?void 0:s.columns,(e=>{var t;return E()(Z.L8,null===(t=e.getColDef())||void 0===t||null===(t=t.cellEditorParams)||void 0===t?void 0:t.type)})),p=[];if(!((null===s||void 0===s?void 0:s.startRow)&&(null===s||void 0===s?void 0:s.endRow)&&s.endRow.rowIndex-s.startRow.rowIndex>0)){var h;const e=(null===l||void 0===l?void 0:l.type)===R.e.bigTable;!e&&p.push({name:r.$t({id:"bAGIhw",defaultMessage:"Insert record above"}),action(){var e,n;const o=null===(e=i.node)||void 0===e?void 0:e.rowIndex;a(i.api);const l=null===(n=i.api)||void 0===n?void 0:n.getDisplayedRowAtIndex(o-1);d((0,G.v)({id:t,prevRowId:null===l||void 0===l?void 0:l.data.id})).then((()=>{var e;null===(e=i.api)||void 0===e||e.refreshCells()}))}},{name:r.$t({id:"EKBw1H",defaultMessage:"Insert record below"}),action(){var e,n;const o=null===(e=i.node)||void 0===e?void 0:e.rowIndex,l=null===(n=i.api)||void 0===n?void 0:n.getDisplayedRowAtIndex(o);d((0,G.v)({id:t,prevRowId:null===l||void 0===l?void 0:l.data.id})).then((()=>{var e;null===(e=i.api)||void 0===e||e.refreshCells()}))}}),o&&p.push(o);const n=null===(h=i.api)||void 0===h?void 0:h.getDisplayedRowAtIndex(i.node.rowIndex);e?p.push({name:r.$t({id:"quFyfD",defaultMessage:"Duplicate record"}),action(){d((0,G.ZG)({id:t,cells:M()(null===n||void 0===n?void 0:n.data,D()(P()(null===n||void 0===n?void 0:n.data),(e=>!E()(["id","cells","meta"],e))))}))}}):p.push({name:r.$t({id:"quFyfD",defaultMessage:"Duplicate record"}),action(){d((0,G.v)({id:t,prevRowId:null===n||void 0===n?void 0:n.data.id,cells:null===n||void 0===n?void 0:n.data}))}})}return p.push({name:r.$t({id:"wycwyU",defaultMessage:"Clear data"}),disabled:m,tooltip:m?r.$t({id:"5tv/gS",defaultMessage:"The current field type cannot be cleared"}):void 0,action(){u(i.api)}},"separator",{name:r.$t({id:"Lc9nUH",defaultMessage:"Delete record"}),cssClasses:["danger"],action(){c(i.api)}}),p}),[a,u,c,e,d,r,null===l||void 0===l?void 0:l.type,t,null===l||void 0===l?void 0:l.mode]);return{deleteSelectedCells:u,getContextMenuItems:v}}},36689:(e,t,i)=>{i.d(t,{HI:()=>w,YI:()=>I,ZP:()=>j,s3:()=>_});var n=i(57435),o=i(38981),l=i.n(o),a=i(17646),s=i.n(a),d=i(8942),r=i.n(d),u=i(88716),c=i.n(u),v=i(53182),m=i.n(v),p=i(23903),h=i.n(p),f=i(37756),g=i.n(f),b=i(76825),y=i(30423),C=i(1714),x=(i(68885),i(70));const _="#empty_cell_id";function w(e,t){const{view:i}=(0,x.Pl)(e,t),o=(0,n.useMemo)((()=>!c()(null===i||void 0===i?void 0:i.groups)),[null===i||void 0===i?void 0:i.groups]),l=(0,n.useCallback)((e=>{if(o&&e&&void 0!==(null===e||void 0===e?void 0:e.rowIndex)){if(e.footer)return g()(e.allLeafChildren);if(e.group)return m()(e.allLeafChildren)}return e}),[o]),a=(0,n.useCallback)((e=>{if(!o||!e)return;let t;if(e=e.group?e:e.parent)for(t={};e&&e.group;){try{if(!e.key)break;const i=JSON.parse(e.key);t[i.id]=void 0===i.value?null:i.value}catch{break}if(!e.parent)break;e=e.parent}return t}),[o]);return{hasGroup:o,getDataRowNode:l,getGroupCells:a}}function I(e,t){const i=(0,y.v)((t=>{var i;return null===(i=C.TW.selectById(t,e))||void 0===i?void 0:i.columns}));return{parseCellValue:(0,n.useCallback)((e=>{const n={id:"",name:"",type:"multiLineText"};try{const a=JSON.parse(e),s=a.value;if(s){n.value=s;const e=h()(i,(e=>e.id===a.id));var o;if(e)if(n.id=e.id,n.type=e.type,n.typeOptions=e.typeOptions,n.name=e.name,"multiLineText"===n.type)n.value=null===(o=l()(s))||void 0===o?void 0:o.replace(/[\n\r\t]/g,"")}else n.id=_,n.value=t.$t({id:"TH6A3r",defaultMessage:"(null value)"})}catch{}return n}),[t,i]),groupComparator:(0,n.useCallback)(((e,t)=>{try{var i;if(!e.key||!t.key)return 0;const n=JSON.parse(e.key),o=JSON.parse(t.key),l=null===(i=e.rowGroupColumn)||void 0===i?void 0:i.getColDef().headerComponentParams;let a=0;if(l){const e={realValue:n.value,type:l.type,typeOptions:l.typeOptions},t={realValue:o.value,type:l.type,typeOptions:l.typeOptions};a=(0,b.U)(e,t)}else{const e=n.value,t=o.value;a=e<t?-1:e>t?1:0}return"desc"===n.order?-a:a}catch{return 0}}),[])}}function j(e,t){const[i,o]=(0,n.useState)({}),[l,a]=(0,n.useState)({}),[d,u]=(0,n.useState)(!1),{view:c}=(0,x.Pl)(e,t);return(0,n.useEffect)((()=>{if(!r()(l,i)){let e=Object.keys(i).length===Object.keys(l).length;e&&s()(i,((t,i)=>{var n;(null===(n=l[i])||void 0===n?void 0:n.groupIndex)!==t.groupIndex&&(e=!1)})),e&&u(!1),a(i),setTimeout((()=>{u(!0)}),0)}}),[l,i]),(0,n.useEffect)((()=>{if(null!==c&&void 0!==c&&c.groups&&(null===c||void 0===c?void 0:c.groups.length)>0){const e={};let t=0;s()(null===c||void 0===c?void 0:c.groups,((i,n)=>{t=n+1,e[i.columnID]={order:i.order,groupIndex:t}})),o(e)}else a({}),o({}),u(!1)}),[null===c||void 0===c?void 0:c.groups]),{groups:i,hasGroup:d}}},53936:(e,t,i)=>{i.d(t,{Z:()=>ci});var n=i(65502),o=i(40431),l=i(57323),a=i.n(l),s=i(91671),d=i(58590),r=i(57435),u=i(13307),c=i.n(u),v=i(17646),m=i.n(v),p=i(18451),h=i(70554),f=i(57830),g=i(74797),b=i(22963);const y=(0,b.Fs)({baseURL:"".concat(g.Z.baseApiURL,"/collaborator/")});class C extends b.tr{async update(e){const{projectID:t,sessionID:i,selected:n,keep:o}=e,{data:l}=await this.fetch.patch("update/",{projectID:t,selected:n,sessionID:i,keep:o},{ignoreError:!0});return l}}const x=new C(y);var _=i(40365);const{createAsyncAction:w}=(0,_.w)({typePrefix:"collaborator"}),I=w("update",(async e=>{const{projectID:t,selected:i,sessionID:n,keep:o}=e;return await x.update({projectID:t,selected:i,sessionID:n,keep:o})}));var j=i(46481),k=i(56717),D=i.n(k);const N=(0,j.P1)([(e,t)=>e.collaborator.cellCollaborators,(e,t)=>t.cellId],((e,t)=>e[t])),E=(0,j.P1)([e=>e.collaborator.otherCollaborators],(e=>D()(e)));var T=i(3705),M=i(30423);const S=1e4,P=600;function R(e,t){const i="".concat(e,",").concat(t),n=(0,M.v)((e=>N(e,{cellId:i}))),o=[];let l="transparent";return m()(n,(e=>{o.push(e.name),l=e.color})),{name:o,color:l}}function A(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{viewId:t}=e,i=(0,M.I)(),{tableNodeId:n,projectId:o}=(0,f.F)(),l=(0,M.v)(h.nb.selectAll),a=(0,M.v)((e=>e.collaborator.updatedTime)),s=(0,M.v)((e=>e.collaborator.cellCollaborators)),d=(0,M.v)((e=>e.app.wsReadyState)),u=(0,M.v)((e=>e.user.sessionId)),v=(0,M.v)(E),g=(0,r.useRef)(s),b=(0,r.useRef)(null),y=(0,r.useRef)();(0,r.useEffect)((()=>{g.current=s}),[s]);const C=(0,r.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(u&&n&&d===T.XZ.OPEN){const{columnId:l,rowId:a,viewId:s}=null!==e&&void 0!==e?e:{};i(I({projectID:o,selected:l?{columnID:l,rowID:a,tableNodeID:n,viewID:s}:null,sessionID:u,keep:t})),!t&&i(h.Nw.setUpdatedTime(Date.now()))}}),[i,o,u,n,d]),x=(0,r.useRef)(c()(C,P));(0,r.useEffect)((()=>{x.current=c()(C,P)}),[C]);const _=(0,r.useCallback)((()=>(function e(){y.current&&clearTimeout(y.current),y.current=setTimeout((()=>{C(void 0,!0),e()}),S)}(),()=>{y.current&&clearTimeout(y.current)})),[C]),w=(0,r.useCallback)((e=>{let t=!1;const i=e.node;return m()(g.current,(e=>{m()(e,(e=>{var n;e.rowID===(null===(n=i.data)||void 0===n?void 0:n.id)&&(t=!0)}))})),t}),[g]),j=(0,r.useCallback)((e=>{const i=e.api;if(t){var n,o;const e=null===i||void 0===i||null===(n=i.getCellRanges())||void 0===n?void 0:n[0],l=null===e||void 0===e||null===(o=e.startRow)||void 0===o?void 0:o.rowIndex,a=null===e||void 0===e?void 0:e.startColumn,s=null===a||void 0===a?void 0:a.getColId();if("undefined"!==typeof l&&s!==p.kl&&s!==p.hK){const e=null===i||void 0===i?void 0:i.getDisplayedRowAtIndex(l);if(null!==e&&void 0!==e&&e.group||null!==e&&void 0!==e&&e.footer)return;const n="".concat(s,"_").concat(null===e||void 0===e?void 0:e.id);b.current!==n&&(b.current=n,x.current({columnId:s,rowId:null===e||void 0===e?void 0:e.id,viewId:t}))}}}),[t]);return{collaborators:l,otherCollaborators:v,cellCollaborators:s,getCellCollaborators:e=>{const t=[];let i="";const n=s;if(e&&n){var o;const l=null===(o=e.colDef)||void 0===o?void 0:o.field,a=e.data.id,s="".concat(l,",").concat(a);m()(null===n||void 0===n?void 0:n[s],(e=>{t.push(e.name),i=e.color}))}return{name:t.join(", "),color:i}},updateCollaborator:C,checkIsCollaboratorRow:w,onCellFocused:j,autoUpdate:_,updatedTime:a}}var Z=i(68885),F=i(23903),O=i.n(F),L=i(1714);i(41012);function $(e,t){const i=(0,M.v)((t=>L.TW.selectById(t,null!==e&&void 0!==e?e:NaN)));return(0,r.useMemo)((()=>O()(null===i||void 0===i?void 0:i.columns,(e=>e.id===t))),[t,null===i||void 0===i?void 0:i.columns])}var G=i(49210),B=i(98403),H=i(74720),V=i.n(H),K=i(43179),z=i.n(K),U=i(57316);function q(e,t){var i,n;const o=null!==(i=null===e||void 0===e?void 0:e.dateFormat)&&void 0!==i?i:Object.keys(U.zT)[0],l=null!==(n=null===e||void 0===e?void 0:e.timeFormat)&&void 0!==n?n:Object.keys(U.T_)[2],a=null!==e&&void 0!==e&&e.showTimezone&&t?" ([GMT ".concat((0,B.iR)(z()(),t).format("Z"),"])"):"";return"".concat(V()(U.zT,o)," ").concat(V()(U.T_,l)).concat(a).trim()}var W=i(6686);const J=(0,b.Fs)({baseURL:"".concat(g.Z.baseApiURL,"/formula/")});class Y extends b.tr{async gets(){const{data:e}=await this.fetch.get("docs/");return e.detail||[]}async check(e){const{data:t}=await this.fetch.post("check/",{source:e});return t}}const X=new Y(J);var Q=i(26436),ee=i(95620),te=i(32578),ie=i(8942),ne=i.n(ie),oe=i(2542),le=i.n(oe),ae=i(11546),se=i(38981),de=i.n(se),re=i(7070),ue=i.n(re),ce=i(15972),ve=i.n(ce),me=i(96271),pe=i(69151),he=i(70);const fe=Object.keys(me.Jp),ge=fe.length,be=e=>!!e&&["singleChoice","multiChoice"].includes(e);function ye(e,t,i,n){var o;const{tableNodeId:l}=(0,f.F)(),{view:a}=(0,he.Pl)(),d=(0,M.I)(),u=(0,ee.Z)(),c=(0,M.v)((e=>e.project.members)),{type:v,columns:m}=null!==(o=(0,M.v)((e=>L.TW.selectById(e,l))))&&void 0!==o?o:{};const h=(0,r.useCallback)(((e,t)=>{e&&d((0,Z.Yg)({id:l,viewId:null===a||void 0===a?void 0:a.id,columnId:e,prevColumnId:t}))}),[d,l,null===a||void 0===a?void 0:a.id]);return{view:a,columns:m,tableType:v,tableNodeId:l,getFieldChoices:function(o,l){if(e&&be(o)){var a,d,r,v;if(be(t))return;if(be(null===i||void 0===i?void 0:i.type))return null===i||void 0===i?void 0:i.typeOptions.choices;if(i&&(0,pe.pk)(i))return null===i||void 0===i||null===(v=i.typeOptions.lookupColumnTypeOptions)||void 0===v?void 0:v.choices;const m={},h="formula"===(null===i||void 0===i?void 0:i.type)?null!==(a=null===i||void 0===i||null===(d=i.typeOptions)||void 0===d?void 0:d.expectedType)&&void 0!==a?a:"number":(0,pe.wf)(i)?"member":null===i||void 0===i?void 0:i.type,f="formula"===(null===i||void 0===i?void 0:i.type)?ve()({},null===i||void 0===i?void 0:i.typeOptions,{format:null===i||void 0===i?void 0:i.typeOptions.numberFormat,precision:null!==(r=null===i||void 0===i?void 0:i.typeOptions.numberPrecision)&&void 0!==r?r:0,dateFormat:null===i||void 0===i?void 0:i.typeOptions.datetimeDateFormat,timeFormat:null===i||void 0===i?void 0:i.typeOptions.datetimeTimeFormat}):null===i||void 0===i?void 0:i.typeOptions;let g=0;return null===n||void 0===n||n.forEachNode((t=>{var i,n;if((null===t||void 0===t||null===(i=t.data)||void 0===i?void 0:i.id)===p._m)return;const a=((e,t,i,n,o)=>{var l,a,d;switch(t){case"number":return[(0,s.P)(i,null===n||void 0===n?void 0:n.precision,null===n||void 0===n?void 0:n.format)];case"datetime":return[(0,G.U)(de()(i),n,o)];case"multiLineText":return e?null===(l=de()(i))||void 0===l?void 0:l.replace(/[\n\r\t]/g,"").split(","):[null===(a=de()(i))||void 0===a?void 0:a.replace(/[\n\r\t]/g,"")];case"attachment":return ue()(i,(e=>"".concat(e.fileName,"(").concat(e.url,")")));case"related":return ue()(i,(e=>e.displayName));case"lookup":return Array.isArray(i)?(0,pe._M)({type:t,typeOptions:n})?ue()(i,(e=>(0,G.U)(de()(e),n,o))):ue()(i,(e=>{var t;return null===(t=de()(e))||void 0===t?void 0:t.replace(/[\n\r\t]/g,"")})):[null===(d=de()(i))||void 0===d?void 0:d.replace(/[\n\r\t]/g,"")];case"member":return ue()(i,(e=>{var t,i;return null!==(t=null===(i=O()(c,(t=>t.id===e)))||void 0===i?void 0:i.name)&&void 0!==t?t:de()(e)}));case"boolean":return[u.$t({id:"KKkUks",defaultMessage:"True"}),u.$t({id:"rxqs5U",defaultMessage:"False"})];default:return[i]}})("multiChoice"===o,h,null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n[e],f,l);null===a||void 0===a||a.forEach((e=>{"string"===typeof e&&e.trim()&&!m[e]&&(m[e]={name:de()(e),color:fe[g%ge]},g++)}))})),Object.values(m)}},onColumnMoved:h,onColumnVisibilityChanged:function(e,t){d((0,Z.Uk)({id:l,viewId:null===a||void 0===a?void 0:a.id,columnIds:[e],params:{isHidden:!t}}))},showAllColumns:function(){var e;const t=null===a||void 0===a||null===(e=a.columns)||void 0===e?void 0:e.filter((e=>e.isHidden)).map((e=>e.id));0!==(null===t||void 0===t?void 0:t.length)&&d((0,Z.Uk)({id:l,viewId:null===a||void 0===a?void 0:a.id,columnIds:null!==t&&void 0!==t?t:[],params:{isHidden:!1}}))},hiddenAllColumns:function(){var e,t;const i=null===(e=m.find((e=>e.isPrimary)))||void 0===e?void 0:e.id,n=null===a||void 0===a||null===(t=a.columns)||void 0===t?void 0:t.filter((e=>!e.isHidden&&e.id!==i)).map((e=>e.id));0!==(null===n||void 0===n?void 0:n.length)&&d((0,Z.Uk)({id:l,viewId:null===a||void 0===a?void 0:a.id,columnIds:null!==n&&void 0!==n?n:[],params:{isHidden:!0}}))}}}const Ce=e=>t=>{if(t){const e=t.name,i=le()("<%- value %>");return"<span contentEditable='false' class='variable' data-id='".concat(t.id,"'>{").concat(i({value:e}),"}</span>")}return"<span contentEditable='false' class='variable error' data-id='undefined'>".concat(e.$t({id:"ygNK0h",defaultMessage:"Invalid field"}),"</span>")},xe=function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"<span contentEditable='false'>".concat(e.replace("()",""),"</span>()"):"<span contentEditable='false'>".concat(e,"</span>")};function _e(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const i=(0,ee.Z)(),{data:n}=(0,te.Z)("formulas",(async()=>{const e=await X.gets(),t={};for(const i of e)t[i.name.replace("()","")]=i;return{names:t,formulas:e}})),[o,l]=(0,r.useState)([]),[a,s]=(0,r.useState)({}),{columns:d,view:u}=ye();return(0,r.useEffect)((()=>{const e=new Map((d||[]).map((e=>[e.id,e]))),i=((null===u||void 0===u?void 0:u.columns)||[]).map((i=>{var n;const o=e.get(i.id);return o&&null!==(n=ae.Z9[o.type])&&void 0!==n&&n.computable&&o.name.toLowerCase().indexOf(t)>-1&&("lookup"!==o.type||(0,pe.eU)(o))?o:null})).filter(Boolean);ne()(i,o)||l(i)}),[o,d,null===u||void 0===u?void 0:u.columns,t]),(0,r.useEffect)((()=>{const e={},i=(t||"").trim();for(const t of(null===n||void 0===n?void 0:n.formulas)||[])e[t.group]||(e[t.group]=[]),t.name.toLowerCase().indexOf(i)>-1&&e[t.group].push(t);s((t=>ne()(e,t)?t:e))}),[n,t]),{formulaGroups:a,formulaNames:null!==(e=null===n||void 0===n?void 0:n.names)&&void 0!==e?e:{},computableColumns:o,viewColumns:null===u||void 0===u?void 0:u.columns,getFieldNode:Ce(i),getFormulaNode:xe}}const we=new RegExp("\uff0c|\uff09|\uff08|\uff0b|\uff0d|\uff0a|\uff0f|,|&|\\)|\\(|\\+|\\/|-|\\*|\\.","g"),Ie=(e,t)=>{if(e){var i;const n=3===e.nodeType,o=null===(i=e.textContent)||void 0===i?void 0:i.length;n||e.isContentEditable?o?(t.setStart(e,o-1),t.setEnd(e,o)):(e.previousSibling&&Ie(e.previousSibling,t),t.setStart(e,0),t.setEnd(e,0),e.remove()):(t.setStart(e,0),t.setEnd(e,0),e.remove())}},je=function(e,t,i){let n;const o=arguments.length>4&&void 0!==arguments[4]&&arguments[4]?0:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"").length;if(window.getSelection&&t&&(n=window.getSelection(),n&&null!=n.getRangeAt&&n.rangeCount)){t.deleteContents();const l=document.createElement("div");l.innerHTML=e;const a=document.createDocumentFragment();let s,d;for(;s=l.firstChild;)d=a.appendChild(s);if(o){const e=null===i||void 0===i?void 0:i.textContent;i&&e&&(t.setStart(i,t.endOffset-o),t.deleteContents(),n.removeAllRanges(),n.addRange(t))}t.insertNode(a),d&&(t=t.cloneRange(),"()"===d.textContent?t.setStart(d,1):t.setStartAfter(d),t.collapse(!0),n.removeAllRanges(),n.addRange(t))}};function ke(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const{formulaNames:n,computableColumns:o,getFieldNode:l,getFormulaNode:a}=_e(),[s,d]=(0,r.useState)(null),[u,c]=(0,r.useState)(i),[v,m]=(0,r.useState)(),[p,h]=(0,r.useState)(!1),[f,g]=(0,r.useState)("");(0,r.useEffect)((()=>{e.current&&document.activeElement===e.current&&m((()=>{let e,t;return window.getSelection&&(e=window.getSelection(),e&&e.rangeCount&&(t=e.getRangeAt(0))),t})())}),[e,t]),(0,r.useEffect)((()=>{if(!p&&e.current&&v&&i&&o.length){const e=(0,Q.ev)(i),t=(Array.isArray(e)?e:[]).map((e=>{if(0===(0,Q.cq)(e,"$c_")){const t=e.replace("$c_",""),i=o.find((e=>e.id===t));return l(i)}return n[e]?a(e):e}));je(t.join(""),v,s,f),h(!0)}}),[l,a,p,e,v,i,o,n,f,s]),(0,r.useEffect)((()=>{if(e.current){const{text:t,node:i}=(e=>{var t;let i,n="";if(window.getSelection){let t=0;const l=window.getSelection();if(l&&l.rangeCount){const a=l.getRangeAt(0);e!==a.commonAncestorContainer&&e.contains(a.commonAncestorContainer)&&(t=a.endOffset);const s=document.getSelection(),d=null===s||void 0===s?void 0:s.anchorNode;var o;d&&(n=(null===(o=d.textContent)||void 0===o?void 0:o.substr(0,t))||"",i=d)}}return{text:(null===(t=n)||void 0===t?void 0:t.toLowerCase().split(we).pop())||"",node:i}})(e.current);g(t),i&&d(i);const n=b(e.current);n!==u&&c(n)}}),[e,v,t,u]);const b=e=>(0,Q.fw)(e.childNodes).join(" ");return{range:v,autoCompleteText:f,formulaExpression:u,insertNode:function(e){return je(e,v,s,f,arguments.length>1&&void 0!==arguments[1]&&arguments[1])},removeNode:()=>((e,t)=>{let i;if(window.getSelection&&e&&(i=window.getSelection(),i&&null!=i.getRangeAt&&i.rangeCount&&t)){const n=e.commonAncestorContainer;if(3===n.nodeType)e.endOffset&&n.textContent?e.setStart(t,e.endOffset-1):Ie(n.previousSibling,e);else if(e.endOffset&&e.startOffset===e.endOffset){const i=n.childNodes[e.endOffset-1];3===i.nodeType?Ie(i,e):e.setStart(t,e.endOffset-1)}e.deleteContents(),i.removeAllRanges(),i.addRange(e)}})(v,s)}}var De=i(40522),Ne=i(82394),Ee=i(90875),Te=i(62502),Me=i(63679),Se=i.n(Me),Pe=i(82959),Re=i.n(Pe),Ae=i(80585),Ze=i.n(Ae),Fe=i(12167);function Oe(e){const t=(0,ee.Z)(),i=ue()(Re()(e),((e,t)=>({key:t,name:e.fileName,size:Ze()(e.fileSize),createTime:z()(e.createTime).format("YYYY/MM/DD HH:mm"),id:e.fileID,url:e.url})));return{columns:[{title:t.$t({id:"ppAn7O",defaultMessage:"File name"}),dataIndex:"name",key:"name"},{title:t.$t({id:"3xkLyH",defaultMessage:"File size"}),dataIndex:"size",key:"size"},{title:t.$t({id:"XLMtWD",defaultMessage:"Upload time"}),dataIndex:"createTime",key:"createTime"}],dataSource:i}}function Le(e,t,i,n,o){const[l,a]=(0,r.useState)(-1),s=(0,r.useRef)(null),d=(0,r.useRef)(null),u=(0,r.useRef)(),{shareParams:c}=(0,Fe.rr)(),v=(0,r.useCallback)(((e,i)=>{!function(){var e;u.current&&(null===(e=u.current)||void 0===e||e.destroy())}(),a(i),e&&d.current&&((0,De.Pl)(e.fileExt)&&(0,De.xz)(i,t,d.current,c,o).then((e=>{u.current=e})),(0,De.NH)(e.fileExt)&&(0,De.xz)(i,t,d.current,c,o).then((e=>{u.current=e})))}),[t,c,o]);return(0,r.useEffect)((()=>{if(!i)return;const t=Se()(e,(e=>e.fileID===n));e[t]&&a(t)}),[i,n,e]),(0,r.useLayoutEffect)((()=>{const t=e[l];t&&s.current&&(v(t,l),s.current.goTo(l))}),[e,v,l]),{carouselWrap:d,carousel:s,currentAttachment:e[l],index:l,setIndex:a}}var $e=i(4511),Ge=i(38362),Be=i(9217),He=i(2715),Ve=i(67661),Ke=i(36639),ze=i(17547),Ue=i(30731);function qe(e,t,i){const n=(0,M.v)((i=>e?(0,ze.C)(i,{tableNodeId:e,viewId:t}):null)),o=(0,M.v)((t=>{var i;return e?null===(i=L.TW.selectById(t,e))||void 0===i?void 0:i.columns:void 0})),l=(0,r.useMemo)((()=>null!==i&&void 0!==i&&i.globalFilter?{id:e,filter:Ke.K.and((0,Ue.hu)(null===i||void 0===i?void 0:i.globalFilter,null!==o&&void 0!==o?o:[]),n)}:{id:e,filter:n}),[e,n,null===i||void 0===i?void 0:i.globalFilter,o]),a=(0,r.useRef)(l);(0,r.useLayoutEffect)((()=>{ne()(a.current,l)||(a.current=l)}),[l]);const s=(0,r.useCallback)((e=>e.id===p._m||(!a.current.filter||(0,Ue.cm)(e.data,a.current.filter,{mondayFirst:null===i||void 0===i?void 0:i.mondayFirst,timezone:null===i||void 0===i?void 0:i.timezone}))),[null===i||void 0===i?void 0:i.mondayFirst,null===i||void 0===i?void 0:i.timezone]);return{filter:l,doesExternalFilterPass:s}}var We=i(36689);function Je(e,t,i,n){const o=(0,M.I)(),[l,a]=(0,r.useState)({[p._m]:{order:"asc",orderIndex:0}}),[s,d]=(0,r.useState)(!1),{view:u}=(0,he.Pl)(e,t,i),c=(0,M.v)((t=>{const i=L.TW.selectById(t,e);return null===i||void 0===i?void 0:i.columns})),v=(0,M.v)((e=>e.tableNode.bigTableNeedReSort)),m=!!(n&&s&&v),h=(0,r.useCallback)((t=>{null!==u&&void 0!==u&&u.id&&o((0,Z.NK)({id:e,viewId:u.id,params:{orders:t}}))}),[null===u||void 0===u?void 0:u.id,e,o]);return(0,r.useEffect)((()=>{if(null===u||void 0===u||!u.orders)return;d(!0);const e={};u.orders.forEach(((t,i)=>{e[t.columnID]={order:t.order,orderIndex:i+1}})),a(e)}),[null===u||void 0===u?void 0:u.orders]),{view:u,columns:c,viewColumns:null===u||void 0===u?void 0:u.columns,orders:l,hasOrder:s,needReSort:m,onSortingChanged:h}}var Ye=i(80785);const Xe=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/2<(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)},Qe=()=>{const e=document.getElementsByClassName("ag-row-highlight-above"),t=document.getElementsByClassName("ag-row-highlight-below");Array.from(e||[]).forEach((e=>{e.classList.remove("ag-row-highlight-above")})),Array.from(t||[]).forEach((e=>{e.classList.remove("ag-row-highlight-below")}))};function et(e){const t=(0,M.I)(),{updateCollaborator:i}=A(),{view:n}=(0,he.Pl)(e),{hasGroup:o,getDataRowNode:l,getGroupCells:a}=(0,We.HI)(e,null===n||void 0===n?void 0:n.id);return{addGridDropZone:(0,r.useCallback)((e=>{var t;e.api.addRowDropZone(null===(t=e.api)||void 0===t?void 0:t.getRowDropZoneParams({}))}),[]),onRowDragMove:(0,r.useCallback)((e=>{Qe();const t=e.node,i=e.overNode;if(!(!t||!t.data||!o&&null!==i&&void 0!==i&&i.parent&&t.parent&&(null===i||void 0===i?void 0:i.parent.id)!==t.parent.id||o&&null!==i&&void 0!==i&&i.footer||o&&null!==i&&void 0!==i&&i.group&&!i.leafGroup)&&t!==i){let t=null===i||void 0===i?void 0:i.id,l=Xe(null===i||void 0===i?void 0:i.rowTop,null===i||void 0===i?void 0:i.rowHeight,e.y);if(!i||i.id===p._m){var n;if(o)return;t=null===(n=e.api.getDisplayedRowAtIndex(e.api.getLastDisplayedRow()-1))||void 0===n?void 0:n.data.id,l=!0}m()(document.querySelectorAll('[row-id="'.concat(t,'"]')),(e=>{l?(e.classList.add("ag-row-highlight-below"),e.classList.remove("ag-row-highlight-above")):(e.classList.add("ag-row-highlight-above"),e.classList.remove("ag-row-highlight-below"))}))}}),[o]),onRowDragEnd:(0,r.useCallback)((s=>{var d,r;const u=s.node,c=l(s.overNode),v=null!==(d=null===c||void 0===c?void 0:c.rowIndex)&&void 0!==d?d:s.overIndex;let m=!0;const p=s.api;if(null!==(r=u.parent)&&void 0!==r&&r.childrenAfterFilter){let l;if(o){if(!c)return void Qe();l=c}else!c||c.lastChild?l=p.getDisplayedRowAtIndex(p.getLastDisplayedRow()-1):c.firstChild?l=null:(c.rowTop&&c.rowHeight&&(m=Xe(c.rowTop,c.rowHeight,s.y)),l=m?c:p.getDisplayedRowAtIndex(v-1));null!==n&&void 0!==n&&n.id&&(t((0,Z.mc)({id:e,viewId:n.id,items:s.nodes.map((e=>{var t;return{rowID:e.id,prevRowID:null===(t=l)||void 0===t?void 0:t.id,cells:a(l)}})).reverse()})),i())}Qe(),p.refreshCells()}),[t,e,i,null===n||void 0===n?void 0:n.id,o,l,a])}}var tt=i(88716),it=i.n(tt);function nt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{gridApi:i,tableNodeId:n,viewId:o,isShared:l=!1}=e,a=(0,M.v)(L.TG.selectAll),s=(0,M.I)(),d=(0,Fe.o1)(),u=(0,r.useCallback)((async e=>{var t;const i=e.request.startRow,a=e.request.endRow;if(l&&!d.sharingParams)return;if(void 0===i||void 0===a)return;const{payload:r}=await s(l&&d.sharingParams?(0,Z.aL)({shareParams:d.sharingParams,id:n,viewId:o,startRow:i,endRow:a}):(0,Z.iX)({id:n,viewId:o,startRow:i,endRow:a})),u=null===r||void 0===r?void 0:r.wsSyncedData;null===(t=e.success)||void 0===t||t.call(e,{rowData:ue()(null===u||void 0===u?void 0:u.rows,(e=>({...e,...e.cells}))),rowCount:null===u||void 0===u?void 0:u.lastRow})}),[s,n,o,l,d.sharingParams]),c=(0,r.useCallback)((e=>{e.updateGridOptions({serverSideDatasource:{getRows:u}})}),[u]);return(0,r.useEffect)((()=>{if(!t||!i||it()(a))return;const e=[];let o=!1;var l;(a.forEach((t=>{if(t.tableNodeId===n){const n=t.row,l=null===i||void 0===i?void 0:i.getRowNode(n.id);switch(t.type){case"add":o=!0;break;case"update":if(l){const e={...l.data,...n.cells};e.cells={...e.cells,...n.cells},l.setData(e)}break;case"remove":l&&(o=!0)}e.push(t)}})),o)&&(null===(l=i.refreshServerSide)||void 0===l||l.call(i,{}));it()(e)||s(L.Nw.deleteBigTableUpdatedRows(e))}),[a,i,s,n,t]),(0,r.useEffect)((()=>{if(i&&t){var e,n;if(null!==(e=i.isDestroyed)&&void 0!==e&&e.call(i))return;i.updateGridOptions({serverSideDatasource:{getRows:u}}),null===(n=i.refreshServerSide)||void 0===n||n.call(i,{purge:!0})}}),[i,u,t]),{setServerSideDatasource:c}}function ot(e){const{gridApi:t,tableNodeId:i}=e,n=(0,M.v)(L.qX.selectAll),o=(0,M.I)();(0,r.useEffect)((()=>{t&&!it()(n)&&(n.forEach((e=>{var n;e.id===i&&(e.isBigTable?null===t||void 0===t||null===(n=t.refreshServerSide)||void 0===n||n.call(t,{purge:e.purgeCache}):setTimeout((()=>{null===t||void 0===t||t.refreshCells({columns:[p.kl]})}),100))})),o(L.Nw.setTableRefreshed(i)))}),[n,t,o,i])}var lt=i(98506),at=i(27371),st=i(53926),dt=i.n(st),rt=i(33324),ut=i.n(rt),ct=i(53182),vt=i.n(ct),mt=i(18765),pt=i.n(mt),ht=i(77528),ft=i.n(ht),gt=i(89063),bt=i.n(gt),yt=i(53813),Ct=i.n(yt),xt=i(34362),_t=i.n(xt),wt=i(27831),It=i.n(wt),jt=i(18263),kt=i.n(jt),Dt=i(72406),Nt=i.n(Dt),Et=i(78587),Tt=i.n(Et),Mt=i(8651),St=i.n(Mt),Pt=i(41989),Rt=i.n(Pt),At=i(99540),Zt=i.n(At),Ft=i(92626),Ot=i.n(Ft),Lt=i(27954),$t=i(22138);function Gt(e){if(e.length<2)return 0;const t=e[1]-e[0];if(0===t)return 0;for(let i=2;i<e.length;i++)if(e[i]-e[i-1]!==t)return 0;return t}var Bt=i(11846);function Ht(e,t,i){var n,o,l,a,s;if(!t||!i)return;const d=bt()(e.source);if(d<1)return;const r=null!==(n=null===(o=t.startRow)||void 0===o?void 0:o.rowIndex)&&void 0!==n?n:0,u=null!==(l=null===(a=t.endRow)||void 0===a?void 0:a.rowIndex)&&void 0!==l?l:0,c=null!==(s=St()([r,u]))&&void 0!==s?s:0,v=c+d-1,p={};for(let h=c;h<=v;h++){const t=null===i||void 0===i?void 0:i.getDisplayedRowAtIndex(h);if(!t||!t.id||!t.data)continue;const n={};m()(e.destColumnIDs,(e=>{n[e]=null===t||void 0===t?void 0:t.data[e]})),p[t.id]=n}return p}function Vt(e,t,i){if(!t||!i)return;if(bt()(e.destRowIDs)<1)return;const n={};return m()(e.destRowIDs,(t=>{const o=null===i||void 0===i?void 0:i.getRowNode(t);if(!o||!o.id)return;const l={};m()(e.destColumnIDs,(e=>{l[e]=null===o||void 0===o?void 0:o.data[e]})),n[o.id]=l})),n}function Kt(e,t){const i=Ct()(e);if(!Tt()(e))return[];if(0===t||it()(e))return e;for(;bt()(i)<t;)i.push(...e);return It()(i,t)}function zt(e){var t,i,n,o;if(!e)return!1;const l=null!==(t=null===(i=e.startRow)||void 0===i?void 0:i.rowIndex)&&void 0!==t?t:0,a=null!==(n=null===(o=e.endRow)||void 0===o?void 0:o.rowIndex)&&void 0!==n?n:0;return bt()(null===e||void 0===e?void 0:e.columns)>1||Math.abs(a-l)>0}function Ut(e){const t=bt()(e.destColumnIDs),i=bt()(e.sourceColumns),n=bt()(e.destRowIDs),o=bt()(e.source),l=i>t,a=o>n,s=i>0&&i<t,d=o<n;return Nt()((e=>l?function(e){const{source:t,sourceColumns:i,destColumnIDs:n}=e,o=pt()(i,(e=>_t()(n,e.id))),l=ue()(t,(e=>It()(e,bt()(n))));return{...e,source:l,sourceColumns:o}}(e):e),(e=>a?function(e){const{source:t,destRowIDs:i}=e,n=It()(t,bt()(i));return{...e,source:n}}(e):e),(e=>s?function(e){const{source:t,destColumnIDs:i,sourceColumns:n,destRowIDs:o}=e,l=Kt(n,bt()(i)),a=It()(ue()(kt()(bt()(i)),(e=>{var n;return Kt(null!==(n=t[e])&&void 0!==n?n:t[0],bt()(i))})),bt()(o));return{...e,source:a,sourceColumns:l}}(e):e),(e=>d?function(e){const{source:t,destRowIDs:i}=e,n=Kt(t,bt()(i));return{...e,source:n}}(e):e))(e)}const qt=function(e,t,i){const n=(0,M.I)(),o=(0,ee.Z)(),{modal:l}=lt.Z.useApp(),a=(0,M.v)((t=>L.TW.selectById(t,e))),[d,u]=(0,r.useState)([]),[c,v]=(0,r.useState)([]),[h,f]=(0,r.useState)([]),[g,b]=(0,r.useState)([]),y=(0,r.useRef)("copy"),C=(0,r.useRef)(null===a||void 0===a?void 0:a.columns),x=(0,r.useContext)(Bt.z).copyMoreCell?5e3:1e3,_=(0,r.useCallback)((e=>{const i=e.column.getColId(),n=O()(C.current,(e=>e.id===i)),o=e.value.realValue;return(0,pe.c8)(o,n,void 0,t)}),[t]),w=(0,r.useCallback)((e=>{var t;if(!e||!e.key)return;const i=JSON.parse(e.key);if(!i)return;const n={};if(n[i.id]=i.value,null!==(t=e.parent)&&void 0!==t&&t.group){const t=w(e.parent);m()(t,((e,t)=>{n[t]=e}))}return n}),[]),I=(0,r.useCallback)((e=>{var t,i,n;const o=e.column.getColId(),l={id:null===(t=e.node)||void 0===t?void 0:t.id,groupId:null!==(i=e.node)&&void 0!==i&&null!==(i=i.parent)&&void 0!==i&&i.group?e.node.parent.id:void 0,groupKeys:w(null===(n=e.node)||void 0===n?void 0:n.parent)};u((e=>[...e,o])),v((e=>[...e,l]))}),[w]),j=(0,r.useCallback)((async()=>{try{return await navigator.permissions.query({name:"clipboard-read"}),!0}catch(e){return at.ZP.warning(o.$t({id:"h8CcD3",defaultMessage:"The browser does not have permission to access the clipboard and cannot use copying paste features"})),!1}}),[o]),k=(0,r.useCallback)((async d=>{if(!await j()||!i)return;let r="";navigator.clipboard.readText&&(r=await navigator.clipboard.readText());const c=dt().get($t.$i),p=dt().get($t.HT),h=JSON.stringify(c&&c.text)!==JSON.stringify(r),f=vt()(d.api.getCellRanges());if(null===f||void 0===f?void 0:f.columns.some((e=>{var t,i;return"subscribed"===(null===(t=e.getColDef())||void 0===t||null===(t=t.cellEditorParams)||void 0===t?void 0:t.mode)||"connected"===(null===(i=e.getColDef())||void 0===i||null===(i=i.cellEditorParams)||void 0===i?void 0:i.mode)})))return void at.ZP.warning(o.$t({id:"9aY21e",defaultMessage:"Paste action is not supported for sync column"}));let g=0,b=0,y=()=>{n((0,Z.W0)({id:e,params:p,destCells:Ht(p,f,d.api)}))};try{if(h){if(p.destColumnIDs=p.destColumnIDs.filter((e=>{var t;return"attachment"!==(null===(t=d.api.getColumnDef(e))||void 0===t?void 0:t.headerComponentParams.type)})),0===bt()(p.destColumnIDs)||0===bt()(p.destRowIDs))return;const i=new(Ot())(r,{cast:!1,cellDelimiter:"\t"}).parse();bt()(i)<bt()(p.destRowIDs)&&(p.destRowIDs=It()(p.destRowIDs,bt()(i))),m()(p.destGroupKeys,((e,n)=>{const o=O()(null===a||void 0===a?void 0:a.columns,(e=>e.id===n));if(o&&!_t()(p.destColumnIDs,n)){p.destColumnIDs.push(n);for(let n=0;n<i.length;n++)i[n].push((0,pe.c8)(e,o,void 0,t))}}));let o={...p,destGroupKeys:void 0,sourceColumns:[],source:i};zt(f)?o=Ut(o):(g=bt()(i[0])-bt()(p.destColumnIDs),b=bt()(i)-bt()(p.destRowIDs)),y=()=>{n((0,Z.W0)({id:e,params:o,destCells:Ht(o,f,d.api)}))}}else{const t=bt()(p.destColumnIDs),i=bt()(p.sourceColumns),o=bt()(p.destRowIDs),l=bt()(p.source);let r=p;zt(f)?r=Ut(p):(g=i-t,b=l-o),y=()=>{const t=function(e,t,i){const{source:n,sourceColumns:o,destColumnIDs:l}=e,a=Ct()(n),d=Ct()(o);return m()(l,((e,i)=>{const n=null===t||void 0===t?void 0:t.getColumnDef(e);if(!n)return;const{type:l,typeOptions:r}=n.headerComponentParams,u=o[i],c="multiLineText"===l;("number"===u.type||"formula"===u.type)&&c&&(m()(a,(e=>{var t,n,o,l,a,d,r,c,v;"number"===u.type&&(e[i]=null!==(n=(0,s.P)(Zt()(e[i]),null!==(o=null===(l=u.typeOptions)||void 0===l?void 0:l.precision)&&void 0!==o?o:0,null===(a=u.typeOptions)||void 0===a?void 0:a.format))&&void 0!==n?n:null);"formula"===u.type&&"number"===(null===(t=u.typeOptions)||void 0===t?void 0:t.expectedType)&&(e[i]=null!==(d=(0,s.P)(Zt()(e[i]),null!==(r=null===(c=u.typeOptions)||void 0===c?void 0:c.numberPrecision)&&void 0!==r?r:0,null===(v=u.typeOptions)||void 0===v?void 0:v.numberFormat))&&void 0!==d?d:null)})),d[i].type=l,d[i].typeOptions=r)})),m()(e.destGroupKeys,((t,n)=>{const o=O()(i,(e=>e.id===n));if(o&&!_t()(e.destColumnIDs,n)&&(e.destColumnIDs.push(n),!_t()(ue()(d,(e=>e.id)),n))){d.push(o);for(let e=0;e<a.length;e++)a[e].push(t)}})),Object.assign(e,{destGroupKeys:void 0,source:a,sourceColumns:d})}(r,d.api,null===a||void 0===a?void 0:a.columns);n((0,Z.W0)({id:e,params:t,destCells:Ht(t,f,d.api)}))}}if(g>0||b>0){const e=o.$t({id:"1vZgU3",defaultMessage:"{columns, plural, =0 {} one {# column} other {# columns}}"},{columns:g}),t=o.$t({id:"J7sUye",defaultMessage:"{rows, plural, =0 {} one {# row} other {# rows}}"},{rows:b});l.confirm({transitionName:"dialog-animation",title:o.$t({id:"/hECN4",defaultMessage:"Do you want to expand this table?"}),className:Lt.Z.confirmDialog,content:o.$t({id:"UVqG3Z",defaultMessage:"To successfully display the data you pasted, we need to add {columns} {rows}."},{columns:e,rows:t}),okText:o.$t({id:"N2IrpM",defaultMessage:"Confirm"}),cancelText:o.$t({id:"47FYwb",defaultMessage:"Cancel"}),onOk:()=>{y(),d.api.isAnyFilterPresent()&&b>0&&at.ZP.info(o.$t({id:"XEK+nW",defaultMessage:"Filter is currently enabled. Added records may be filtered"}))},icon:null})}else y(),at.ZP.success(o.$t({id:"PMthOi",defaultMessage:"Paste successfully"}))}finally{u([]),v([])}}),[n,o,e,null===a||void 0===a?void 0:a.columns,t,j,l,i]),D=(0,r.useCallback)((async(t,i)=>{if(!await j())return;const l=null===t||void 0===t?void 0:t.getCellRanges(),s=null===t||void 0===t?void 0:t.getEditingCells(),d=bt()(s)>0,r=vt()(l);if(ft()(null===r||void 0===r?void 0:r.columns,(e=>{var t;return"formula"===(null===(t=e.getColDef())||void 0===t||null===(t=t.cellEditorParams)||void 0===t?void 0:t.type)}))&&i)return at.ZP.info(o.$t({id:"0MF1HY",defaultMessage:"Formula field does not support cut"}));if(r&&!d){var u,c,v,p,h,g;const l=null!==(u=null===(c=r.startRow)||void 0===c?void 0:c.rowIndex)&&void 0!==u?u:0,s=null!==(v=null===(p=r.endRow)||void 0===p?void 0:p.rowIndex)&&void 0!==v?v:0,d=null!==(h=St()([l,s]))&&void 0!==h?h:0,C=null!==(g=Rt()([l,s]))&&void 0!==g?g:0,_=function(e,t){const i=[];return m()(e.columns,(e=>{const n=e.getColId(),o=O()(t,(e=>e.id===n));o&&i.push(o)})),i}(r,null===a||void 0===a?void 0:a.columns),w=ue()(_,(e=>e.id));if((C-d+1)*bt()(w)>x)return at.ZP.info(o.$t({id:"Phlp5e",defaultMessage:"Exceeds the maximum number of cells"}));const I=function(e){let{minRowIndex:t,maxRowIndex:i,gridApi:n,colIds:o}=e;const l=[];for(let a=t;a<=i;a++){const e=null===n||void 0===n?void 0:n.getDisplayedRowAtIndex(a),t=ue()(o,(t=>{var i;return null!==(i=null===e||void 0===e?void 0:e.data[t])&&void 0!==i?i:""}));l.push(t)}return l}({minRowIndex:d,maxRowIndex:C,gridApi:t,colIds:w});y.current=i?"cut":"copy",f(I),b(_),null===t||void 0===t||t.copySelectedRangeToClipboard({includeHeaders:!1,includeGroupHeaders:!1});const j=await navigator.clipboard.readText();try{dt().set($t.$i,{text:j,pathname:window.location.pathname})}catch{at.ZP.info(o.$t({id:"MZg+g+",defaultMessage:"Copying too much content may cause the paste function to fail."}))}if(i){const i={destColumnIDs:w,destRowIDs:Re()(ue()(kt()(d,C+1),(e=>{var i;return null===t||void 0===t||null===(i=t.getDisplayedRowAtIndex(e))||void 0===i?void 0:i.id})))};n((0,Z.Sq)({id:e,params:i,destCells:Vt(i)}))}}}),[n,o,null===a||void 0===a?void 0:a.columns,e,j,x]),N=(0,r.useCallback)((e=>D(e,i)),[D,i]),E=(0,r.useCallback)((t=>{var i;if(_t()(ae.L8,t.currentCellValue.type))return null===t||void 0===t||null===(i=t.currentCellValue)||void 0===i?void 0:i.realValue;const o=t.initialValues,l=o.length;let a=o[t.currentIndex%l].realValue;switch(t.currentCellValue.type){case"number":{const e=ue()(o,(e=>Number(e.realValue))),i=Gt(e),n=t.currentIndex+1;if(0!==i)a=Number(o[l-1].realValue)+i*n;else{const t=function(e){if(e.length<2)return 0;const t=e[1]/e[0];if(0===t||1===t||t===1/0)return 0;for(let i=2;i<e.length;i++)if(e[i]/e[i-1]!==t)return 0;return t}(e);0!==t&&(a=Number(o[l-1].realValue)*Math.pow(t,n))}break}case"datetime":{const e=Gt(ue()(o,(e=>z()(e.realValue).unix()))),i=t.currentIndex+1;0!==e&&(a=z()(o[l-1].realValue).add(e*i,"second").format(U.G1));break}case"coordinate":{var s;const i=t.currentCellValue.rowId,o=null===(s=t.column)||void 0===s?void 0:s.getColId();i&&o&&n((0,Z.I)({id:e,rowId:i,cells:{[o]:a},prevCells:{[o]:t.currentCellValue.realValue}}));break}}return a}),[n,e]);return function(e){let[t,i]=e;(0,r.useEffect)((()=>{const e=[];let n,o={};m()(t,(t=>{t.id!==p._m&&(t.groupId?(n||(n=t.groupId,t.groupKeys&&(o=t.groupKeys)),n===t.groupId&&e.push(t.id)):e.push(t.id))}));const l={destColumnIDs:pt()(ut()(i),(e=>e!==p.hK)),destRowIDs:ut()(e),destGroupKeys:o};dt().set($t.HT,{...dt().get($t.HT),...l})}),[i,t])}([c,d]),function(e){let[t,i]=e;(0,r.useEffect)((()=>{if(t.length&&i.length){const e={sourceColumns:i,source:t};dt().set($t.HT,{...dt().get($t.HT),...e})}}),[t,i])}([h,g]),function(e,t){let[i,n]=e;(0,r.useEffect)((()=>{if(i.length&&i[0].length){const e=i.length*i[0].length;at.ZP.info(t.$t({id:"nLfVfQ",defaultMessage:"{action} {count} cells"},{count:e,action:"copy"===n.current?t.$t({id:"duplicate",defaultMessage:"Copy"}):t.$t({id:"RNRpjD",defaultMessage:"Crop"})}))}}),[t,i,n])}([h,y],o),(0,r.useEffect)((()=>{C.current=null===a||void 0===a?void 0:a.columns}),[null===a||void 0===a?void 0:a.columns]),{fillOperation:E,processCellForClipboard:_,processCellFromClipboard:I,onPasteStart:k,handleCopy:D,handleCut:N}};function Wt(e){const{gridApi:t,collaborators:i}=e,[n,o]=(0,r.useState)([]);(0,r.useEffect)((()=>{null===t||void 0===t||t.refreshCells({rowNodes:Re()(ue()([...i,...n],(e=>{var i;if(null!==e&&void 0!==e&&null!==(i=e.selected)&&void 0!==i&&i.rowID)return null===t||void 0===t?void 0:t.getRowNode(e.selected.rowID)}))),columns:Re()(ue()([...i,...n],(e=>{var t;if(null!==e&&void 0!==e&&null!==(t=e.selected)&&void 0!==t&&t.columnID)return e.selected.columnID}))),force:!0}),o(i)}),[t,i,n])}var Jt=i(22601),Yt=i(81987),Xt=i(645);const Qt="borderedText_borderedText__dicRS";var ei=i(94553);const ti=e=>(0,ei.jsx)("span",{className:Qt,children:e.children});var ii=i(15328),ni=i(65379),oi=i(11145),li=i(5272),ai=i(37750);function si(e,t){const i=(0,oi.TH)(),n=(0,M.I)(),o=(0,M.v)((e=>e.undoRedo.undo)),l=(0,M.v)((e=>e.undoRedo.redo)),a=(0,r.useCallback)((()=>{o.length&&n(li.Y({pathname:i.pathname}))}),[o.length,n,i.pathname]),s=(0,r.useCallback)((()=>{l.length&&n(li.K({pathname:i.pathname}))}),[l.length,n,i.pathname]),d=(0,r.useCallback)((()=>{n(ai.N.clear())}),[n]);return(0,ni.y1)("mod+z",(e=>{e.preventDefault(),a()}),t,[e,t,a]),(0,ni.y1)("mod+shift+z, mod+y",(e=>{e.preventDefault(),s()}),t,[e,t,s]),{undo:a,redo:s,clear:d,enabled:null===t||void 0===t?void 0:t.enabled,undoItems:o,redoItems:l}}var di=i(83580);class ri{constructor(){a()(this,"useCellCollaborators",R),a()(this,"updateCells",Z.I),a()(this,"useParameters",f.F),a()(this,"updateColumn",Z.Gw),a()(this,"useColumn",$),a()(this,"useDialogState",Ne.bZ),a()(this,"useShareParams",Fe.rr),a()(this,"isMobile",Ge.tq),a()(this,"config",g.Z),a()(this,"getPublicThumbnailUrl",Ee.u9),a()(this,"useView",he.Pl),a()(this,"isNumeric",pe.kE),a()(this,"isDatetimeLike",pe.dV),a()(this,"useConfirmDialog",Ne.WK),a()(this,"updateViewColumns",Z.Uk),a()(this,"updateViewColumnsAction",L.Nw.updateViewColumns),a()(this,"HIDDEN_CHANGE_FIELD_TYPE_CONFIRM_MODAL",$t.Ld),a()(this,"BorderedText",ti),a()(this,"formatMessage",ii.wv),a()(this,"useSelector",M.v)}}const ui=new n.z;ui.bind(o.v.common,ri),ui.bind(o.v.multiLineText,class extends ri{constructor(){super(...arguments),a()(this,"updateMultiLineTextEditor",d.Nw.updateMultiLineTextEditor)}}),ui.bind(o.v.number,class extends ri{constructor(){super(...arguments),a()(this,"padNumberByPrecisionWithFormat",s.P)}}),ui.bind(o.v.datetime,class extends ri{constructor(){super(...arguments),a()(this,"formatDateByRule",G.U),a()(this,"dateTimezoneToLocal",B.Ar),a()(this,"dateLocalToTimezone",B.LC),a()(this,"useDatetimeFormat",q)}}),ui.bind(o.v.coordinate,class extends ri{constructor(){super(...arguments),a()(this,"updateCoordinateEditor",d.Nw.updateCoordinateEditor)}}),ui.bind(o.v.formula,class extends ri{constructor(){super(...arguments),a()(this,"updateCoordinateEditor",d.Nw.updateCoordinateEditor),a()(this,"getFormulaType",W.ZP.getFormulaType.bind(W.ZP)),a()(this,"useContentEditor",ke),a()(this,"useFormula",_e),a()(this,"checkFormula",(e=>X.check(e)))}}),ui.bind(o.v.attachment,class extends ri{constructor(){super(...arguments),a()(this,"isImagePreview",De.Pl),a()(this,"getPreGeneratedThumbnail",Ee.t7),a()(this,"previewAttachmentEmitter",Te.qf),a()(this,"addAttachment",W.ZP.addAttachment.bind(W.ZP)),a()(this,"uploadFile",$e.Z.uploadFile.bind($e.Z)),a()(this,"useAttachmentTable",Oe),a()(this,"addAttachmentAction",Z.JD),a()(this,"deleteAttachment",Z.OW),a()(this,"updateAttachment",Z.Y5),a()(this,"combineFileNameWithExt",De.V9),a()(this,"download",De.LR),a()(this,"exportDataURL",De.A$),a()(this,"getFileExt",De.lm),a()(this,"getPureFileName",De.aZ),a()(this,"getSignedUrlForDownload",$e.Z.getSignedUrlForDownload.bind($e.Z)),a()(this,"ableToPreview",De.kv),a()(this,"isPdfPreview",De.NH),a()(this,"useAttachmentPreview",Le)}}),ui.bind(o.v.hyperlink,class extends ri{constructor(){super(...arguments),a()(this,"formatHyperlink",G.f7)}}),ui.bind(o.v.related,class extends ri{constructor(){super(...arguments),a()(this,"useWorkspaces",Be._O),a()(this,"useProject",He.P),a()(this,"useTableNodeDetail",Ve.mJ),a()(this,"useTableFilter",qe),a()(this,"formatDateByRule",G.U)}}),ui.bind(o.v.lookup,class extends ri{constructor(){super(...arguments),a()(this,"OPERATORS",Jt.fP),a()(this,"PreviewAttachmentEmitter",Te.qf),a()(this,"useTableNodeDetail",Ve.mJ),a()(this,"useWorkspaces",Be._O),a()(this,"useWorkspaceRoles",Yt.q),a()(this,"useProject",He.P),a()(this,"getFilterOperators",Jt.xm),a()(this,"getColumnExpectedType",pe.UH),a()(this,"getColumnExpectedTypeOption",pe.po)}}),ui.bind(o.v.grid,class extends ri{constructor(){super(...arguments),a()(this,"EmptyCellId",We.s3),a()(this,"FieldRender",Xt.Z),a()(this,"useGrouping",We.ZP),a()(this,"useSorting",Je),a()(this,"useGroupKey",We.YI),a()(this,"useGrid",Ye.Nm),a()(this,"useGridContextMenu",Ye.Io),a()(this,"useGridData",Ye.cW),a()(this,"useMoveRows",et),a()(this,"useBigTable",nt),a()(this,"useTableRefresh",ot),a()(this,"useFieldConfig",ye),a()(this,"useCopyPaste",qt),a()(this,"useTableFilter",qe),a()(this,"useCollaborator",A),a()(this,"useCollaboratorCells",Wt),a()(this,"useGroupData",We.HI),a()(this,"padNumberByPrecisionWithFormat",s.P),a()(this,"useUndoRedo",si),a()(this,"Select",di.Ph)}});const ci=ui},70554:(e,t,i)=>{i.d(t,{Nw:()=>h,nb:()=>f,ZP:()=>p});var n=i(49163),o=i(21101),l=i(7070),a=i.n(l),s=i(23903),d=i.n(s);const r=["#0376C2","#07594A","#076A66","#077CB0","#077E7A","#078E82","#07B195","#098EC4","#22B6ED","#29409A","#3384FF","#33C6E1","#4BA946","#4C7020","#4DC7EC","#505F79","#5EC298","#69686D","#6DADE2","#7572A7","#75C7B9","#79BCE7","#7ABF45","#8476CD","#89D2E3","#9597CA","#A7C299","#A84D18","#A8B7D8","#B2103E","#B295C5","#B2D68C","#B5A87F","#B7E1FA","#BBBFC2","#C077AF","#C41832","#C7A7D2","#D16F20","#D2174A","#D7DF3F","#E55D3C","#E9A519","#EF342A","#F45F7C","#F57125","#F68F26","#F79D8B","#F7B1BF","#F8D29D","#F99C45","#FBAF37","#FCAE62","#FCBA5D","#FFD233"],u=(0,n.HF)({sortComparer:(e,t)=>e.lastActiveTime-t.lastActiveTime});const c={setCollaborators:function(e,t){u.removeAll(e);const i=r.length,n={},o={};u.addMany(e,a()(t.payload,(t=>{const l=e.sessionID===t.id,a=r[(s=t.userID,s^=s>>16,s*=2146121005,s^=s>>15,s*=2221713035,(s^s>>16)%i)];var s;if(t.selected&&!l){const e=t.selected,i="".concat(e.columnID,",").concat(e.rowID);n[i]||(n[i]=[]),d()(n[i],(e=>e.userID===t.userID))||n[i].push({userID:t.userID,columnID:e.columnID,rowID:e.rowID,name:t.name,color:a})}const u={...t,color:a};return l||(o[t.userID]=u),u}))),e.cellCollaborators=n,e.otherCollaborators=o},setUpdatedTime:function(e,t){e.updatedTime=t.payload}},v=u.getInitialState({sessionID:"",cellCollaborators:{},otherCollaborators:{},updatedTime:null}),m=(0,n.oM)({name:"collaborator",initialState:v,reducers:c,extraReducers(e){e.addCase(o.N.setSessionId,((e,t)=>{e.sessionID=t.payload}))}}),p=m,h=m.actions,f=u.getSelectors((e=>e.collaborator))},41484:(e,t,i)=>{i.d(t,{h:()=>Q});var n=i(49163),o=i(70963),l=i(21101),a=i(58590),s=i(93707),d=i(74909),r=i(1714),u=i(76592),c=i(41711),v=i(65557),m=i(96576),p=i(70554),h=i(5129),f=i(20535),g=i(98825),b=i(37750),y=i(53926),C=i.n(y),x=i(22138),_=i(78587),w=i.n(_),I=i(74797),j=i(22963),k=i(30731);const D=(0,j.Fs)({baseURL:"".concat(I.Z.baseApiURL,"/dashboards/")});class N extends j.tr{async getDashboards(e){const{data:t}=await this.fetch.get("",{params:{projectID:e}});return t}async createDashboard(e,t){const{data:i}=await this.fetch.post("",{name:e,projectID:t});return i}async update(e,t){const{data:i}=await this.fetch.patch("".concat(e,"/"),t);return i}async deleteDashboard(e){const{data:t}=await this.fetch.delete("".concat(e,"/"));return t}async moveDashboard(e,t){const{data:i}=await this.fetch.patch("".concat(e,"/move/"),{prevID:t});return i}async shareDashboard(e,t,i,n,o){const{data:l}=await this.fetch.patch("".concat(e,"/share/"),{toggle:t,togglePassword:i,resetToken:n,resetPassword:o});return l}async getComponents(e){const{data:t}=await this.fetch.get("".concat(e,"/items/"));return t}async createComponent(e,t){const{data:i}=await this.fetch.post("".concat(e,"/items/"),t);return i}async deleteComponent(e,t){const{data:i}=await this.fetch.delete("".concat(e,"/items/").concat(t,"/"),{params:{id:t,dashboardID:e}});return i}static toDeprecatedFilter(e){var t,i;if(!e||!e.config)return e;if(null!==(t=e.config.stat)&&void 0!==t&&t.filter){const{filter:t,...i}=(0,k.OV)(e.config.stat.filter)||{};return{...e,config:{...e.config,stat:{...e.config.stat,filter:i,filterV2:t}}}}if(null!==(i=e.config.chart)&&void 0!==i&&i.filter){const{filter:t,...i}=(0,k.OV)(e.config.chart.filter)||{};return{...e,config:{...e.config,chart:{...e.config.chart,filter:i,filterV2:t}}}}return e}static transformItem(e){var t,i;if(!e||!e.config)return e;if(null!==(t=e.config.chart)&&void 0!==t&&t.filter){const t=e.config.chart;return{...e,config:{...e.config,chart:{...t,filter:(0,k.n8)({...t.filter,filter:t.filterV2})}}}}if(null!==(i=e.config.stat)&&void 0!==i&&i.filter){const t=e.config.stat;return{...e,config:{...e.config,stat:{...e.config.stat,filter:(0,k.n8)({...t.filter,filter:t.filterV2})}}}}return e}async updateComponent(e,t){const{data:i}=await this.fetch.patch("".concat(e,"/items/").concat(t.id,"/"),N.toDeprecatedFilter(t));return i}async updateLayouts(e,t){const{data:i}=await this.fetch.patch("".concat(e,"/layouts/"),{layouts:t});return i}async getSharedDashboards(e,t){const{token:i,type:n}=e,{data:o}=await this.fetch.get("shared/".concat(n,"/").concat(i,"/"),{params:{userToken:t},ignoreError:!0});return o.detail}async getSharedComponents(e,t,i){const{token:n,type:o}=e,{data:l}=await this.fetch.get("shared/".concat(o,"/").concat(n,"/items/"),{params:{dashboardID:i,userToken:t},ignoreError:!0});return l.detail}async bigTableStat(e,t){"count"===t.method&&delete t.aggregator;const{filter:i,...n}=(0,k.OV)(t.filter)||{},{data:o}=await this.fetch.post("".concat(e,"/bt/stat/"),{...t,filter:n.filterCondition&&n.filters?n:void 0,filterV2:i},{ignoreError:!0});return o}async bigTableChart(e,t){const{filter:i,...n}=(0,k.OV)(t.filter)||{},{data:o}=await this.fetch.post("".concat(e,"/bt/chart/"),{...t,filter:n.filterCondition&&n.filters?n:void 0,filterV2:i},{ignoreError:!0});return o}}const E=new N(D),T=(0,n.HF)({}),M=(0,n.HF)({});function S(e){return(t,i)=>{let n;var o,l;w()(i.payload)?n=null===(o=i.payload)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.projectID:n=null===(l=i.payload)||void 0===l?void 0:l.projectID;null!==t.currentProjectId&&t.currentProjectId===n&&e(t,i)}}function P(e){return(t,i)=>{let n;var o,l;w()(i.payload)?n=null===(o=i.payload)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.dashboardID:n=null===(l=i.payload)||void 0===l?void 0:l.dashboardID;null!==t.currentDashboardId&&t.currentDashboardId===n&&e(t,i)}}const R={create:S((function(e,t){T.addOne(e.dashboards,t.payload)})),delete:S((function(e,t){T.removeOne(e.dashboards,t.payload.id)})),update:S((function(e,t){T.updateOne(e.dashboards,{id:t.payload.id,changes:t.payload.updatedFields})})),move:S((function(e,t){T.updateOne(e.dashboards,{id:t.payload.id,changes:{order:t.payload.order}})})),list:S((function(e,t){T.setAll(e.dashboards,t.payload)})),listItems:P((function(e,t){const i=t.payload;M.setAll(e.components,i.map(N.transformItem))})),createItem:P((function(e,t){const i=t.payload;M.addOne(e.components,N.transformItem(i))})),updateItem:P((function(e,t){M.updateOne(e.components,{id:t.payload.id,changes:N.transformItem(t.payload.updatedFields)})})),deleteItem:P((function(e,t){M.removeOne(e.components,t.payload.id)})),updateLayouts:function(e,t){M.updateMany(e.components,t.payload.map((e=>{let{id:t,layout:i}=e;return{id:t,changes:{layout:i}}})))},updateCurrentProjectId:function(e,t){e.currentProjectId=t.payload},updateCurrentDashboardId:function(e,t){e.currentDashboardId!==t.payload&&M.removeAll(e.components),e.currentDashboardId=t.payload,e.currentProjectId&&(e.selectedDashboards||(e.selectedDashboards={}),e.selectedDashboards[e.currentProjectId]=t.payload,C().set(x.fX,e.selectedDashboards))},clean:function(e){M.removeAll(e.components),T.removeAll(e.dashboards),e.currentDashboardId=null,e.currentProjectId=null}};var A=i(40365);const{createAsyncAction:Z}=(0,A.w)({typePrefix:"dashboard",syncWithWebSocket:!0}),F=Z("getAll",(async(e,t)=>await E.withRequestId(t.requestId).getDashboards(e))),O=(Z("create",(async(e,t)=>await E.withRequestId(t.requestId).createDashboard(e.name,e.projectId))),Z("update",(async(e,t)=>await E.withRequestId(t.requestId).update(e.id,e.params))),Z("delete",(async(e,t)=>await E.withRequestId(t.requestId).deleteDashboard(e))),Z("Dashboard",(async(e,t)=>{const{id:i,prevID:n}=e;return await E.withRequestId(t.requestId).moveDashboard(i,n)})),Z("shareDashboard",(async(e,t)=>{const{id:i,toggle:n,togglePassword:o,resetToken:l,resetPassword:a}=e;return await E.withRequestId(t.requestId).shareDashboard(i,n,o,l,a)})),Z("getComponents",(async(e,t)=>await E.withRequestId(t.requestId).getComponents(e))),Z("createComponent",(async(e,t)=>await E.withRequestId(t.requestId).createComponent(e.id,e.params))),Z("deleteComponent",(async(e,t)=>await E.withRequestId(t.requestId).deleteComponent(e.id,e.componentId))),Z("updateComponent",(async(e,t)=>await E.withRequestId(t.requestId).updateComponent(e.id,e.params))),Z("getSharedDashboards",(async(e,t)=>{const{shareParams:i,userToken:n}=e;return await E.withRequestId(t.requestId).getSharedDashboards({type:i.type,token:i.token},n)})),Z("getSharedComponents",(async(e,t)=>{const{shareParams:i,userToken:n,id:o}=e;return await E.withRequestId(t.requestId).getSharedComponents({type:i.type,token:i.token},n,o)})),Z("bigTableStat",(async(e,t)=>await E.withRequestId(t.requestId).bigTableStat(e.id,e.config))),Z("bigTableChart",(async(e,t)=>await E.withRequestId(t.requestId).bigTableChart(e.id,e.config))),{currentProjectId:null,currentDashboardId:null,selectedDashboards:C().get(x.fX),dashboards:T.getInitialState(),components:M.getInitialState()}),L=(0,n.oM)({name:"dashboard",initialState:O,reducers:R,extraReducers(e){e.addCase(F.pending,((e,t)=>{e.currentProjectId=t.meta.arg}))}}),$=L;L.actions;var G=i(61124);const{createAsyncAction:B}=(0,A.w)({typePrefix:"quota"}),H=B("get",(async()=>G.Z.getQuota())),V=(0,n.oM)({name:"quota",initialState:{},reducers:{},extraReducers(e){e.addCase(H.fulfilled,((e,t)=>{Object.assign(e,t.payload)}))}}),K=V;V.actions;var z=i(71331),U=i(92922),q=i(27052),W=i(28137),J=i(1667),Y=i(95151),X=i(25394);const Q=(0,n.xC)({reducer:(0,o.UY)({app:s.ZP.reducer,user:l.Z.reducer,project:a.ZP.reducer,workspace:d.ZP.reducer,tableNode:r.ZP.reducer,layerNode:u.ZP.reducer,infoWindow:c.ZP.reducer,map:v.ZP.reducer,org:m.Z.reducer,collaborator:p.ZP.reducer,cell:h.Z.reducer,notification:f.ZP.reducer,undoRedo:b.Z.reducer,dataFile:g.ZP.reducer,dashboard:$.reducer,quota:K.reducer,annotation:z.Z.reducer,extension:U.ZP.reducer,icons:q.ZP.reducer}),middleware:e=>e({immutableCheck:{},serializableCheck:{ignoredPaths:["undoRedo"],ignoredActionPaths:["payload.undoAction","payload.redoAction","meta.arg"]}}).concat(W.ZP).concat(J.Z).concat(Y.Z).concat(X.Z),preloadedState:ee,devTools:!1});var ee}}]);